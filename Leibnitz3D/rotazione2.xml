<?xml version="1.0" encoding="UTF-8"?>
<!-- $Id: paraboloide.xml,v 1.2.2.1 2012/07/26 17:31:21 marco Exp $ -->
<l:definitions xmlns:l="http://www.mmarini.org/leibnitz-1-0-0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.mmarini.org/leibnitz-1-0-0 ../Leibnitz/res/leibnitz-1-0-0.xsd ">

	<!-- Tempo -->
	<l:variable id="t">0</l:variable>
	
	<!-- Velocità di rotazione del sistema di riferimento -->
	<l:function id="u">0.1 * 2*PI / 4</l:function>
	
	<l:function id="c">cos(u * t)</l:function>
	<l:function id="s">sin(u * t)</l:function>
	
	<!-- Jacobiano -->
	<l:function id="J">c * e0 - s * e1 + 0 * e2; s* e0 + c * e1 + 0 * e2; 1 * e2</l:function>

	<!-- Jacobiano inverso -->
	<l:function id="InvJ">inv(J)</l:function>
	
	<!-- Angolo di rotazione del corpo -->
	<l:variable id="qr">qrot(0*e2)</l:variable>

	<!-- Velocità di rotazione del corpo -->
	<l:function id="w0">2*PI</l:function>

	<!-- Asse di rotazione del corpo -->
	<l:function id="axis">1 * e0 + 0 * e1 + 0 * e2</l:function>

	<!-- Velocità angolare iniziale in x -->
	<l:variable id="wx">w0 * n(axis)</l:variable>

	<!-- Velocità angolare iniziale in z -->
	<l:variable id="wz">J * wx</l:variable>	
		
	<!-- Velocità angolare del corpo -->
	<l:variable id="w">wz</l:variable>

	<!-- Coefficenti d'inerzia sugli assi principali -->
	<l:function id="Ikx">1</l:function>
	<l:function id="Iky">1</l:function>
	<l:function id="Ikz">1</l:function>

	<!-- Tensore d'inerzia in x -->
	<l:function id="Ix">Ikx * e0 + 0 * e2; Iky * e1 + 0 * e2; Ikz * e2</l:function>

	<!-- Tensore d'inerzia in z -->
	<l:function id="Iz">tr(InvJ) * Ix * InvJ</l:function>


	<!-- Derivata dell'inversa dello Jacobiano su dt -->
	<l:function id="dInvJ">u * (-s * e0 + c * e1 + 0* e2; -c * e0 - s * e1 + 0 * e2;0 * e2)</l:function>

	<!-- Derivata tensore d'inerzia in z su dt -->
	<l:function id="dIz">tr(dInvJ) * Ix * InvJ + tr(InvJ) * Ix * dInvJ</l:function>

	<!-- Accelerazione angolare -->
	<l:function id="w2">-inv(Iz) * dIz * w</l:function>

	<l:function id="omega">2*PI</l:function>
	<l:function id="R">9 * e1 + 0.5 * e2</l:function>
	<l:function id="axis">1 * e0 + 0 * e1 - 1 * e2</l:function>
	<l:function id="q">qr</l:function>



	<!-- Intervallo temporale -->
	<l:function id="dt">0.01</l:function>

	<l:update id="w">w + w2 * dt</l:update>
	<l:update id="qr">qr * qrot(w * dt)</l:update>
	<l:update id="t">t + dt</l:update>
</l:definitions>
