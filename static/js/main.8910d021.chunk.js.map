{"version":3,"sources":["SceneComponent.jsx","ExprField.tsx","OptionPanel.tsx","tensor-0.1.3.js","leibniz-ast-0.1.1.js","DefsPanel.tsx","BodyRow.tsx","BodiesPane.tsx","Editor.tsx","hsb-color-1.1.0.ts","leibniz-0.1.3.js","Test.jsx","ImportFile.tsx","DumpPanel.tsx","LbNavBar.tsx","LbAlert.tsx","App.tsx","reportWebVitals.js","index.js"],"names":["BabylonScene","onResizeWindow","engine","resize","this","BABYLON","canvas","deterministicLockstep","lockstepMaxSteps","scene","props","onSceneMount","console","error","window","addEventListener","removeEventListener","c","className","canvasClass","ref","onCanvasLoaded","React","Component","ExprField","name","expr","errors","withoutDelete","onDelete","onChange","hasErrors","length","errorItems","map","text","idx","deleteBtn","InputGroup","Append","Button","variant","onClick","icon","faTrash","Form","Group","size","Prepend","Control","type","value","ev","target","isValid","isInvalid","Feedback","OptionPanel","show","title","message","confirmButton","onCancel","onConfirm","Modal","onHide","Header","closeButton","Title","Body","Footer","assert","condition","Error","Quaternion","values","_values","i","j","k","w","_","a","other","zip","ary","sum","scale","x","ai","aj","ak","bi","bj","bk","b","l","aw","bw","Math","sqrt","mod","Number","MIN_VALUE","Matrix","row","reduce","f","n","min","rows","cols","trace","zipMap","add","subtract","m","partRows","take","col","push","appendRows","range","concat","v","Array","acc","y","z","len","hphi","cos","sa","sin","r","phi","theta","rr","sint","cost","sinp","cosp","sincos","sinsin","enchelon","gaussJordan","drop","det","mtx","h","imax","max","abs","mx","tr","createField","apply","code","OpTreeBuilder","createDet","context","createMatrixInverse","inverse","createQuatInverse","createValueInverse","createSphere1","sphere1","createCyl1","cyl1","createSphere","sphere","createCyl","cyl","createValueNorma","createQuatNorma","norma","createVectNorma","transpose","multiply","divide","createTrace","createSinh","sinh","createCosh","cosh","createTanh","tanh","createLog","log","createAtan","atan","createAcos","acos","createAsin","asin","createTan","tan","createQuaternion","createVector","createMatrix","createRef","id","resolve","createQrot","qrot","createNegateField","createNegateQuat","negate","createNegateVector","createNegateMatrix","createProduct","op1","op2","createScaleVector","vec","createScaleMatrix","mat","createScalarProduct","createMatrixVectorProduct","createMatrixProduct","createResizeVector","op","createResizeMatrix","createVectorModule","createDivideField","createDivideVector","createDivideMatrix","createSumField","createSumVector","createSumMatrix","createSubField","createSubVector","createSubMatrix","createPower","pow","createCatField","createInsertFieldAt","insertAt","createCatVector","append","createInsertVector","createAppendVector","createAppendMatrix","createTransposeMatrix","createSin","createCos","createExp","exp","createQuatModule","module","createSumQuatField","addValue","createSumQuat","createSubFieldQuat","subtractFromValue","createSubQuatField","subtractValue","createSubQuat","createField2Quat","createScaleQuat","quat","createProductQuat","createDivQuatField","createDivQuat","createSqrt","createMinVec","createMinMat","createMaxVec","createMaxMat","createAbs","NumberToken","IdToken","SymbolToken","Lexer","require","IdentifierRegex","SingleIdentifierRegex","NumberRegex","ExpNumberRegex","ReservedKeywordsRegex","checkForIdentifier","match","Builder","conf","_conf","_defs","vars","funcs","each","data","buildRef","defs","result","update","buildExp","node","bodies","position","rotation","def","varDef","funcDef","CircularResferenceResult","CodeResult","FieldType","build","System","_vars","_funcs","_update","_bodies","dt","withDt","nextState","mapValues","cloneDeep","funcCode","func","assign","dump","SystemParser","config","_config","_parserAst","ParserAst","conf1","parseAll","conf1_1","checkForNameDefinitions","conf2","checkForFunctionsRedefinition","conf3","checkForUpdateDefinition","conf4","conf5","checkForUpdateTypeDefinition","checkForBodiesTypeDefinition","parserState","createErrors","system","errorCount","buildSystem","undefined","err","parse","positionNode","positionErrors","_result","VectorType","QuaternionType","body","funcsCode","varsCode","resolver","updateCode","bodiesCode","posCode","isVar","isFunction","typeName","varResult","upResult","MatrixType","_type","_rows","_cols","_code","_errors","withErrors","flatten","arguments","ASTNode","ConstantNode","_value","ConstantQuatNode","BaseNode","_size","builder","IdentityNode","RefNode","_id","withCode","DtRefNode","UnaryNode","arg","_arg","dependencies","NegNode","ModNode","withType","withMoreErrors","TransposeNode","withSize","SqrtNode","ExpNode","SinNode","CosNode","TanNode","AsinNode","AcosNode","AtanNode","SinhNode","CoshNode","TanhNode","LogNode","QrotNode","c1","BinaryNode","arg1","arg2","_arg1","_arg2","PwrNode","CatNode","withRows","c2","AddNode","SubNode","MulNode","withTypeOf","DivNode","TraceNode","NormaNode","CylNode","SphereNode","Cyl1Node","Sphere1Node","InverseNode","DetNode","MinNode","MaxNode","DefaultNode","UnaryFunctions","T","inv","lexer","addRule","_token","_lexer","msg","discard","setSource","parseExp","token","addError","parseSum","parseFactor","parseUnary","nodeGen","parsePwr","baseNode","parseTerm","expNode","expected","PI","E","baseExp","parseInt","identExp","handleId","lex","ns","uuidv5","URL","DefsPanel","state","deleteModalShown","newName","panelKey","newConf","createDefs","showOptionPanel","deleteDefs","action","setState","modalTitle","modalMessage","optionAction","hideOptionPanel","flatMap","newNameError","fieldList","toPairs","sortBy","key","hasNewNameError","Accordion","defaultActiveKey","Card","Toggle","as","eventKey","Collapse","controlId","onName","onAdd","disabled","faPlus","BodyRow","modalShown","rotField","onChangeRotation","deleteRotation","onAddRotation","onChangePosition","onDeleteRow","BodiesPanel","confirmAction","createBodies","deleteBody","splice","e","Table","striped","scope","Editor","createConf","noValidate","onBodiesChange","panelId","fromHeat","s","hc","Red","White","fromHSB","Leibniz","options","_options","defaults","cameraType","cameraPosition","cameraMinZ","ambientColor","sunLightDirection","sunLightIntensity","subSteps","_subSteps","camera","setTarget","Zero","angularSensibility","moveSensibility","setPosition","minZ","createCamera","attachControl","intensity","_state","next","onBeforeStepObservable","getAnimationRatio","refreshTime","runRenderLoop","refreshScene","render","_shapes","updateShape","shape","pos","rot","FromArray","rotationQuaternion","removeMesh","shapes","color","hsb","CreatePolyhedron","sizeX","sizeY","sizeZ","material","diffuseColor","createOcta","CreateIcoSphere","flat","radius","subdivisions","updatable","Test","createNewState","JSON","stringify","initialConf","cfg","toString","Label","componentClass","placeholder","onInput","Static","ImportFile","file","onFileRead","onError","fr","FileReader","onload","onerror","event","readAsText","File","label","custom","onFileChange","files","DumpPanel","counts","dtString","countsString","parseFloat","sys","dumpTable","dumpWithDt","keys","header","blob","Blob","saveAs","dumpDisabled","Container","Row","inline","setCounts","setDt","dumpData","LbNavBar","onReset","onLoad","onImport","onExport","Navbar","bg","expand","Brand","href","aria-controls","Nav","Link","process","NavDropdown","Item","onSelect","LbAlert","isVisible","onClose","Alert","dismissible","Heading","App","leibniz","cfgCookie","Cookies","alertShow","importModalShown","processConf","init","reset","load","optionTitle","optionMessage","optionConfirmBtn","optionConfirm","optionShow","alertTitle","alertMessage","url","ajax","getJSON","pipe","tap","json","onLoaded","onLoadError","subscribe","xhr","status","statusText","showAlert","Tab","content","hideAlert","hideImportPanel","exportFile","fluid","showImportPanel","showExportPanel","Tabs","FormGroup","FormControl","setSubSteps","importFile","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.8910d021.chunk.js","sourcesContent":["import React from 'react';\nimport * as BABYLON from 'babylonjs';\n\nexport class BabylonScene extends React.Component {\n\n  componentDidMount() {\n    this.engine = new BABYLON.Engine(this.canvas, true,\n      {\n        deterministicLockstep: true,\n        lockstepMaxSteps: 4\n      });\n\n    const scene = new BABYLON.Scene(this.engine);\n    this.scene = scene;\n\n    if (typeof this.props.onSceneMount === 'function') {\n      this.props.onSceneMount({\n        scene: scene,\n        engine: this.engine,\n        canvas: this.canvas\n      });\n    } else {\n      console.error('onSceneMount function not available');\n    }\n\n    // Resize the babylon engine when the window is resized\n    window.addEventListener('resize', this.onResizeWindow);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('resize', this.onResizeWindow);\n  }\n\n  onResizeWindow = () => {\n    if (this.engine) {\n      this.engine.resize();\n    }\n  }\n\n  onCanvasLoaded(c) {\n    if (c !== null) {\n      this.canvas = c;\n    }\n  }\n\n  render() {\n    return (\n      <canvas className={this.props.canvasClass} ref={(c) => this.onCanvasLoaded(c)} />\n    );\n  }\n}\n","import React, { FunctionComponent } from 'react';\nimport { InputGroup, Button, Form } from 'react-bootstrap';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faTrash } from '@fortawesome/free-solid-svg-icons'\nimport { Expression } from './Definitions';\n\nexport const ExprField: FunctionComponent<{\n  name: string;\n  expr: Expression;\n  errors?: string[];\n  withoutDelete?: boolean;\n  onChange?: (arg: Expression) => void;\n  onDelete?: () => void;\n}> = ({ name, expr, errors = [], withoutDelete = false, onDelete, onChange }) => {\n  const hasErrors = errors.length > 0;\n  const errorItems = errors.map((text, idx) => (<li key={idx}>{text}</li>));\n\n  const deleteBtn = !withoutDelete ?\n    (<InputGroup.Append>\n      <Button variant=\"danger\"\n        onClick={() => { if (onDelete) { onDelete() } }}>\n        <FontAwesomeIcon icon={faTrash} />\n      </Button>\n    </InputGroup.Append>)\n    : '';\n\n  return (\n    <Form.Group >\n      <InputGroup size=\"sm\" >\n        <InputGroup.Prepend>{name}</InputGroup.Prepend>\n        <Form.Control type=\"text\"\n          value={expr}\n          // onInput={(ev) => { if (onChange) { onChange(ev.target.value); } }}\n          onChange={(ev) => { if (onChange) { onChange(ev.target.value); } }}\n          isValid={!hasErrors}\n          isInvalid={!!hasErrors} />\n        {deleteBtn}\n        <Form.Control.Feedback type=\"invalid\">\n          <ul>{errorItems}</ul>\n        </Form.Control.Feedback>\n      </InputGroup>\n    </Form.Group >\n  );\n}\n","import React, { FunctionComponent } from 'react';\nimport { Modal, Button } from 'react-bootstrap';\n\n/**\n * \n * @param param0 \n */\nexport const OptionPanel: FunctionComponent<{\n  show: boolean;\n  title?: string;\n  message?: string;\n  confirmButton: string;\n  onCancel?: () => void;\n  onConfirm?: () => void;\n}> = ({ show, title, message, confirmButton, onCancel, onConfirm }) => {\n\n  return (\n    <Modal show={show}\n      size=\"sm\"\n      onHide={() => { if (onCancel) { onCancel(); } }}>\n      <Modal.Header closeButton>\n        <Modal.Title>{title}</Modal.Title>\n      </Modal.Header>\n      <Modal.Body>{message}</Modal.Body>\n      <Modal.Footer>\n        <Button variant=\"primary\" onClick={() => { if (onCancel) { onCancel(); } }}>Cancel</Button>\n        <Button variant=\"danger\" onClick={() => { if (onConfirm) { onConfirm(); } }}>{confirmButton}</Button>\n      </Modal.Footer>\n    </Modal>\n  );\n}\n","import { default as _ } from 'lodash';\n\nfunction assert(condition, message) {\n    if (!condition) {\n        throw new Error(message || 'Assert failed');\n    }\n}\n\nexport class Quaternion {\n    constructor(values) {\n        assert(values.length === 4,\n            'Assert failed: (values.length === 4), values.length=' + values.length)\n        this._values = values;\n    }\n\n    get values() { return this._values; }\n    get i() { return this._values[0]; }\n    get j() { return this._values[1]; }\n    get k() { return this._values[2]; }\n    get w() { return this._values[3]; }\n\n    toString() {\n        return '(' + this.i + '*i+' + this.j + '*j+' + this.k + '*k+' + this.w + ')';\n    }\n\n    /* Returns the negate quaternion */\n    negate() {\n        return new Quaternion(_.map(this.values, a => -a));\n    }\n\n    /* Returns the quaternion by adding another quaternion */\n    add(other) {\n        const values = _(this.values).zip(other.values).map(ary => _.sum(ary)).value();\n        return new Quaternion(values);\n    }\n\n    /* Returns the quaternion by adding a real value */\n    addValue(other) {\n        return new Quaternion([this.i, this.j, this.k, this.w + other]);\n    }\n\n    /* Returns the quaternion by subtracting a real value */\n    subtractValue(other) {\n        return new Quaternion([this.i, this.j, this.k, this.w - other]);\n    }\n\n    /* Returns the quaternion by subtracting a real value from this */\n    subtractFromValue(other) {\n        return new Quaternion([-this.i, -this.j, -this.k, other - this.w]);\n    }\n\n    /* Returns the quaternion by subtracting another quaternion */\n    subtract(other) {\n        const values = _(this.values).zip(other.values).map(ary => ary[0] - ary[1]).value();\n        return new Quaternion(values);\n    }\n\n    /* Returns the quaternion by multipling a real */\n    scale(scale) {\n        const values = _.map(this.values, x => x * scale);\n        return new Quaternion(values);\n    }\n\n    /* Returns the quaternion by multipling another quaternion */\n    multiply(other) {\n        const ai = this.i;\n        const aj = this.j;\n        const ak = this.k;\n        const a = this.w;\n        const bi = other.i;\n        const bj = other.j;\n        const bk = other.k;\n        const b = other.w;\n\n        // ii = jj = kk = -1\n        // ij = k\n        // jk = i\n        // ki = j\n        const ci = a * bi + ai * b + aj * bk - ak * bj;\n        const cj = a * bj + aj * b + ak * bi - ai * bk;\n        const ck = a * bk + ak * b + ai * bj - aj * bi;\n        const c = a * b - ai * bi - aj * bj - ak * bk;\n        return new Quaternion([ci, cj, ck, c]);\n    }\n\n    inverse() {\n        const i = this.i;\n        const j = this.j;\n        const k = this.k;\n        const w = this.w;\n        const l = i * i + j * j + k * k + w * w;\n\n        return new Quaternion([-i / l, -j / l, -k / l, w / l]);\n    }\n\n    divide(other) {\n        const ai = this.i;\n        const aj = this.j;\n        const ak = this.k;\n        const aw = this.w;\n\n        const bi = other.i;\n        const bj = other.j;\n        const bk = other.k;\n        const bw = other.w;\n        const l = bi * bi + bj * bj + bk * bk + bw * bw;\n\n        const ci = (-aw * bi + ai * bw - aj * bk + ak * bj) / l;\n        const cj = (-aw * bj + aj * bw - ak * bi + ai * bk) / l;\n        const ck = (-aw * bk + ak * bw - ai * bj + aj * bi) / l;\n        const cw = (aw * bw + ai * bi + aj * bj + ak * bk) / l;\n\n        return new Quaternion([ci, cj, ck, cw]);\n    }\n\n    module() {\n        const ai = this.i;\n        const aj = this.j;\n        const ak = this.k;\n        const aw = this.w;\n        return Math.sqrt(ai * ai + aj * aj + ak * ak + aw * aw);\n    }\n\n    norma() {\n        const ai = this.i;\n        const aj = this.j;\n        const ak = this.k;\n        const aw = this.w;\n        const mod = Math.sqrt(ai * ai + aj * aj + ak * ak + aw * aw);\n\n        if (mod > Number.MIN_VALUE) {\n            return new Quaternion([ai / mod, aj / mod, ak / mod, aw / mod]);\n        } else {\n            return new Quaternion([0, 0, 0, 1]);\n        }\n    }\n}\n\nexport class Matrix {\n    constructor(values) {\n        this._values = values;\n    }\n    get values() { return this._values; }\n    get rows() { return this.values.length; }\n    get cols() { return this.values.length > 0 ? this.values[0].length : 0; }\n\n    toString() {\n        const rows = _(this.values).map((row) =>\n            '[' + _.reduce(row, (a, b) => a + ',' + b) + ']'\n        ).reduce((a, b) => a + ',' + b);\n        return '[' + rows + ']';\n    }\n\n    map(f) {\n        const v = _.map(this.values, (row, i) =>\n            _.map(row, (value, j) =>\n                f(value, i, j))\n        );\n        return new Matrix(v);\n    }\n\n    trace() {\n        const n = Math.min(this.rows, this.cols);\n        var trace = 0;\n        for (var i = 0; i < n; i++) {\n            trace += this.values[i][i];\n        }\n        return trace;\n    }\n\n    /* Returns the negate matrix */\n    negate() {\n        return this.map(a => -a);\n    }\n\n    zipMap(other, f) {\n        assert(this.rows === other.rows && this.cols === other.cols,\n            'Assert failed: (this.rows === other.rows && this.cols === other.cols), this.rows=' + this.rows\n            + ',other.rows=' + other.rows\n            + ',this.cols=' + this.cols\n            + ',other.cols=' + other.cols);\n\n        const v = _.map(this.values, (row, i) =>\n            _.map(row, (value, j) =>\n                f(value, other.values[i][j], i, j))\n        );\n        return new Matrix(v);\n    }\n\n    /* Returns the matrix by adding the paramter */\n    add(other) {\n        return this.zipMap(other, _.add);\n    }\n\n    /* Returns the matrix by subtracting the paramter */\n    subtract(other) {\n        return this.zipMap(other, _.subtract);\n    }\n\n    /* Returns a scaled matrix */\n    scale(scale) {\n        return this.map(a => {\n            return a * scale\n        });\n    }\n\n    /* Returns a scaled matrix */\n    divide(scale) {\n        return this.map(a => a / scale);\n    }\n\n    /* Returns a resized Matrix the filler element is 0 */\n    resize(rows, cols) {\n        const n = this.rows;\n        const m = this.cols;\n        const partRows = _(this.values)\n            .take(Math.min(n, rows))\n            .map(row => {\n                const col = _.take(row, Math.min(m, cols));\n                for (var i = 0; i < cols - m; i++) {\n                    col.push(0);\n                }\n                return col;\n            }).value();\n        const appendRows = rows > n ?\n            _.map(_.range(rows - n), () =>\n                _.map(_.range(cols), () => 0))\n            : [];\n        const res = _.concat(partRows, appendRows);\n        return new Matrix(res);\n    }\n\n    transpose() {\n        const n = this.rows;\n        const m = this.cols;\n        const v = new Array(m);\n        for (var i = 0; i < m; i++) {\n            v[i] = Array(n);\n            for (var j = 0; j < n; j++) {\n                v[i][j] = this.values[j][i];\n            }\n        }\n        return new Matrix(v);\n    }\n\n    multiply(other) {\n        assert(this.cols === other.rows,\n            'Assert failed: (this.cols === other.rows), this.cols=' + this.cols\n            + ',other.rows=' + other.rows);\n\n        const n = this.rows;\n        const m = other.cols;\n        const l = this.cols;\n        const v = new Array(n);\n        for (var i = 0; i < n; i++) {\n            v[i] = Array(m);\n            for (var j = 0; j < m; j++) {\n                var acc = 0;\n                for (var k = 0; k < l; k++) {\n                    acc += this.values[i][k] * other.values[k][j];\n                }\n                v[i][j] = acc;\n            }\n        }\n        return new Matrix(v);\n    }\n\n    append(other) {\n        assert(this.rows === other.rows,\n            'Assert failed: (this.rows === other.rows), this.rows=' + this.rows\n            + ',other.rows=' + other.rows);\n\n        const n = this.rows;\n        const m = this.cols;\n        const l = other.cols;\n        const v = new Array(n);\n        for (var i = 0; i < n; i++) {\n            v[i] = Array(m + l);\n            for (var j = 0; j < m + l; j++) {\n                v[i][j] = j < m ? this.values[i][j] : other.values[i][j - m];\n            }\n        }\n        return new Matrix(v);\n    }\n\n    insertAt(idx, value) {\n        assert(this.cols === 1,\n            'Assert failed: (this.cols === 1), this.cols=' + this.cols);\n        assert(idx >= 0 && idx <= this.rows,\n            'Assert failed: (idx >= 0 && idx <= this.rows), idx=' + idx + ', this.cols=' + this.cols);\n\n        const n = this.rows;\n        const v = new Array(n + 1);\n        for (var i = 0; i <= n; ++i) {\n            v[i] = i < idx\n                ? this.values[i]\n                : i === idx\n                    ? [value] : this.values[i - 1];\n        }\n        return new Matrix(v);\n    }\n\n    qrot() {\n        assert(this.rows === 3 && this.cols === 1,\n            'Assert failed: (this.rows === 3 && this.cols === 1), this.rows=' + this.rows\n            + ', this.cols=' + this.cols);\n        const x = this.values[0][0];\n        const y = this.values[1][0];\n        const z = this.values[2][0];\n        const len = Math.sqrt(x * x + y * y + z * z);\n        if (len > Number.MIN_VALUE) {\n            const hphi = len / 2.;\n            const w = Math.cos(hphi);\n            const sa = Math.sin(hphi);\n            const i = sa * x / len;\n            const j = sa * y / len;\n            const k = sa * z / len;\n            return new Quaternion([i, j, k, w]);\n        } else {\n            return new Quaternion([0, 0, 0, 1]);\n        }\n    }\n\n    cyl() {\n        assert(this.rows === 3 && this.cols === 1,\n            'Assert failed: (this.rows === 3 && this.cols === 1), this.rows=' + this.rows\n            + ', this.cols=' + this.cols);\n        const r = this.values[0][0];\n        const phi = this.values[1][0];\n        const z = this.values[2][0];\n        return new Matrix([\n            [r * Math.sin(phi)],\n            [r * Math.cos(phi)],\n            [z]\n        ]);\n    }\n\n    sphere() {\n        assert(this.rows === 3 && this.cols === 1,\n            'Assert failed: ((this.rows === 3 && this.cols === 1), this.rows=' + this.rows\n            + ',this.cols=' + this.cols);\n        const r = this.values[0][0];\n        const theta = this.values[1][0];\n        const phi = this.values[2][0];\n        const rr = r * Math.sin(theta);\n        return new Matrix([\n            [rr * Math.cos(phi)],\n            [rr * Math.sin(phi)],\n            [r * Math.cos(theta)]\n        ]);\n    }\n\n    cyl1() {\n        assert(this.rows === 3 && this.cols === 1,\n            'Assert failed: (this.rows === 3 && this.cols === 1), this.rows=' + this.rows\n            + ', this.cols=' + this.cols);\n        const r = this.values[0][0];\n        const phi = this.values[1][0];\n        // const z = this.values[2][0];\n        const sin = Math.sin(phi);\n        const cos = Math.cos(phi);\n        return new Matrix([\n            [cos, -r * sin, 0],\n            [sin, r * cos, 0],\n            [0, 0, 1]\n        ]);\n    }\n\n    sphere1() {\n        assert(this.rows === 3 && this.cols === 1,\n            'Assert failed: (this.rows === 3 && this.cols === 1), this.rows=' + this.rows\n            + ', this.cols=' + this.cols);\n\n        const r = this.values[0][0];\n        const theta = this.values[1][0];\n        const phi = this.values[2][0];\n        const sint = Math.sin(theta);\n        const cost = Math.cos(theta);\n        const sinp = Math.sin(phi);\n        const cosp = Math.cos(phi);\n        const sincos = sint * cosp;\n        const sinsin = sint * sinp;\n        const coscos = cost * cosp;\n        return new Matrix([\n            [sincos, r * coscos, -r * sinsin],\n            [sinsin, r * cost * cosp, r * sincos],\n            [cost, -r * sint, 0]\n        ]);\n    }\n\n    inverse() {\n        const { enchelon } = this.gaussJordan();\n        const n = this.rows;\n        const inv = _.map(enchelon, row => _.drop(row, n));\n        return new Matrix(inv);\n    }\n\n    det() {\n        const { det } = this.gaussJordan();\n        return det;\n    }\n\n    gaussJordan() {\n        assert(this.rows === this.cols,\n            'Assert failed: (this.rows === this.cols), this.rows=' + this.rows\n            + ', this.cols=' + this.cols);\n        const n = this.rows;\n        const mtx = Array(n);\n        for (var i = 0; i < n; i++) {\n            mtx[i] = Array(2 * n);\n        }\n        for (i = 0; i < n; i++) {\n            for (var j = 0; j < n; j++) {\n                mtx[i][j] = this.values[i][j];\n                mtx[i][j + n] = i === j ? 1 : 0;\n            }\n        }\n        var det = 1;\n        var h = 0; // pivot row\n        var k = 0; // pivot col\n        while (h < n && k < n) {\n            // Find pivot row\n            var imax = h;\n            var max = Math.abs(mtx[h][k]);\n            for (i = h + 1; i < n; i++) {\n                const mx = Math.abs(mtx[i][k]);\n                if (mx > max) {\n                    imax = i;\n                    max = mx;\n                }\n            }\n            if (max === 0) {\n                /* No pivot in this column, pass to next column */\n                k++;\n            } else {\n                //Swap row imax, h\n                const tr = mtx[imax];\n                mtx[imax] = mtx[h];\n                mtx[h] = tr;\n                det = -det;\n\n                for (i = h + 1; i < n; i++) {\n                    const f = mtx[i][k] / mtx[h][k];\n                    mtx[i][k] = 0;\n                    /* Do for all remaining elements in current row: */\n                    for (j = k + 1; j < 2 * n; j++) {\n                        mtx[i][j] -= mtx[h][j] * f;\n                    }\n                }\n                h++;\n                k++;\n            }\n        }\n        // Inverse matrix does not exist\n        assert(h === k, 'Inverse matrix does not exist');\n        // Reverse\n        for (h = n - 1; h >= 0; h--) {\n            for (i = 0; i < h; i++) {\n                // mtx[i][j] = mtx[i][j] + mtx[h][j] * f;\n                // mtx[i][h] + mtx[h][h] * f = 0\n                //f = -mtx[i][h]/mtx[h][h];\n                const f = mtx[i][h] / mtx[h][h];\n                mtx[i][h] = 0;\n                for (j = h + 1; j < 2 * n; j++) {\n                    // mtx[i][h] = 0 = mtx[i][h] - mtx[h][j] * f;\n                    mtx[i][j] -= mtx[h][j] * f;\n                }\n            }\n            for (j = h + 1; j < 2 * n; j++) {\n                mtx[h][j] /= mtx[h][h];\n            }\n            det *= mtx[h][h];\n            mtx[h][h] = 1;\n        }\n        return {\n            enchelon: mtx,\n            det: det\n        };\n    }\n\n    min() {\n        return _(this.values).map(row => _(row).min()).min();\n    }\n\n    max() {\n        return _(this.values).map(row => _(row).max()).max();\n    }\n}\n\nfunction createField(value) {\n    return {\n        apply: () => value,\n        code: [\"value \" + value]\n    };\n}\n\nfunction createQuaternion(value) {\n    return {\n        apply: () => new Quaternion(value),\n        code: [\"quat \" + value]\n    };\n}\n\nfunction createVector(values) {\n    const v = _.map(values, x => [x]);\n    return {\n        apply: () => new Matrix(v),\n        code: ['vector ' + values]\n    };\n}\nfunction createMatrix(values) {\n    return {\n        apply: () => new Matrix(values),\n        code: ['matrix ' + values]\n    };\n}\nfunction createRef(id) {\n    return {\n        apply: (context) => context.resolve(id),\n        code: ['ref ' + id]\n    };\n}\nfunction createQrot(code) {\n    return {\n        apply: (context) => code.apply(context).qrot(),\n        code: _.concat(code.code, ['qrot'])\n    };\n}\nfunction createField2Quat(code) {\n    return {\n        apply: (context) => new Quaternion([0, 0, 0, code.apply(context)]),\n        code: _.concat(code.code, ['value to quat'])\n    };\n}\nfunction createNegateField(code) {\n    return {\n        apply: (context) => -code.apply(context),\n        code: _.concat(code.code, ['negate value'])\n    };\n}\nfunction createNegateQuat(code) {\n    return {\n        apply: (context) => code.apply(context).negate(),\n        code: _.concat(code.code, ['negate quaternion'])\n    };\n}\nfunction createNegateVector(code) {\n    return {\n        apply: (context) => code.apply(context).negate(),\n        code: _.concat(code.code, ['negate vector'])\n    };\n}\nfunction createNegateMatrix(code) {\n    return {\n        apply: (context) => code.apply(context).negate(),\n        code: _.concat(code.code, ['negate matrix'])\n    };\n}\nfunction createProduct(op1, op2) {\n    return {\n        apply: (context) => op1.apply(context) * op2.apply(context),\n        code: _.concat(op1.code, op2.code, ['multiply value'])\n    };\n}\nfunction createProductQuat(op1, op2) {\n    return {\n        apply: (context) =>\n            op1.apply(context).multiply(op2.apply(context)),\n        code: _.concat(op1.code, op2.code, ['multiply quat'])\n    };\n}\nfunction createQuatModule(code) {\n    return {\n        apply: (context) => code.apply(context).module(),\n        code: _.concat(code.code, ['quat module'])\n    };\n}\nfunction createScaleQuat(quat, scale) {\n    return {\n        apply: (context) =>\n            quat.apply(context).scale(scale.apply(context)),\n        code: _.concat(quat.code, scale.code, ['scale quat'])\n    };\n}\nfunction createScaleVector(vec, scale) {\n    return {\n        apply: (context) =>\n            vec.apply(context).scale(scale.apply(context)),\n        code: _.concat(vec.code, scale.code, ['scale vector'])\n    };\n}\nfunction createScaleMatrix(mat, scale) {\n    return {\n        apply: (context) =>\n            mat.apply(context).scale(scale.apply(context)),\n        code: _.concat(mat.code, scale.code, ['scale matrix'])\n    };\n}\nfunction createScalarProduct(op1, op2) {\n    return {\n        apply: (context) =>\n            op1.apply(context).transpose().multiply(op2.apply(context)),\n        code: _.concat(op1.code, op2.code, ['multiply vector'])\n    };\n}\nfunction createMatrixVectorProduct(mat, vec) {\n    return {\n        apply: (context) =>\n            mat.apply(context).multiply(vec.apply(context)),\n        code: _.concat(mat.code, vec.code, ['multiply matrix by vector'])\n    };\n}\nfunction createMatrixProduct(op1, op2) {\n    return {\n        apply: (context) =>\n            op1.apply(context).multiply(op2.apply(context)),\n        code: _.concat(op1.code, op2.code, ['multiply matrix'])\n    };\n}\nfunction createResizeVector(op, rows) {\n    return {\n        apply: (context) =>\n            op.apply(context).resize(rows, 1),\n        code: _.concat(op.code, ['resize vector to ' + rows])\n    };\n}\nfunction createResizeMatrix(op, rows, cols) {\n    return {\n        apply: (context) =>\n            op.apply(context).resize(rows, cols),\n        code: _.concat(op.code, ['resize matrix to ' + rows + ',' + cols])\n    };\n}\nfunction createVectorModule(op) {\n    return {\n        apply: (context) => {\n            const v = op.apply(context);\n            return Math.sqrt(v.transpose().multiply(v).values[0][0]);\n        },\n        code: _.concat(op.code, ['vect module'])\n    };\n}\nfunction createDivideField(op1, op2) {\n    return {\n        apply: (context) =>\n            op1.apply(context) / op2.apply(context),\n        code: _.concat(op1.code, op2.code, ['divide value'])\n    };\n}\nfunction createDivideVector(op1, op2) {\n    return {\n        apply: (context) =>\n            op1.apply(context).divide(op2.apply(context)),\n        code: _.concat(op1.code, op2.code, ['divide vector'])\n    };\n}\nfunction createDivideMatrix(op1, op2) {\n    return {\n        apply: (context) =>\n            op1.apply(context).divide(op2.apply(context)),\n        code: _.concat(op1.code, op2.code, ['divide matrix'])\n    };\n}\nfunction createSumField(op1, op2) {\n    return {\n        apply: (context) =>\n            op1.apply(context) + op2.apply(context),\n        code: _.concat(op1.code, op2.code, ['add value'])\n    };\n}\nfunction createSumQuatField(op1, op2) {\n    return {\n        apply: (context) =>\n            op1.apply(context).addValue(op2.apply(context)),\n        code: _.concat(op1.code, op2.code, ['add quat value'])\n    };\n}\nfunction createSumQuat(op1, op2) {\n    return {\n        apply: (context) =>\n            op1.apply(context).add(op2.apply(context)),\n        code: _.concat(op1.code, op2.code, ['add quat'])\n    };\n}\nfunction createSubFieldQuat(op1, op2) {\n    return {\n        apply: (context) =>\n            op2.apply(context).subtractFromValue(op1.apply(context)),\n        code: _.concat(op1.code, op2.code, ['sub value quat'])\n    };\n}\nfunction createSubQuatField(op1, op2) {\n    return {\n        apply: (context) =>\n            op1.apply(context).subtractValue(op2.apply(context)),\n        code: _.concat(op1.code, op2.code, ['sub quat value'])\n    };\n}\nfunction createSubQuat(op1, op2) {\n    return {\n        apply: (context) =>\n            op1.apply(context).subtract(op2.apply(context)),\n        code: _.concat(op1.code, op2.code, ['sub quat'])\n    };\n}\n\nfunction createSumVector(op1, op2) {\n    return {\n        apply: (context) =>\n            op1.apply(context).add(op2.apply(context)),\n        code: _.concat(op1.code, op2.code, ['add vector'])\n    };\n}\nfunction createSumMatrix(op1, op2) {\n    return {\n        apply: (context) =>\n            op1.apply(context).add(op2.apply(context)),\n        code: _.concat(op1.code, op2.code, ['add matrix'])\n    };\n}\nfunction createSubField(op1, op2) {\n    return {\n        apply: (context) => op1.apply(context) - op2.apply(context),\n        code: _.concat(op1.code, op2.code, ['subtrac value'])\n    };\n}\nfunction createSubVector(op1, op2) {\n    return {\n        apply: (context) => op1.apply(context).subtract(op2.apply(context)),\n        code: _.concat(op1.code, op2.code, ['subtract vector'])\n    };\n}\nfunction createSubMatrix(op1, op2) {\n    return {\n        apply: (context) => op1.apply(context).subtract(op2.apply(context)),\n        code: _.concat(op1.code, op2.code, ['subtract matrix'])\n    };\n}\nfunction createPower(op1, op2) {\n    return {\n        apply: (context) => Math.pow(op1.apply(context), op2.apply(context)),\n        code: _.concat(op1.code, op2.code, ['power'])\n    };\n}\nfunction createCatField(op1, op2) {\n    return {\n        apply: (context) => {\n            const a = op1.apply(context);\n            const b = op2.apply(context);\n            return new Matrix([[a], [b]]);\n        },\n        code: _.concat(op1.code, op2.code, ['concat values'])\n    };\n}\nfunction createInsertFieldAt(vec, op2, idx) {\n    return {\n        apply: (context) => {\n            const a = vec.apply(context);\n            const b = op2.apply(context);\n            return a.insertAt(idx, b);\n        },\n        code: _.concat(vec.code, op2.code, ['insert value at ' + idx])\n    };\n}\nfunction createCatVector(op1, op2) {\n    return {\n        apply: (context) => {\n            const a = op1.apply(context);\n            const b = op2.apply(context);\n            return a.append(b);\n        },\n        code: _.concat(op1.code, op2.code, ['concat vectors'])\n    };\n}\nfunction createInsertVector(op1, op2) {\n    return {\n        apply: (context) => {\n            const a = op1.apply(context);\n            const b = op2.apply(context);\n            return b.append(a);\n        },\n        code: _.concat(op1.code, op2.code, ['insert vector'])\n    };\n}\nfunction createAppendVector(op1, op2) {\n    return {\n        apply: (context) => {\n            const a = op1.apply(context);\n            const b = op2.apply(context);\n            return a.append(b);\n        },\n        code: _.concat(op1.code, op2.code, ['append vector'])\n    };\n}\nfunction createAppendMatrix(op1, op2) {\n    return {\n        apply: (context) => {\n            const a = op1.apply(context);\n            const b = op2.apply(context);\n            return a.append(b);\n        },\n        code: _.concat(op1.code, op2.code, ['concat matrix'])\n    };\n}\nfunction createTransposeMatrix(op1) {\n    return {\n        apply: (context) => {\n            const a = op1.apply(context);\n            return a.transpose();\n        },\n        code: _.concat(op1.code, ['transpose'])\n    };\n}\nfunction createSin(code) {\n    return {\n        apply: (context) => Math.sin(code.apply(context)),\n        code: _.concat(code.code, ['sin'])\n    };\n}\nfunction createCos(code) {\n    return {\n        apply: (context) => Math.cos(code.apply(context)),\n        code: _.concat(code.code, ['cos'])\n    };\n}\nfunction createExp(code) {\n    return {\n        apply: (context) => Math.exp(code.apply(context)),\n        code: _.concat(code.code, ['exp'])\n    };\n}\nfunction createSqrt(code) {\n    return {\n        apply: (context) => Math.sqrt(code.apply(context)),\n        code: _.concat(code.code, ['sqrt'])\n    };\n}\nfunction createDivQuatField(op1, op2) {\n    return {\n        apply: (context) => {\n            const a = op1.apply(context);\n            const b = op2.apply(context);\n            return a.scale(1 / b);\n        },\n        code: _.concat(op1.code, op2.code, ['div quat value'])\n    };\n}\nfunction createDivQuat(op1, op2) {\n    return {\n        apply: (context) => {\n            const a = op1.apply(context);\n            const b = op2.apply(context);\n            return a.divide(b)\n        },\n        code: _.concat(op1.code, op2.code, ['div quat'])\n    };\n}\nfunction createTan(code) {\n    return {\n        apply: (context) => Math.tan(code.apply(context)),\n        code: _.concat(code.code, ['tan'])\n    };\n}\nfunction createAsin(code) {\n    return {\n        apply: (context) => Math.asin(code.apply(context)),\n        code: _.concat(code.code, ['asin'])\n    };\n}\nfunction createAcos(code) {\n    return {\n        apply: (context) => Math.acos(code.apply(context)),\n        code: _.concat(code.code, ['acos'])\n    };\n}\nfunction createAtan(code) {\n    return {\n        apply: (context) => Math.atan(code.apply(context)),\n        code: _.concat(code.code, ['atan'])\n    };\n}\nfunction createLog(code) {\n    return {\n        apply: (context) => Math.log(code.apply(context)),\n        code: _.concat(code.code, ['log'])\n    };\n}\nfunction createSinh(code) {\n    return {\n        apply: (context) => Math.sinh(code.apply(context)),\n        code: _.concat(code.code, ['sinh'])\n    };\n}\nfunction createCosh(code) {\n    return {\n        apply: (context) => Math.cosh(code.apply(context)),\n        code: _.concat(code.code, ['cosh'])\n    };\n}\nfunction createTanh(code) {\n    return {\n        apply: (context) => Math.tanh(code.apply(context)),\n        code: _.concat(code.code, ['tanh'])\n    };\n}\nfunction createTrace(code) {\n    return {\n        apply: (context) => code.apply(context).trace(),\n        code: _.concat(code.code, ['trace'])\n    };\n}\nfunction createValueNorma(code) {\n    return {\n        apply: (context) => 1,\n        code: createField(1)\n    };\n}\nfunction createQuatNorma(code) {\n    return {\n        apply: (context) => code.apply(context).norma(),\n        code: _.concat(code.code, ['quatNorma'])\n    };\n}\nfunction createVectNorma(code) {\n    return {\n        apply: (context) => {\n            const v = code.apply(context);\n            const mod = Math.sqrt(v.transpose().multiply(v).values[0][0]);\n            return v.divide(mod);\n        },\n        code: _.concat(code.code, ['vecNorma'])\n    };\n}\n\n// function createVectNorma(code) {\n//     return {\n//         apply: (context) => {\n//             const v = code.apply(context);\n//             const mod = Math.sqrt(v.transpose().multiply(v).values[0][0]);\n//             return v.divide(mod);\n//         },\n//         code: _.concat(code.code, ['vecNorma'])\n//     };\n// }\nfunction createCyl(code) {\n    return {\n        apply: (context) => code.apply(context).cyl(),\n        code: _.concat(code.code, ['cyl'])\n    };\n}\nfunction createSphere(code) {\n    return {\n        apply: (context) => code.apply(context).sphere(),\n        code: _.concat(code.code, ['sphere'])\n    };\n}\nfunction createCyl1(code) {\n    return {\n        apply: (context) => code.apply(context).cyl1(),\n        code: _.concat(code.code, ['cyl1'])\n    };\n}\nfunction createSphere1(code) {\n    return {\n        apply: (context) => code.apply(context).sphere1(),\n        code: _.concat(code.code, ['sphere1'])\n    };\n}\nfunction createValueInverse(code) {\n    return {\n        apply: (context) => 1 / code.apply(context),\n        code: _.concat(code.code, ['inv'])\n    };\n}\nfunction createQuatInverse(code) {\n    return {\n        apply: (context) => code.apply(context).inverse(),\n        code: _.concat(code.code, ['quat inv'])\n    };\n}\nfunction createMatrixInverse(code) {\n    return {\n        apply: (context) => code.apply(context).inverse(),\n        code: _.concat(code.code, ['matrix inv'])\n    };\n}\nfunction createDet(code) {\n    return {\n        apply: (context) => code.apply(context).det(),\n        code: _.concat(code.code, ['det'])\n    };\n}\nfunction createMinVec(code) {\n    return {\n        apply: (context) => code.apply(context).min(),\n        code: _.concat(code.code, ['min vector'])\n    };\n}\nfunction createMinMat(code) {\n    return {\n        apply: (context) => code.apply(context).min(),\n        code: _.concat(code.code, ['min matrix'])\n    };\n}\nfunction createMaxVec(code) {\n    return {\n        apply: (context) => code.apply(context).max(),\n        code: _.concat(code.code, ['max vector'])\n    };\n}\nfunction createMaxMat(code) {\n    return {\n        apply: (context) => code.apply(context).max(),\n        code: _.concat(code.code, ['max matrix'])\n    };\n}\nfunction createAbs(code) {\n    return {\n        apply: (context) => Math.abs(code.apply(context)),\n        code: _.concat(code.code, ['module'])\n    };\n}\n\nexport const OpTreeBuilder = {\n    createDet: createDet,\n    createMatrixInverse: createMatrixInverse,\n    createQuatInverse: createQuatInverse,\n    createValueInverse: createValueInverse,\n    createSphere1: createSphere1,\n    createCyl1: createCyl1,\n    createSphere: createSphere,\n    createCyl: createCyl,\n    createValueNorma: createValueNorma,\n    createQuatNorma: createQuatNorma,\n    createVectNorma: createVectNorma,\n    createTrace: createTrace,\n    createSinh: createSinh,\n    createCosh: createCosh,\n    createTanh: createTanh,\n    createLog: createLog,\n    createAtan: createAtan,\n    createAcos: createAcos,\n    createAsin: createAsin,\n    createTan: createTan,\n    createField: createField,\n    createQuaternion: createQuaternion,\n    createVector: createVector,\n    createMatrix: createMatrix,\n    createRef: createRef,\n    createQrot: createQrot,\n    createNegateField: createNegateField,\n    createNegateQuat: createNegateQuat,\n    createNegateVector: createNegateVector,\n    createNegateMatrix: createNegateMatrix,\n    createProduct: createProduct,\n    createScaleVector: createScaleVector,\n    createScaleMatrix: createScaleMatrix,\n    createScalarProduct: createScalarProduct,\n    createMatrixVectorProduct: createMatrixVectorProduct,\n    createMatrixProduct: createMatrixProduct,\n    createResizeVector: createResizeVector,\n    createResizeMatrix: createResizeMatrix,\n    createVectorModule: createVectorModule,\n    createDivideField: createDivideField,\n    createDivideVector: createDivideVector,\n    createDivideMatrix: createDivideMatrix,\n    createSumField: createSumField,\n    createSumVector: createSumVector,\n    createSumMatrix: createSumMatrix,\n    createSubField: createSubField,\n    createSubVector: createSubVector,\n    createSubMatrix: createSubMatrix,\n    createPower: createPower,\n    createCatField: createCatField,\n    createInsertFieldAt: createInsertFieldAt,\n    createCatVector: createCatVector,\n    createInsertVector: createInsertVector,\n    createAppendVector: createAppendVector,\n    createAppendMatrix: createAppendMatrix,\n    createTransposeMatrix: createTransposeMatrix,\n    createSin: createSin,\n    createCos: createCos,\n    createExp: createExp,\n    createQuatModule: createQuatModule,\n    createSumQuatField: createSumQuatField,\n    createSumQuat: createSumQuat,\n    createSubFieldQuat: createSubFieldQuat,\n    createSubQuatField: createSubQuatField,\n    createSubQuat: createSubQuat,\n    createField2Quat: createField2Quat,\n    createScaleQuat: createScaleQuat,\n    createProductQuat: createProductQuat,\n    createDivQuatField: createDivQuatField,\n    createDivQuat: createDivQuat,\n    createSqrt: createSqrt,\n    createMinVec: createMinVec,\n    createMinMat: createMinMat,\n    createMaxVec: createMaxVec,\n    createMaxMat: createMaxMat,\n    createAbs: createAbs\n};\n","import { default as _ } from 'lodash';\nimport { OpTreeBuilder } from './tensor-0.1.3';\n\nconst NumberToken = 'Number';\nconst IdToken = 'Identifier';\nconst SymbolToken = 'Symbol';\nconst Lexer = require('flex-js');\n\nconst IdentifierRegex = /[a-zA-Z_][a-zA-Z0-9_]*/;\nconst SingleIdentifierRegex = /^[a-zA-Z_][a-zA-Z0-9_]*$/;\nconst NumberRegex = /\\d+\\.?\\d*/;\nconst ExpNumberRegex = /\\d+\\.?\\d*[eE][+-]?\\d+/;\n\nconst ReservedKeywordsRegex = /^i$|^j$|^k$|^I\\d+$|^dt$|^ex$|^ey$|^ez$|^e\\d+$|^tr$|^det$|^n$|^T$|^inv$|^exp$|^sinh$|^cosh$|^tanh$|^sin$|^cos$|^tan$|^asin$|^acos$|^atan$|^log$|^sqrt$|^cyl$|^sphere$|^cyl1$|^sphere1$|^qrot$|^e$|^PI$|^min$|^max$/;\n\nfunction createMissingReferenceResult(id) {\n    return new CodeResult(FieldType, 0, 0, [OpTreeBuilder.createField(0)], ['Unresolved reference ' + id]);\n}\n\nexport function checkForIdentifier(name) {\n    if (!name.match(SingleIdentifierRegex)) {\n        return 'Name \"' + name + '\" must be an identifier';\n    } else if (name.match(ReservedKeywordsRegex)) {\n        return 'Name \"' + name + '\" must not be a reserved keyword';\n    } else {\n        return null;\n    }\n}\n\nclass Builder {\n    constructor(conf) {\n        this._conf = conf;\n    }\n\n    build() {\n        this._defs = {\n            vars: {},\n            funcs: {}\n        };\n        _.each(this._conf.funcs, (data, ref) => {\n            this.buildRef(ref);\n        });\n        _.each(this._conf.vars, (data, ref) => {\n            this.buildRef(ref);\n        });\n\n        _.each(this._conf.funcs, (data, ref) => {\n            const defs = this._defs.funcs[ref];\n            data.errors = defs ? _.concat(data.errors, defs.errors) : data.errors;\n            data.result = defs;\n        });\n        _.each(this._conf.vars, (data, ref) => {\n            const defs = this._defs.vars[ref];\n            data.errors = defs ? _.concat(data.errors, defs.errors) : data.errors;\n            data.result = defs;\n        });\n        _.each(this._conf.update, (data, ref) => {\n            const defs = this.buildExp(data.node);\n            data.errors = defs ? _.concat(data.errors, defs.errors) : data.errors;\n            data.result = defs;\n        });\n        _.each(this._conf.bodies, (data, ref) => {\n            const defs = this.buildExp(data.position.node);\n            data.position.errors = defs ? _.concat(data.position.errors, defs.errors) : data.position.errors;\n            data.position.result = defs;\n            if (data.rotation) {\n                const defs = this.buildExp(data.rotation.node);\n                data.rotation.errors = defs ? _.concat(data.rotation.errors, defs.errors) : data.rotation.errors;\n                data.rotation.result = defs;\n            }\n        });\n        return this._conf;\n    }\n\n    buildRef(ref) {\n        // Check if already validated\n        const def = this._defs.funcs[ref] || this._defs.vars[ref];\n        if (def) {\n            return def;\n        }\n        const varDef = this._conf.vars[ref];\n        const funcDef = this._conf.funcs[ref];\n        if (funcDef) {\n            this._defs.funcs[ref] = CircularResferenceResult;\n            this._defs.funcs[ref] = this.buildExp(funcDef.node);\n            return this._defs.funcs[ref];\n        } else if (varDef) {\n            this._defs.vars[ref] = CircularResferenceResult;\n            this._defs.vars[ref] = this.buildExp(varDef.node);\n            return this._defs.vars[ref];\n        } else {\n            return createMissingReferenceResult(ref);\n        }\n    }\n\n    buildExp(node) {\n        return node.build(this);\n    }\n}\n\nclass System {\n    constructor(vars, funcs, update, bodies) {\n        this._vars = vars;\n        this._funcs = funcs;\n        this._update = update;\n        this._bodies = bodies;\n    }\n\n\n    next(dt) {\n        return this.withDt(dt).nextState();\n    }\n\n    nextState() {\n        const vars = _.mapValues(this._vars, (value, ref) => {\n            const update = this._update[ref];\n            return update ? update.apply(this) : value;\n        });\n        return new System(vars, this._funcs, this._update, this._bodies);\n    }\n\n    withDt(dt) {\n        const funcs = _.cloneDeep(this._funcs);\n        funcs.dt = OpTreeBuilder.createField(dt);\n        return new System(this._vars, funcs, this._update, this._bodies);\n    }\n\n    resolve(id) {\n        const funcCode = this._funcs[id];\n        if (funcCode) {\n            return funcCode.apply(this);\n        }\n        return this._vars[id];\n    }\n\n    get bodies() {\n        return _.map(this._bodies, data => {\n            const result = {\n                position: data.position.apply(this)\n            };\n            if (data.rotation) {\n                result.rotation = data.rotation.apply(this);\n            }\n            return result;\n        });\n    }\n\n    dump() {\n        const funcs = _.mapValues(this._funcs, func => func.apply(this));\n        return _.assign(funcs, this._vars);\n    }\n\n    dumpWithDt(dt) {\n        return this.withDt(dt).dump();\n    }\n}\n\nexport class SystemParser {\n\n    constructor(config) {\n        this._config = config;\n        this._parserAst = new ParserAst();\n    }\n\n    /* Returns the error report and the initial state of simulated system */\n    parse() {\n        const conf1 = this.parseAll();\n        const conf1_1 = this.checkForNameDefinitions(conf1);\n        const conf2 = this.checkForFunctionsRedefinition(conf1_1);\n        const conf3 = this.checkForUpdateDefinition(conf2);\n        const conf4 = this.build(conf3);\n        const conf5 = this.checkForUpdateTypeDefinition(conf4);\n        const conf = this.checkForBodiesTypeDefinition(conf5);\n\n        const errors = this.createErrors(conf);\n        const system = this.errorCount(conf) === 0 ? this.buildSystem(conf) : undefined;\n        return {\n            parserState: conf,\n            errors: errors,\n            system: system\n        };\n    }\n\n    /* Checks for correct definition names */\n    checkForNameDefinitions(conf) {\n        _(conf.update).each((data, name) => {\n            const err = checkForIdentifier(name);\n            if (err) {\n                data.errors.push(err);\n            }\n        });\n        _(conf.funcs).each((data, name) => {\n            const err = checkForIdentifier(name);\n            if (err) {\n                data.errors.push(err);\n            }\n        });\n        _(conf.vars).each((data, name) => {\n            const err = checkForIdentifier(name);\n            if (err) {\n                data.errors.push(err);\n            }\n        });\n        return conf;\n    }\n\n    /* Returns the AST all all definition by parseing all config definitions */\n    parseAll() {\n        const vars = _.mapValues(this._config.vars, exp => {\n            const node = this._parserAst.parse(exp);\n            return {\n                exp: exp,\n                errors: this._parserAst.errors,\n                node: node\n            }\n        });\n        const funcs = _.mapValues(this._config.funcs, exp => {\n            const node = this._parserAst.parse(exp);\n            return {\n                exp: exp,\n                errors: this._parserAst.errors,\n                node: node\n            }\n        });\n        const bodies = _.map(this._config.bodies, c => {\n            const positionNode = this._parserAst.parse(c.position);\n            const positionErrors = this._parserAst.errors;\n            const result = {\n                position: {\n                    exp: c.position,\n                    errors: positionErrors,\n                    node: positionNode\n                }\n            };\n            if (c.rotation) {\n                const node = this._parserAst.parse(c.rotation);\n                const errors = this._parserAst.errors;\n                result.rotation = {\n                    exp: c.rotation,\n                    errors: errors,\n                    node: node\n                }\n            }\n            return result;\n        });\n        const update = _.mapValues(this._config.update, exp => {\n            const node = this._parserAst.parse(exp);\n            return {\n                exp: exp,\n                errors: this._parserAst.errors,\n                node: node\n            }\n        });\n        this._result = {\n            vars: vars,\n            funcs: funcs,\n            bodies: bodies,\n            update: update\n        };\n        return this._result;\n    }\n\n    /* Returns the number of errors of the parser state */\n    errorCount(conf) {\n        return _(conf.vars).map(data => data.errors.length).sum()\n            + _(conf.funcs).map(data => data.errors.length).sum()\n            + _(conf.update).map(data => data.errors.length).sum()\n            + _(conf.bodies).map(data => data.position.errors.length\n                + (data.rotation ? data.rotation.errors.length : 0)).sum();\n    }\n\n    /* Returns the parser state after checking the correct match between\n     * between update and variable types\n     */\n    checkForBodiesTypeDefinition(conf) {\n        _.each(conf.bodies, data => {\n            const posResult = data.position.result;\n            if (!(posResult.type === VectorType)) {\n                data.position.errors.push('Position must be a vector');\n            }\n            if (data.rotation) {\n                const rotType = data.rotation.result;\n                if (!(rotType.type === QuaternionType)) {\n                    data.rotation.errors.push('Rotation must be a quaternion');\n                }\n            }\n        });\n        return conf;\n    }\n\n    /* Returns the error report from a parser state */\n    createErrors(conf5) {\n        return {\n            funcs: _.mapValues(conf5.funcs, 'errors'),\n            vars: _.mapValues(conf5.vars, 'errors'),\n            update: _.mapValues(conf5.update, 'errors'),\n            bodies: _.map(conf5.bodies, body => {\n                const result = {\n                    position: body.position.errors\n                };\n                if (body.rotation) {\n                    result.rotation = body.rotation.errors;\n                }\n                return result;\n            })\n        };\n    }\n\n    /* Returns the initial state of simulated system from the parser state */\n    buildSystem(conf) {\n        const funcsCode = _.mapValues(conf.funcs, data => data.result.code);\n        const varsCode = _.mapValues(conf.vars, data => data.result.code);\n        const resolver = {\n            resolve: id => {\n                const code = funcsCode[id] || varsCode[id];\n                const result = code.apply(resolver);\n                return result;\n            }\n        }\n        const vars = _.mapValues(conf.vars, data => data.result.code.apply(resolver));\n\n        const updateCode = _.mapValues(conf.update, data => data.result.code);\n        const bodiesCode = _.map(conf.bodies, data => {\n            const posCode = data.position.result.code;\n            const posCode1 = data.position.result.rows !== 3 ? OpTreeBuilder.createResizeVector(posCode, 3) : posCode;\n            const result = {\n                position: posCode1\n            }\n            if (data.rotation) {\n                if (data.rotation.result.type === QuaternionType) {\n                    result.rotation = data.rotation.result.code;\n                } else {\n                    result.rotation = OpTreeBuilder.createField2Quat(data.rotation.result.code);\n                }\n            }\n            return result;\n        });\n        return new System(vars, funcsCode, updateCode, bodiesCode);\n    }\n\n    /* Returns the parser state with the operation tree of configuration */\n    build(conf) {\n        return new Builder(conf).build();\n    }\n\n    /* Returns the parser state after checking the correct match\n     * between update and variable definitions\n     */\n    checkForUpdateDefinition(conf) {\n\n        function isVar(ref) {\n            return conf.vars[ref] !== undefined;\n        }\n\n        _(conf.update).each((data, ref) => {\n            if (!isVar(ref)) {\n                data.errors.push('Update ' + ref + ' is not a variable')\n            }\n        });\n        return conf;\n    }\n\n    /* Returns the parser state after checking the absence of override\n     * between function and variable definitions\n     */\n    checkForFunctionsRedefinition(conf) {\n\n        function isFunction(ref) {\n            return ref === 'dt' || conf.funcs[ref] !== undefined;\n        }\n\n        _(conf.vars).each((data, ref) => {\n            if (isFunction(ref)) {\n                data.errors.push('Function ' + ref + ' cannot be redefined as variable')\n            }\n        });\n\n        return conf;\n    }\n\n    /* Returns the parser state after checking the correct match between\n     * between update and variable types\n     */\n    checkForUpdateTypeDefinition(conf) {\n\n        function typeName(varResult) {\n            switch (varResult.type) {\n                case FieldType:\n                    return 'scalar';\n                case QuaternionType:\n                    return 'quaternion';\n                case VectorType:\n                    return 'vector [' + varResult.rows + ']';\n                default:\n                    return 'matrix [' + varResult.rows + ', ' + varResult.cols + ']';\n            }\n        }\n\n        _.each(conf.update, (data, ref) => {\n            const varResult = conf.vars[ref] && conf.vars[ref].result;\n            if (varResult) {\n                const upResult = data.result;\n                const wrongType = varResult.type === upResult.type && (\n                    varResult.type === FieldType\n                    || (varResult.type === VectorType && varResult.rows === upResult.rows)\n                    || (varResult.type === MatrixType\n                        && varResult.rows === upResult.rows\n                        && varResult.rows === upResult.rows));\n                if (!wrongType) {\n\n                    // var varTypeName = '';\n                    data.errors.push('Update ('\n                        + typeName(upResult)\n                        + ') must be the same of var ('\n                        + typeName(varResult) + ')');\n                }\n            }\n        });\n        return conf;\n    }\n}\n\nconst FieldType = \"Field\";\nconst QuaternionType = \"Quaternion\";\nconst VectorType = \"Vector\";\nconst MatrixType = \"Matrix\";\n\nclass CodeResult {\n    constructor(type, rows, cols, code, errors) {\n        this._type = type;\n        this._rows = rows || 0;\n        this._cols = cols || 0;\n        this._code = code || [];\n        this._errors = errors || [];\n    }\n\n    get code() { return this._code; }\n    get rows() { return this._rows; }\n    get cols() { return this._cols; }\n    get type() { return this._type; }\n    get errors() { return this._errors; }\n\n    withType(type) { return new CodeResult(type, this.rows, this.cols, this.code, this.errors); }\n    withRows(rows) { return new CodeResult(this.type, rows, this.cols, this.code, this.errors); }\n    withCols(cols) { return new CodeResult(this.type, this.rows, cols, this.code, this.errors); }\n    withSize(rows, cols) { return new CodeResult(this.type, rows, cols, this.code, this.errors); }\n    withCode(code) {\n        return new CodeResult(this.type, this.rows, this.cols, code, this.errors);\n    }\n    withErrors(errors) {\n        return new CodeResult(this.type, this.rows, this.cols, this.code, errors);\n    }\n    withMoreErrors() {\n        return this.withErrors(_.flatten(_.concat(this._errors, arguments)));\n    }\n    withTypeOf(other) {\n        return new CodeResult(other.type, other.rows, other.cols, this.code, this.errors);\n    }\n}\n\nconst CircularResferenceResult = new CodeResult(FieldType, 0, 0, [OpTreeBuilder.createField(0)], [\"Circular reference\"]);\n\nclass ASTNode {\n    get dependencies() { return []; }\n    // Returns the type of result and related errors\n    validate(context) { throw new Error('Not implemented'); }\n    // Returns the type of result, the generated code and errors\n    build() { throw new Error('Not implemented'); }\n}\n\n/* Constant real value */\nclass ConstantNode extends ASTNode {\n    constructor(value) {\n        super();\n        this._value = value;\n    }\n    get value() { return this._value; }\n    build(context) { return new CodeResult(FieldType, 0, 0, OpTreeBuilder.createField(this.value)); }\n}\n\n/* Constant Quaternion value */\nclass ConstantQuatNode extends ASTNode {\n    constructor(value) {\n        super();\n        this._value = value;\n    }\n    get value() { return this._value; }\n    build(context) { return new CodeResult(QuaternionType, 0, 0, OpTreeBuilder.createQuaternion(this.value)); }\n}\n\nclass BaseNode extends ASTNode {\n    constructor(size) {\n        super();\n        this._size = size;\n    }\n    get size() { return this._size; }\n    build(builder) {\n        const value = _.map(_.range(this.size + 1), i => i === this.size ? 1 : 0);\n        return new CodeResult(VectorType, this.size + 1, 0, OpTreeBuilder.createVector(value));\n    }\n\n}\n\nclass IdentityNode extends ASTNode {\n    constructor(size) {\n        super();\n        this._size = size;\n    }\n    get size() { return this._size; }\n    build(builder) {\n        const value = _.map(_.range(this.size), i =>\n            _.map(_.range(this.size), j =>\n                i === j ? 1 : 0\n            ));\n        return new CodeResult(MatrixType, this.size, this.size, OpTreeBuilder.createMatrix(value));\n    }\n}\n\nclass RefNode extends ASTNode {\n    constructor(id) {\n        super();\n        this._id = id;\n\n    }\n    get dependencies() { return [this.id]; }\n    get id() { return this._id; }\n\n    build(builder) {\n        return builder.buildRef(this.id).withCode(OpTreeBuilder.createRef(this.id));\n    }\n}\n\nclass DtRefNode extends ASTNode {\n    constructor(id) {\n        super();\n        this._id = id;\n\n    }\n\n    build(builder) {\n        return new CodeResult(FieldType, 0, 0, OpTreeBuilder.createRef('dt'));\n    }\n}\n\nclass UnaryNode extends ASTNode {\n    constructor(arg) {\n        super();\n        this._arg = arg;\n    }\n\n    get dependencies() { return this.arg.dependencies; }\n\n    get arg() { return this._arg; }\n}\n\nclass NegNode extends UnaryNode {\n    build(builder) {\n        const op = this.arg.build(builder)\n        switch (op.type) {\n            case FieldType:\n                return op.withCode(OpTreeBuilder.createNegateField(op.code));\n            case QuaternionType:\n                return op.withCode(OpTreeBuilder.createNegateQuat(op.code));\n            case VectorType:\n                return op.withCode(OpTreeBuilder.createNegateVector(op.code));\n            default:\n                return op.withCode(OpTreeBuilder.createNegateMatrix(op.code));\n\n        }\n    }\n}\n\nclass ModNode extends UnaryNode {\n    build(context) {\n        const op = this.arg.build(context);\n        switch (op.type) {\n            case FieldType:\n                return op.withCode(OpTreeBuilder.createAbs(op.code));\n            case QuaternionType:\n                return op.withType(FieldType).withCode(OpTreeBuilder.createQuatModule(op.code));\n            case VectorType:\n                return op.withType(FieldType).withCode(OpTreeBuilder.createVectorModule(op.code));\n            default:\n                return op.withMoreErrors(['Invalid module operation on matrix']);\n        }\n    }\n}\n\nclass TransposeNode extends UnaryNode {\n    build(context) {\n        const op = this.arg.build(context);\n        switch (op.type) {\n            case FieldType:\n                return op.withMoreErrors(['Invalid transpose operation on value']);\n            case QuaternionType:\n                return op.withMoreErrors(['Invalid transpose operation on quaternion']);\n            case VectorType:\n                return op.withMoreErrors(['Invalid transpose operation on vector']);\n            default:\n                return op.withSize(op.cols, op.rows).withCode(OpTreeBuilder.createTransposeMatrix(op.code));\n        }\n    }\n}\n\nclass SqrtNode extends UnaryNode {\n    build(context) {\n        const op = this.arg.build(context);\n        switch (op.type) {\n            case FieldType:\n                return op.withCode(OpTreeBuilder.createSqrt(op.code));\n            case QuaternionType:\n                return op.withMoreErrors(['Invalid sqrt operation on quaterion']);\n            case VectorType:\n                return op.withMoreErrors(['Invalid sqrt operation on vector']);\n            default:\n                return op.withMoreErrors(['Invalid sqrt operation on matrix']);\n        }\n    }\n}\n\nclass ExpNode extends UnaryNode {\n    build(context) {\n        const op = this.arg.build(context);\n        switch (op.type) {\n            case FieldType:\n                return op.withCode(OpTreeBuilder.createExp(op.code));\n            case QuaternionType:\n                return op.withMoreErrors(['Invalid exp operation on quaterion']);\n            case VectorType:\n                return op.withMoreErrors(['Invalid exp operation on vector']);\n            default:\n                return op.withMoreErrors(['Invalid exp operation on matrix']);\n        }\n    }\n}\n\nclass SinNode extends UnaryNode {\n\n    build(context) {\n        const op = this.arg.build(context);\n        switch (op.type) {\n            case FieldType:\n                return op.withCode(OpTreeBuilder.createSin(op.code));\n            case QuaternionType:\n                return op.withMoreErrors(['Invalid sin operation on quaternion']);\n            case VectorType:\n                return op.withMoreErrors(['Invalid sin operation on vector']);\n            default:\n                return op.withMoreErrors(['Invalid sin operation on matrix']);\n        }\n    }\n}\n\nclass CosNode extends UnaryNode {\n    build(context) {\n        const op = this.arg.build(context);\n        switch (op.type) {\n            case FieldType:\n                return op.withCode(OpTreeBuilder.createCos(op.code));\n            case QuaternionType:\n                return op.withMoreErrors(['Invalid cos operation on quaternion']);\n            case VectorType:\n                return op.withMoreErrors(['Invalid cos operation on vector']);\n            default:\n                return op.withMoreErrors(['Invalid cos operation on matrix']);\n        }\n    }\n}\nclass TanNode extends UnaryNode {\n    build(context) {\n        const op = this.arg.build(context);\n        switch (op.type) {\n            case FieldType:\n                return op.withCode(OpTreeBuilder.createTan(op.code));\n            case QuaternionType:\n                return op.withMoreErrors(['Invalid tan operation on quaternion']);\n            case VectorType:\n                return op.withMoreErrors(['Invalid tan operation on vector']);\n            default:\n                return op.withMoreErrors(['Invalid tan operation on matrix']);\n        }\n    }\n}\n\nclass AsinNode extends UnaryNode {\n    build(context) {\n        const op = this.arg.build(context);\n        switch (op.type) {\n            case FieldType:\n                return op.withCode(OpTreeBuilder.createAsin(op.code));\n            case QuaternionType:\n                return op.withMoreErrors(['Invalid asin operation on quaternion']);\n            case VectorType:\n                return op.withMoreErrors(['Invalid asin operation on vector']);\n            default:\n                return op.withMoreErrors(['Invalid asin operation on matrix']);\n        }\n    }\n}\n\nclass AcosNode extends UnaryNode {\n    build(context) {\n        const op = this.arg.build(context);\n        switch (op.type) {\n            case FieldType:\n                return op.withCode(OpTreeBuilder.createAcos(op.code));\n            case QuaternionType:\n                return op.withMoreErrors(['Invalid acos operation on quaternion']);\n            case VectorType:\n                return op.withMoreErrors(['Invalid acos operation on vector']);\n            default:\n                return op.withMoreErrors(['Invalid acos operation on matrix']);\n        }\n    }\n}\n\nclass AtanNode extends UnaryNode {\n    build(context) {\n        const op = this.arg.build(context);\n        switch (op.type) {\n            case FieldType:\n                return op.withCode(OpTreeBuilder.createAtan(op.code));\n            case QuaternionType:\n                return op.withMoreErrors(['Invalid atan operation on quaternion']);\n            case VectorType:\n                return op.withMoreErrors(['Invalid atan operation on vector']);\n            default:\n                return op.withMoreErrors(['Invalid atan operation on matrix']);\n        }\n    }\n}\n\nclass SinhNode extends UnaryNode {\n    build(context) {\n        const op = this.arg.build(context);\n        switch (op.type) {\n            case FieldType:\n                return op.withCode(OpTreeBuilder.createSinh(op.code));\n            case QuaternionType:\n                return op.withMoreErrors(['Invalid sinh operation on quaternion']);\n            case VectorType:\n                return op.withMoreErrors(['Invalid sinh operation on vector']);\n            default:\n                return op.withMoreErrors(['Invalid sinh operation on matrix']);\n        }\n    }\n}\n\nclass CoshNode extends UnaryNode {\n    build(context) {\n        const op = this.arg.build(context);\n        switch (op.type) {\n            case FieldType:\n                return op.withCode(OpTreeBuilder.createCosh(op.code));\n            case QuaternionType:\n                return op.withMoreErrors(['Invalid cosh operation on quaternion']);\n            case VectorType:\n                return op.withMoreErrors(['Invalid cosh operation on vector']);\n            default:\n                return op.withMoreErrors(['Invalid cosh operation on matrix']);\n        }\n    }\n}\n\nclass TanhNode extends UnaryNode {\n    build(context) {\n        const op = this.arg.build(context);\n        switch (op.type) {\n            case FieldType:\n                return op.withCode(OpTreeBuilder.createTanh(op.code));\n            case QuaternionType:\n                return op.withMoreErrors(['Invalid tanh operation on quaternion']);\n            case VectorType:\n                return op.withMoreErrors(['Invalid tanh operation on vector']);\n            default:\n                return op.withMoreErrors(['Invalid tanh operation on matrix']);\n        }\n    }\n}\n\nclass LogNode extends UnaryNode {\n    build(context) {\n        const op = this.arg.build(context);\n        switch (op.type) {\n            case FieldType:\n                return op.withCode(OpTreeBuilder.createLog(op.code));\n            case QuaternionType:\n                return op.withMoreErrors(['Invalid log operation on quaternion']);\n            case VectorType:\n                return op.withMoreErrors(['Invalid log operation on vector']);\n            default:\n                return op.withMoreErrors(['Invalid log operation on matrix']);\n        }\n    }\n}\n\nclass QrotNode extends UnaryNode {\n    build(context) {\n        const op = this.arg.build(context);\n        switch (op.type) {\n            case FieldType:\n                return op.withMoreErrors(['Invalid qrot operation on value']);\n            case QuaternionType:\n                return op.withMoreErrors(['Invalid qrot operation on quaternion']);\n            case VectorType:\n                const c1 = (op.rows !== 3) ? OpTreeBuilder.createResizeVector(op.code, 3) : op.code;\n                return op.withType(QuaternionType).withCode(OpTreeBuilder.createQrot(c1));\n            default:\n                return op.withMoreErrors(['Invalid qrot operation on matrix']);\n        }\n    }\n}\n\nclass BinaryNode extends ASTNode {\n    constructor(arg1, arg2) {\n        super();\n        this._arg1 = arg1;\n        this._arg2 = arg2;\n    }\n\n    get dependencies() {\n        return _.concat(\n            this.arg1.dependencies,\n            this.arg2.dependencies);\n    }\n\n    get arg1() { return this._arg1; }\n    get arg2() { return this._arg2; }\n}\n\nclass PwrNode extends BinaryNode {\n    build(context) {\n        const op1 = this.arg1.build(context);\n        const op2 = this.arg2.build(context);\n\n        switch (op1.type) {\n            case FieldType:\n                switch (op2.type) {\n                    case FieldType:\n                        return op1.withMoreErrors(op2.errors).withCode(OpTreeBuilder.createPower(op1.code, op2.code));\n                    case QuaternionType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid power value and quaternion']);\n                    case VectorType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid power value and vector']);\n                    default:\n                        return op1.withMoreErrors(op2.errors, ['Invalid power value and matrix']);\n                }\n            case QuaternionType:\n                return op1.withMoreErrors(op2.errors, ['Invalid power quaternion and anything']);\n            case VectorType:\n                return op1.withMoreErrors(op2.errors, ['Invalid power vector and anything']);\n            default:\n                return op1.withMoreErrors(op2.errors, ['Invalid power matrix and anything']);\n        }\n    }\n}\n\nclass CatNode extends BinaryNode {\n\n    build(context) {\n        const op1 = this.arg1.build(context);\n        const op2 = this.arg2.build(context);\n\n        switch (op1.type) {\n            case FieldType:\n                switch (op2.type) {\n                    case FieldType:\n                        return op1.withMoreErrors(op2.errors).withType(VectorType)\n                            .withRows(2).withCode(OpTreeBuilder.createCatField(op1.code, op2.code));\n                    case QuaternionType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid append value and quaternion']);\n                    case VectorType:\n                        return op1.withMoreErrors(op2.errors).withType(VectorType)\n                            .withRows(op2.rows + 1).withCode(OpTreeBuilder.createInsertFieldAt(op2.code, op1.code, 0));\n                    default:\n                        return op1.withMoreErrors(op2.errors, ['Invalid append value and matrix']);\n                }\n            case QuaternionType:\n                return op1.withMoreErrors(op2.errors, ['Invalid append quaternion and anything']);\n            case VectorType:\n                switch (op2.type) {\n                    case FieldType:\n                        return op1.withMoreErrors(op2.errors).withRows(op1.rows + 1)\n                            .withCode(OpTreeBuilder.createInsertFieldAt(op1.code, op2.code, op1.rows));\n                    case QuaternionType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid append vector and quaternion']);\n                    case VectorType: {\n                        //Resize\n                        const c1 = op1.rows < op2.rows ? OpTreeBuilder.createResizeVector(op1.code, op2.rows) : op1.code;\n                        const c2 = op1.rows > op2.rows ? OpTreeBuilder.createResizeVector(op2.code, op1.rows) : op2.code;\n                        return op1.withMoreErrors(op2.errors).withType(MatrixType)\n                            .withSize(Math.max(op1.rows, op2.rows), 2).withCode(OpTreeBuilder.createCatVector(c1, c2));\n                    }\n                    default: {\n                        //Resize\n                        const c1 = op1.rows < op2.rows ? OpTreeBuilder.createResizeVector(op1.code, op2.rows) : op1.code;\n                        const c2 = op1.rows > op2.rows ? OpTreeBuilder.createResizeMatrix(op2.code, op1.rows, op2.cols) : op2.code;\n                        return op1.withMoreErrors(op2.errors).withType(MatrixType)\n                            .withSize(Math.max(op1.rows, op2.rows), op1.cols + 1).withCode(OpTreeBuilder.createInsertVector(c2, c1));\n                    }\n                }\n            default:\n                switch (op2.type) {\n                    case FieldType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid append matrix and value']);\n                    case QuaternionType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid append matrix and quaternion']);\n                    case VectorType: {\n                        //Resize\n                        const c1 = op1.rows < op2.rows ? OpTreeBuilder.createResizeMatrix(op1.code, op2.rows, op1.cols) : op1.code;\n                        const c2 = op1.rows > op2.rows ? OpTreeBuilder.createResizeVector(op2.code, op1.rows, op2.cols) : op2.code;\n                        return op1.withMoreErrors(op2.errors).withType(MatrixType)\n                            .withSize(Math.max(op1.rows, op2.rows), op1.cols + 1).withCode(OpTreeBuilder.createAppendVector(c1, c2));\n                    }\n                    default: {\n                        //Resize\n                        const c1 = op1.rows < op2.rows ? OpTreeBuilder.createResizeMatrix(op1.code, op2.rows, op1.cols) : op1.code;\n                        const c2 = op1.rows > op2.rows ? OpTreeBuilder.createResizeMatrix(op2.code, op1.rows, op2.cols) : op2.code;\n                        return op1.withMoreErrors(op2.errors).withType(MatrixType)\n                            .withSize(Math.max(op1.rows, op2.rows), op1.cols + op2.cols).withCode(OpTreeBuilder.createAppendMatrix(c1, c2));\n                    }\n                }\n        }\n    }\n}\n\nclass AddNode extends BinaryNode {\n\n    build(context) {\n        const op1 = this.arg1.build(context);\n        const op2 = this.arg2.build(context);\n\n        switch (op1.type) {\n            case FieldType:\n                switch (op2.type) {\n                    case FieldType:\n                        return op1.withMoreErrors(op2.errors).withCode(OpTreeBuilder.createSumField(op1.code, op2.code));\n                    case QuaternionType:\n                        return op1.withMoreErrors(op2.errors).withType(QuaternionType).withCode(OpTreeBuilder.createSumQuatField(op2.code, op1.code));\n                    case VectorType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid sum value and vector']);\n                    default:\n                        return op1.withMoreErrors(op2.errors, ['Invalid sum value and matrix']);\n                }\n            case QuaternionType:\n                switch (op2.type) {\n                    case FieldType:\n                        return op1.withMoreErrors(op2.errors).withCode(OpTreeBuilder.createSumQuatField(op1.code, op2.code));\n                    case QuaternionType:\n                        return op1.withMoreErrors(op2.errors).withCode(OpTreeBuilder.createSumQuat(op1.code, op2.code));\n                    case VectorType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid sum quaternion and vector']);\n                    default:\n                        return op1.withMoreErrors(op2.errors, ['Invalid sum quaternion and matrix']);\n                }\n            case VectorType:\n                switch (op2.type) {\n                    case FieldType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid sum vector and value']);\n                    case QuaternionType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid sum vector and quaternion']);\n                    case VectorType: {\n                        //Resize\n                        const c1 = op1.rows < op2.rows ? OpTreeBuilder.createResizeVector(op1.code, op2.rows) : op1.code;\n                        const c2 = op1.rows > op2.rows ? OpTreeBuilder.createResizeVector(op2.code, op1.rows) : op2.code;\n                        return op1.withMoreErrors(op2.errors).withRows(Math.max(op1.rows, op2.rows)).withCode(OpTreeBuilder.createSumVector(c1, c2));\n                    }\n                    default:\n                        return op1.withMoreErrors(op2.errors, ['Invalid sum vector and matrix']);\n                }\n            default:\n                switch (op2.type) {\n                    case FieldType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid sum matrix and value']);\n                    case QuaternionType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid sum matrix and quaternion']);\n                    case VectorType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid sum matrix and vector']);\n                    default: {\n                        // Resize\n                        const n = Math.max(op1.rows, op2.rows);\n                        const m = Math.max(op1.cols, op2.cols);\n                        const c1 = (op1.rows < op2.rows || op1.cols < op2.cols) ?\n                            OpTreeBuilder.createResizeMatrix(op1.code, n, m) :\n                            op1.code;\n                        const c2 = (op1.rows > op2.rows || op1.cols > op2.cols) ?\n                            OpTreeBuilder.createResizeMatrix(op2.code, n, m) :\n                            op2.code;\n                        return op1.withMoreErrors(op2.errors).withSize(n, m)\n                            .withCode(OpTreeBuilder.createSumMatrix(c1, c2));\n                    }\n                }\n        }\n    }\n}\n\nclass SubNode extends BinaryNode {\n\n    build(context) {\n        const op1 = this.arg1.build(context);\n        const op2 = this.arg2.build(context);\n        switch (op1.type) {\n            case FieldType:\n                switch (op2.type) {\n                    case FieldType:\n                        return op1.withMoreErrors(op2.errors).withCode(OpTreeBuilder.createSubField(op1.code, op2.code));\n                    case QuaternionType:\n                        return op1.withMoreErrors(op2.errors).withType(QuaternionType).withCode(OpTreeBuilder.createSubFieldQuat(op1.code, op2.code));\n                    case VectorType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid sub value and vector']);\n                    default:\n                        return op1.withMoreErrors(op2.errors, ['Invalid sub value and matrix']);\n                }\n            case QuaternionType:\n                switch (op2.type) {\n                    case FieldType:\n                        return op1.withMoreErrors(op2.errors).withCode(OpTreeBuilder.createSubQuatField(op1.code, op2.code));\n                    case QuaternionType:\n                        return op1.withMoreErrors(op2.errors).withCode(OpTreeBuilder.createSubQuat(op1.code, op2.code));\n                    case VectorType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid sub quaternion and vector']);\n                    default:\n                        return op1.withMoreErrors(op2.errors, ['Invalid sub quaternion and matrix']);\n                }\n            case VectorType:\n                switch (op2.type) {\n                    case FieldType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid sub vector and value']);\n                    case QuaternionType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid sub vector and quaternion']);\n                    case VectorType: {\n                        //Resize\n                        const c1 = op1.rows < op2.rows ? OpTreeBuilder.createResizeVector(op1.code, op2.rows) : op1.code;\n                        const c2 = op1.rows > op2.rows ? OpTreeBuilder.createResizeVector(op2.code, op1.rows) : op2.code;\n                        return op1.withMoreErrors(op2.errors).withRows(Math.max(op1.rows, op2.rows))\n                            .withCode(OpTreeBuilder.createSubVector(c1, c2));\n                    }\n                    default:\n                        return op1.withMoreErrors(op2.errors, ['Invalid sub vector and matrix']);\n                }\n            default:\n                switch (op2.type) {\n                    case FieldType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid sub matrix and value']);\n                    case QuaternionType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid sub matrix and quaternion']);\n                    case VectorType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid sub matrix and vector']);\n                    default: {\n                        const n = Math.max(op1.rows, op2.rows);\n                        const m = Math.max(op1.cols, op2.cols);\n                        // Resize\n                        const c1 = (op1.rows < op2.rows || op1.cols < op2.cols) ?\n                            OpTreeBuilder.createResizeMatrix(op1.code, n, m) :\n                            op1.code;\n                        const c2 = (op1.rows > op2.rows || op1.cols > op2.cols) ?\n                            OpTreeBuilder.createResizeMatrix(op2.code, n, m) :\n                            op2.code;\n                        return op1.withMoreErrors(op2.errors).withSize(n, m)\n                            .withCode(OpTreeBuilder.createSubMatrix(c1, c2));\n                    }\n                }\n        }\n    }\n}\n\nclass MulNode extends BinaryNode {\n\n    build(context) {\n        const op1 = this.arg1.build(context);\n        const op2 = this.arg2.build(context);\n\n        switch (op1.type) {\n            case FieldType:\n                switch (op2.type) {\n                    case FieldType:\n                        return op1.withMoreErrors(op2.errors).withCode(OpTreeBuilder.createProduct(op1.code, op2.code));\n                    case QuaternionType:\n                        return op1.withTypeOf(op2).withMoreErrors(op2.errors).withType(QuaternionType).withCode(OpTreeBuilder.createScaleQuat(op2.code, op1.code));\n                    case VectorType:\n                        return op1.withTypeOf(op2).withMoreErrors(op2.errors).withCode(OpTreeBuilder.createScaleVector(op2.code, op1.code));\n                    default:\n                        return op1.withTypeOf(op2).withMoreErrors(op2.errors).withCode(OpTreeBuilder.createScaleMatrix(op2.code, op1.code));\n                }\n            case QuaternionType:\n                switch (op2.type) {\n                    case FieldType:\n                        return op1.withMoreErrors(op2.errors).withType(QuaternionType).withCode(OpTreeBuilder.createScaleQuat(op1.code, op2.code));\n                    case QuaternionType:\n                        return op1.withTypeOf(op2).withMoreErrors(op2.errors).withType(QuaternionType).withCode(OpTreeBuilder.createProductQuat(op1.code, op2.code));\n                    case VectorType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid multiplication quaternion by vector']);\n                    default:\n                        return op1.withMoreErrors(op2.errors, ['Invalid multiplication quaternion by matrix']);\n                }\n            case VectorType:\n                switch (op2.type) {\n                    case FieldType:\n                        return op1.withMoreErrors(op2.errors).withCode(OpTreeBuilder.createScaleVector(op1.code, op2.code));\n                    case QuaternionType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid multiplication vector by quaternion']);\n                    case VectorType: {\n                        const c1 = op1.rows > op2.rows ? OpTreeBuilder.createResizeVector(op1.code, op2.rows) : op1.code;\n                        const c2 = op1.rows < op2.rows ? OpTreeBuilder.createResizeVector(op2.code, op1.rows) : op2.code;\n                        return op1.withType(FieldType).withMoreErrors(op2.errors).withCode(OpTreeBuilder.createScalarProduct(c1, c2));\n                    }\n                    default:\n                        return op1.withMoreErrors(op2.errors, ['Invalid multiplication vector by matrix']);\n                }\n            default:\n                switch (op2.type) {\n                    case FieldType:\n                        return op1.withMoreErrors(op2.errors).withCode(OpTreeBuilder.createScaleMatrix(op1.code, op2.code));\n                    case QuaternionType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid multiplication matrix by quaternion']);\n                    case VectorType: {\n                        const c1 = op1.cols > op2.rows ? OpTreeBuilder.createResizeMatrix(op1.code, op1.rows, op2.rows) : op1.code;\n                        const c2 = op1.cols < op2.rows ? OpTreeBuilder.createResizeVector(op2.code, op1.cols) : op2.code;\n                        return op1.withTypeOf(VectorType)\n                            .withRows(op1.rows).withMoreErrors(op2.errors)\n                            .withCode(OpTreeBuilder.createMatrixVectorProduct(c1, c2));\n                    }\n                    default: {\n                        const c1 = op1.cols > op2.rows ? OpTreeBuilder.createResizeMatrix(op1.code, op1.rows, op2.rows) : op1.code;\n                        const c2 = op1.cols < op2.rows ? OpTreeBuilder.createResizeMatrix(op2.code, op1.cols, op2.cols) : op2.code;\n                        return op1.withSize(op1.rows, op2.cols).withMoreErrors(op2.errors).withCode(OpTreeBuilder.createMatrixProduct(c1, c2));\n                    }\n                }\n        }\n    }\n}\n\nclass DivNode extends BinaryNode {\n\n    build(context) {\n        const op1 = this.arg1.build(context);\n        const op2 = this.arg2.build(context);\n\n        switch (op1.type) {\n            case FieldType:\n                switch (op2.type) {\n                    case FieldType:\n                        return op1.withMoreErrors(op2.errors).withCode(OpTreeBuilder.createDivideField(op1.code, op2.code));\n                    case QuaternionType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid division value by quaternion']);\n                    case VectorType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid division value by vector']);\n                    default:\n                        return op1.withMoreErrors(op2.errors, ['Invalid division value by matrix']);\n                }\n            case QuaternionType:\n                switch (op2.type) {\n                    case FieldType:\n                        return op1.withMoreErrors(op2.errors).withCode(OpTreeBuilder.createDivQuatField(op1.code, op2.code));\n                    case QuaternionType:\n                        return op1.withMoreErrors(op2.errors).withCode(OpTreeBuilder.createDivQuat(op1.code, op2.code));\n                    case VectorType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid division quaternion by vector']);\n                    default:\n                        return op1.withMoreErrors(op2.errors, ['Invalid division quaternion by matrix']);\n                }\n            case VectorType:\n                switch (op2.type) {\n                    case FieldType:\n                        return op1.withMoreErrors(op2.errors).withCode(OpTreeBuilder.createDivideVector(op1.code, op2.code));\n                    case QuaternionType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid division vector by quaternion']);\n                    case VectorType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid division vector by vector']);\n                    default:\n                        return op1.withMoreErrors(op2.errors, ['Invalid division vector by matrix']);\n                }\n            default:\n                switch (op2.type) {\n                    case FieldType:\n                        return op1.withMoreErrors(op2.errors).withCode(OpTreeBuilder.createDivideMatrix(op1.code, op2.code));\n                    case QuaternionType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid division matrix by quaternion']);\n                    case VectorType:\n                        return op1.withMoreErrors(op2.errors, ['Invalid division matrix by vector']);\n                    default:\n                        return op1.withMoreErrors(op2.errors, ['Invalid division matrix by matrix']);\n                }\n        }\n    }\n}\n\nclass TraceNode extends UnaryNode {\n    build(builder) {\n        const op = this.arg.build(builder)\n        switch (op.type) {\n            case FieldType:\n                return op;\n            case QuaternionType:\n                return op.withErrors(['Invalid trace on quaternion']);\n            case VectorType:\n                return op.withErrors(['Invalid trace on vector']);\n            default:\n                return op.withType(FieldType).withCode(OpTreeBuilder.createTrace(op.code));\n\n        }\n    }\n}\n\nclass NormaNode extends UnaryNode {\n    build(builder) {\n        const op = this.arg.build(builder)\n        switch (op.type) {\n            case FieldType:\n                return op.withCode(OpTreeBuilder.createValueNorma(op.code));\n            case QuaternionType:\n                return op.withCode(OpTreeBuilder.createQuatNorma(op.code));\n            case VectorType:\n                return op.withCode(OpTreeBuilder.createVectNorma(op.code));\n            default:\n                return op.withErrors(['Invalid norma on matrix']);\n        }\n    }\n}\n\nclass CylNode extends UnaryNode {\n    build(builder) {\n        const op = this.arg.build(builder)\n        switch (op.type) {\n            case FieldType:\n                return op.withErrors(['Invalid cyl on value']);\n            case QuaternionType:\n                return op.withErrors(['Invalid cyl on quaternion']);\n            case VectorType:\n                const c1 = op.rows !== 3 ? OpTreeBuilder.createResizeVector(op.code, 3) : op.code;\n                return op.withCode(OpTreeBuilder.createCyl(c1));\n            default:\n                return op.withErrors(['Invalid cyl on matrix']);\n        }\n    }\n}\n\nclass SphereNode extends UnaryNode {\n    build(builder) {\n        const op = this.arg.build(builder)\n        switch (op.type) {\n            case FieldType:\n                return op.withErrors(['Invalid sphere on value']);\n            case QuaternionType:\n                return op.withErrors(['Invalid sphere on quaternion']);\n            case VectorType:\n                const c1 = op.rows !== 3 ? OpTreeBuilder.createResizeVector(op.code, 3) : op.code;\n                return op.withCode(OpTreeBuilder.createSphere(c1));\n            default:\n                return op.withErrors(['Invalid sphere on matrix']);\n        }\n    }\n}\n\nclass Cyl1Node extends UnaryNode {\n    build(builder) {\n        const op = this.arg.build(builder)\n        switch (op.type) {\n            case FieldType:\n                return op.withErrors(['Invalid cyl on value']);\n            case QuaternionType:\n                return op.withErrors(['Invalid cyl on quaternion']);\n            case VectorType:\n                const c1 = op.rows !== 3 ? OpTreeBuilder.createResizeVector(op.code, 3) : op.code;\n                return op.withType(MatrixType).withSize(3, 3).withCode(OpTreeBuilder.createCyl1(c1));\n            default:\n                return op.withErrors(['Invalid cyl on matrix']);\n        }\n    }\n}\n\nclass Sphere1Node extends UnaryNode {\n    build(builder) {\n        const op = this.arg.build(builder)\n        switch (op.type) {\n            case FieldType:\n                return op.withErrors(['Invalid cyl on value']);\n            case QuaternionType:\n                return op.withErrors(['Invalid cyl on quaternion']);\n            case VectorType:\n                const c1 = op.rows !== 3 ? OpTreeBuilder.createResizeVector(op.code, 3) : op.code;\n                return op.withType(MatrixType).withSize(3, 3).withCode(OpTreeBuilder.createSphere1(c1));\n            default:\n                return op.withErrors(['Invalid cyl on matrix']);\n        }\n    }\n}\n\nclass InverseNode extends UnaryNode {\n    build(builder) {\n        const op = this.arg.build(builder)\n        switch (op.type) {\n            case FieldType:\n                return op.withCode(OpTreeBuilder.createValueInverse(op.code));\n            case QuaternionType:\n                return op.withCode(OpTreeBuilder.createQuatInverse(op.code));\n            case VectorType:\n                return op.withErrors(['Invalid inv on vector']);\n            default:\n                if (op.rows !== op.cols)\n                    return op.withErrors(['Invalid inv on not square matrix']);\n                else\n                    return op.withCode(OpTreeBuilder.createMatrixInverse(op.code));\n        }\n    }\n}\n\nclass DetNode extends UnaryNode {\n    build(builder) {\n        const op = this.arg.build(builder)\n        switch (op.type) {\n            case FieldType:\n                return op.withErrors(['Invalid det on value']);\n            case QuaternionType:\n                return op.withErrors(['Invalid det on quaternion']);\n            case VectorType:\n                return op.withErrors(['Invalid det on vector']);\n            default:\n                if (op.rows !== op.cols)\n                    return op.withErrors(['Invalid det on not square matrix']);\n                else\n                    return op.withCode(OpTreeBuilder.createDet(op.code));\n        }\n    }\n}\n\nclass MinNode extends UnaryNode {\n    build(builder) {\n        const op = this.arg.build(builder)\n        switch (op.type) {\n            case FieldType:\n                return op;\n            case QuaternionType:\n                return op.withErrors(['Invalid min on quaternion']);\n            case VectorType:\n                return op.withType(FieldType).withCode(OpTreeBuilder.createMinVec(op.code));\n            default:\n                return op.withType(FieldType).withCode(OpTreeBuilder.createMinMat(op.code));\n        }\n    }\n}\n\nclass MaxNode extends UnaryNode {\n    build(builder) {\n        const op = this.arg.build(builder)\n        switch (op.type) {\n            case FieldType:\n                return op;\n            case QuaternionType:\n                return op.withErrors(['Invalid max on quaternion']);\n            case VectorType:\n                return op.withType(FieldType).withCode(OpTreeBuilder.createMaxVec(op.code));\n            default:\n                return op.withType(FieldType).withCode(OpTreeBuilder.createMaxMat(op.code));\n        }\n    }\n}\n\nconst DefaultNode = new ConstantNode('0');\n\nconst UnaryFunctions = {\n    sin: (arg) => new SinNode(arg),\n    cos: (arg) => new CosNode(arg),\n    tan: (arg) => new TanNode(arg),\n    asin: (arg) => new AsinNode(arg),\n    acos: (arg) => new AcosNode(arg),\n    atan: (arg) => new AtanNode(arg),\n    sinh: (arg) => new SinhNode(arg),\n    cosh: (arg) => new CoshNode(arg),\n    tanh: (arg) => new TanhNode(arg),\n    exp: (arg) => new ExpNode(arg),\n    log: (arg) => new LogNode(arg),\n    sqrt: (arg) => new SqrtNode(arg),\n    T: (arg) => new TransposeNode(arg),\n    qrot: (arg) => new QrotNode(arg),\n    tr: (arg) => new TraceNode(arg),\n    n: (arg) => new NormaNode(arg),\n    cyl: (arg) => new CylNode(arg),\n    sphere: (arg) => new SphereNode(arg),\n    cyl1: (arg) => new Cyl1Node(arg),\n    sphere1: (arg) => new Sphere1Node(arg),\n    inv: (arg) => new InverseNode(arg),\n    det: (arg) => new DetNode(arg),\n    min: (arg) => new MinNode(arg),\n    max: (arg) => new MaxNode(arg)\n};\n\nclass ParserAst {\n\n    constructor() {\n        this._errors = [];\n        const lexer = new Lexer();\n        lexer.addRule(ExpNumberRegex, k =>\n            this._token = {\n                text: k.text,\n                type: NumberToken\n            });\n        lexer.addRule(NumberRegex, k =>\n            this._token = {\n                text: k.text,\n                type: NumberToken\n            });\n        lexer.addRule(IdentifierRegex, k =>\n            this._token = {\n                text: k.text,\n                type: IdToken\n            });\n        lexer.addRule(/\\s/)\n        lexer.addRule(/./, k =>\n            this._token = {\n                text: k.text,\n                type: SymbolToken\n            });\n        this._lexer = lexer;\n    }\n\n    get errors() { return this._errors; }\n\n    get token() {\n        if (this._token === undefined) {\n            this._lexer.lex();\n        }\n        return this._token;\n    }\n\n    addError(msg) {\n        this._errors.push(msg);\n        return this;\n    }\n\n    parse(code) {\n        this._errors = [];\n        this.discard();\n        this._lexer.setSource(code);\n        const result = this.parseExp();\n        const token = this.token;\n        if (token !== undefined) {\n            this.addError('Unexpected token ' + token.text);\n        }\n        return result;\n    }\n\n    parseExp() {\n        var node = this.parseSum();\n        while (true) {\n            const token = this.token;\n            if (token === undefined) {\n                return node;\n            }\n            switch (token.text) {\n                case ',':\n                    this.discard();\n                    node = new CatNode(node, this.parseSum());\n                    break;\n                default:\n                    return node;\n            }\n        }\n    }\n\n    parseSum() {\n        var node = this.parseFactor();\n        while (true) {\n            const token = this.token;\n            if (token === undefined) {\n                return node;\n            }\n            switch (token.text) {\n                case '+':\n                    this.discard();\n                    node = new AddNode(node, this.parseFactor());\n                    break;\n                case '-':\n                    this.discard();\n                    node = new SubNode(node, this.parseFactor());\n                    break;\n                default:\n                    return node;\n            }\n        }\n    }\n\n    parseFactor() {\n        var node = this.parseUnary();\n        while (true) {\n            const token = this.token;\n            if (token === undefined) {\n                return node;\n            }\n            switch (token.text) {\n                case '*':\n                    this.discard();\n                    node = new MulNode(node, this.parseUnary());\n                    break;\n                case '/':\n                    this.discard();\n                    node = new DivNode(node, this.parseUnary());\n                    break;\n                default:\n                    return node;\n            }\n        }\n    }\n\n    parseUnary() {\n        const token = this.token;\n        if (token === undefined) {\n            this.addError('Expected unary expression');\n            return DefaultNode;\n        }\n        const nodeGen = UnaryFunctions[token.text];\n        if (nodeGen) {\n            this.discard();\n            return nodeGen(this.parseUnary());\n        }\n\n        switch (token.text) {\n            case '+':\n                this.discard();\n                return this.parseUnary();\n            case '-':\n                this.discard();\n                return new NegNode(this.parseUnary());\n            default:\n                return this.parsePwr();\n        }\n    }\n\n    parsePwr() {\n        var baseNode = this.parseTerm();\n        while (true) {\n            const token = this.token;\n            if (token === undefined || token.text !== '^') {\n                return baseNode;\n            }\n            this.discard();\n            const expNode = this.parseTerm();\n            baseNode = new PwrNode(baseNode, expNode);\n        }\n    }\n\n    parseTerm() {\n        function handleId(id) {\n            const baseExp = id.match(/^e([0-9]+)$/);\n            if (baseExp) {\n                return new BaseNode(parseInt(baseExp[1], 10));\n            }\n            const identExp = id.match(/^I([0-9]+)$/);\n            if (identExp) {\n                return new IdentityNode(parseInt(identExp[1], 10));\n            }\n            return new RefNode(id);\n        }\n\n        const token = this.token;\n        if (token === undefined) {\n            this.addError('Expected terminal expression');\n            return DefaultNode;\n        } else {\n            switch (token.type) {\n                case NumberToken:\n                    this.discard();\n                    return new ConstantNode(Number(token.text));\n                case SymbolToken:\n                    switch (token.text) {\n                        case '(': {\n                            this.discard();\n                            const value = this.parseExp();\n                            this.expected(')');\n                            return value;\n                        }\n                        case '|': {\n                            this.discard();\n                            const value = this.parseExp();\n                            this.expected('|');\n                            return new ModNode(value);\n                        }\n                        default:\n                            this.discard();\n                            this.addError('Unexpected token ' + token.text);\n                            return this.parseTerm();\n                    }\n                case IdToken:\n                    switch (token.text) {\n                        case 'PI':\n                            this.discard();\n                            return new ConstantNode(Math.PI);\n                        case 'e':\n                            this.discard();\n                            return new ConstantNode(Math.E);\n                        case 'i':\n                            this.discard();\n                            return new ConstantQuatNode([1, 0, 0, 0]);\n                        case 'j':\n                            this.discard();\n                            return new ConstantQuatNode([0, 1, 0, 0]);\n                        case 'k':\n                            this.discard();\n                            return new ConstantQuatNode([0, 0, 1, 0]);\n                        case 'dt':\n                            this.discard();\n                            return new DtRefNode();\n                        case 'ex':\n                            this.discard();\n                            return new BaseNode(0);\n                        case 'ey':\n                            this.discard();\n                            return new BaseNode(1);\n                        case 'ez':\n                            this.discard();\n                            return new BaseNode(2);\n                        default:\n                            this.discard();\n                            return handleId(token.text);\n                    }\n                default:\n            }\n        }\n    }\n\n    expected(token) {\n        if (!this.token) {\n            this.addError('Expected ' + token + ' found end of text');\n        } else if (this.token.text !== token) {\n            this.addError('Expected ' + token + ' found ' + this.token.text);\n        } else {\n            this.discard();\n        }\n        return this;\n    }\n\n    discard() {\n        delete this._token;\n        return this;\n    }\n}\n","import React, { Component } from 'react';\nimport { InputGroup, Button, Card, Form, Accordion } from 'react-bootstrap';\nimport { ExprField } from './ExprField';\nimport _ from 'lodash';\nimport { OptionPanel } from './OptionPanel';\nimport { checkForIdentifier } from './leibniz-ast-0.1.1';\nimport { v5 as uuidv5 } from 'uuid';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faPlus } from '@fortawesome/free-solid-svg-icons'\nimport { ExpressionNodes } from './Interpreter';\nimport { Definitions } from './Definitions';\n\nconst ns = uuidv5('http://www.mmarini.org', uuidv5.URL);\n\ninterface DefsPanelProps {\n  panelKey: string;\n  title: string;\n  defs: ExpressionNodes;\n  onChange?: (id: string, value: Definitions) => void;\n};\n\n/**\n * \n */\nexport class DefsPanel extends Component<DefsPanelProps, {\n  deleteModalShown: boolean;\n  newName: string;\n  modalTitle?: string;\n  modalMessage?: string;\n  optionAction?: () => void;\n}>{\n\n  /**\n   * \n   * @param props \n   */\n  constructor(props: DefsPanelProps) {\n    super(props);\n    this.state = {\n      deleteModalShown: false,\n      newName: ''\n    };\n  }\n\n  /**\n   * \n   */\n  private createDefs(): Record<string, string> {\n    const { defs } = this.props;\n    return _.mapValues(defs, 'exp');\n  }\n\n  /**\n   * \n   * @param id \n   * @param value \n   */\n  private onChange(id: string, value: string) {\n    const { onChange, panelKey } = this.props;\n    if (onChange) {\n      const newConf = this.createDefs();\n      newConf[id] = value;\n      onChange(panelKey, newConf);\n    }\n  }\n\n  /**\n   * \n   * @param id \n   */\n  private onDelete(id: string) {\n    this.showOptionPanel(\n      'Remove \"' + id + '\" definition ?',\n      'The definition \"' + id + '\" will be removed from the list.',\n      () => this.deleteDefs(id));\n  }\n\n  /**\n   * \n   * @param title \n   * @param message \n   * @param action \n   */\n  private showOptionPanel(title: string, message: string, action: () => void) {\n    this.setState({\n      deleteModalShown: true,\n      modalTitle: title,\n      modalMessage: message,\n      optionAction: action\n    });\n  }\n\n  /**\n   * \n   * @param id \n   */\n  private deleteDefs(id: string) {\n    const { onChange, panelKey } = this.props;\n    if (onChange) {\n      const newConf = this.createDefs()\n      delete newConf[id];\n      onChange(panelKey, newConf);\n    }\n    this.hideOptionPanel();\n  }\n\n  /**\n   * \n   */\n  private hideOptionPanel() {\n    this.setState({\n      deleteModalShown: false\n    });\n  }\n\n  /**\n   * \n   */\n  private onAdd() {\n    const { onChange, panelKey } = this.props;\n    if (onChange) {\n      const { newName } = this.state;\n      const newConf = this.createDefs();\n      newConf[newName] = '0';\n      onChange(panelKey, newConf);\n      this.setState({ newName: '' });\n    }\n  }\n\n  /**\n   * \n   * @param name \n   */\n  onName(name: string) {\n    this.setState({ newName: name });\n  }\n\n  /**\n   * \n   * @param name \n   */\n  newNameError(name: string) {\n    if (name === '') {\n      return 'Identifier is required';\n    }\n    if (checkForIdentifier(name)) {\n      return checkForIdentifier(name);\n    }\n    if (!!this.props.defs[name]) {\n      return 'Definition already exists';\n    }\n    return '';\n  }\n\n  /**\n   * \n   */\n  private hasError() {\n    return _.flatMap(this.props.defs, 'errors').length > 0;\n  }\n\n  render() {\n    const { title, defs } = this.props;\n    const {\n      deleteModalShown, modalTitle, modalMessage, optionAction,\n      newName\n    } = this.state;\n    const newNameError = this.newNameError(newName);\n\n    const fieldList = _(defs)\n      .toPairs()\n      .sortBy(ary => ary[0])\n      .map(ary => {\n        const key = ary[0];\n        const value = ary[1];\n        const id = uuidv5(key, ns);\n        return { id, key, value };\n      }).value();\n\n    const hasNewNameError = newNameError !== ''\n    return (\n      <Accordion defaultActiveKey=\"0\">\n        <Card>\n          <Accordion.Toggle as={Card.Header} eventKey=\"0\">\n            {title}\n          </Accordion.Toggle>\n          <Accordion.Collapse eventKey=\"0\">\n            <Card.Body>\n              <Form.Group controlId=\"validationAdd\">\n                <InputGroup size=\"sm\" >\n                  <InputGroup.Prepend>Name</InputGroup.Prepend>\n                  <Form.Control type=\"text\"\n                    value={newName}\n                    onChange={(ev) => this.onName(ev.target.value)}\n                    isValid={!hasNewNameError}\n                    isInvalid={!!hasNewNameError} />\n                  <InputGroup.Append>\n                    <Button variant=\"primary\"\n                      onClick={() => this.onAdd()}\n                      disabled={hasNewNameError}>\n                      <FontAwesomeIcon icon={faPlus} />\n                      <span>Add definition</span>\n                    </Button>\n                  </InputGroup.Append>\n                  <Form.Control.Feedback type=\"invalid\">{newNameError}</Form.Control.Feedback>\n                </InputGroup>\n              </Form.Group>\n              <hr></hr>\n              {fieldList.map(({ id, key, value }) => (\n                <ExprField key={id} name={key}\n                  expr={value.exp}\n                  errors={value.errors}\n                  onChange={(value) => this.onChange(key, value)}\n                  onDelete={() => this.onDelete(key)}></ExprField>\n              ))}\n              <OptionPanel show={deleteModalShown}\n                title={modalTitle}\n                message={modalMessage}\n                confirmButton=\"Remove\"\n                onCancel={() => this.hideOptionPanel()}\n                onConfirm={() => { if (optionAction) { optionAction(); } }}\n              />\n            </Card.Body >\n          </Accordion.Collapse>\n        </Card>\n      </Accordion>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport { Button } from 'react-bootstrap';\nimport { ExprField } from './ExprField';\nimport { OptionPanel } from './OptionPanel';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faPlus, faTrash } from '@fortawesome/free-solid-svg-icons'\nimport { BodyDefinition } from './Definitions';\nimport { BodyNode } from './Interpreter';\n\ninterface BodyRowProps {\n  id: number;\n  body: BodyNode;\n  onChange?: (body: BodyDefinition) => void;\n  onDelete?: () => void;\n};\n\nexport class BodyRow extends Component<BodyRowProps, {\n  modalShown: boolean;\n}> {\n\n  constructor(props: BodyRowProps) {\n    super(props);\n    this.state = {\n      modalShown: false\n    };\n  }\n\n  /**\n   * \n   */\n  private onAddRotation() {\n    const { onChange } = this.props;\n    if (onChange) {\n      const body = {\n        position: this.props.body.position.exp,\n        rotation: '1+0*i'\n      };\n      onChange(body);\n    }\n  }\n\n  /**\n   * \n   */\n  showOptionPanel() {\n    this.setState({ modalShown: true });\n  }\n\n  /**\n   * \n   */\n  hideOptionPanel() {\n    this.setState({ modalShown: false });\n  }\n\n  /**\n   * \n   */\n  deleteRotation() {\n    const { onChange } = this.props;\n    if (onChange) {\n      const body = {\n        position: this.props.body.position.exp\n      };\n      onChange(body);\n    }\n    this.hideOptionPanel();\n  }\n\n  /**\n   * \n   */\n  onDeleteRow() {\n    const { onDelete } = this.props;\n    if (onDelete) {\n      onDelete();\n    }\n  }\n\n  /**\n   * \n   * @param value \n   */\n  private onChangePosition(value: string) {\n    const { onChange, body } = this.props;\n    if (onChange) {\n      const newBody = (body.rotation) ?\n        {\n          position: value,\n          rotation: body.rotation.exp\n        } : {\n          position: value\n        };\n      onChange(newBody);\n    }\n  }\n\n  /**\n   * \n   * @param value \n   */\n  private onChangeRotation(value: string) {\n    const { onChange, body } = this.props;\n    if (onChange) {\n      const newBody = {\n        position: body.position.exp,\n        rotation: value\n      };\n      onChange(newBody);\n    }\n  }\n\n  render() {\n    const { body } = this.props;\n    const rotField = body.rotation ? (\n      <div>\n        <ExprField name=\"\"\n          expr={body.rotation.exp} errors={body.rotation.errors}\n          onChange={(value) => this.onChangeRotation(value)}\n          onDelete={() => this.showOptionPanel()}\n        />\n        <OptionPanel show={this.state.modalShown}\n          title=\"Remove rotation ?\"\n          message=\"The rotation will be removed from body\"\n          confirmButton=\"Remove\"\n          onConfirm={() => this.deleteRotation()}\n          onCancel={() => this.hideOptionPanel()}\n        />\n      </div>\n    ) : (\n        <Button size=\"sm\" variant=\"primary\" onClick={() => this.onAddRotation()}>\n          <FontAwesomeIcon icon={faPlus} />\n        </Button>);\n    return (\n      <tr>\n        <td>{this.props.id + 1}</td>\n        <td>\n          <ExprField name=\"\" expr={body.position.exp}\n            errors={body.position.errors}\n            onChange={(value) => this.onChangePosition(value)}\n            withoutDelete={true}\n          />\n        </td>\n        <td>\n          {rotField}\n        </td>\n        <td>\n          <Button size=\"sm\" variant=\"danger\" onClick={() => this.onDeleteRow()}>\n            <FontAwesomeIcon icon={faTrash} />\n          </Button>\n        </td>\n      </tr>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport { Accordion, Button, Card, Table } from 'react-bootstrap';\nimport { default as _ } from 'lodash';\nimport { BodyRow } from './BodyRow';\nimport { OptionPanel } from './OptionPanel';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faPlus } from '@fortawesome/free-solid-svg-icons'\nimport { BodyNodes } from './Interpreter';\nimport { BodyDefinitions, BodyDefinition } from './Definitions';\n\ninterface BodiesPanelProps {\n  bodies: BodyNodes;\n  onChange ?: (arg: BodyDefinitions) => void;\n};\n\nexport class BodiesPanel extends Component<BodiesPanelProps, {\n  modalShown: boolean;\n  modalTitle?: string;\n  modalMessage?: string;\n  confirmAction?: () => void;\n}> {\n\n  constructor(props: BodiesPanelProps) {\n    super(props);\n    this.state = {\n      modalShown: false\n    };\n  }\n\n  /**\n   * \n   * @param title \n   * @param message \n   * @param action \n   */\n  private showOptionPanel(title: string, message: string, action: () => void) {\n    this.setState({\n      modalShown: true,\n      modalTitle: title,\n      modalMessage: message,\n      confirmAction: action\n    });\n  }\n\n  /**\n   * \n   */\n  private hideOptionPanel() {\n    this.setState({\n      modalShown: false\n    });\n  }\n\n  /**\n   * \n   */\n  private onAdd() {\n    const { onChange } = this.props;\n    if (onChange) {\n      const bodies = this.createBodies()\n      bodies.push({\n        position: '(0,0,0)'\n      });\n      onChange(bodies);\n    }\n  }\n\n  /**\n   * \n   * @param idx \n   */\n  private onDelete(idx: number) {\n    this.showOptionPanel(\n      'Remove body #' + (idx + 1),\n      'Body #' + (idx + 1) + ' will be removed from the list.',\n      () => this.deleteBody(idx)\n    );\n  }\n\n  /**\n   * \n   * @param idx \n   */\n  private deleteBody(idx: number) {\n    const { onChange } = this.props;\n    if (onChange) {\n      const bodies = this.createBodies();\n      bodies.splice(idx, 1);\n      onChange(bodies);\n    }\n    this.hideOptionPanel();\n  }\n\n  /**\n   * \n   */\n  private createBodies(): BodyDefinitions {\n    return _.map(this.props.bodies, b =>\n      (b.rotation) ?\n        {\n          position: b.position.exp,\n          rotation: b.rotation.exp\n        } :\n        {\n          position: b.position.exp\n        }\n    );\n  }\n\n  /**\n   * \n   * @param idx \n   * @param body \n   */\n  private onChange(idx: number, body: BodyDefinition) {\n    const { onChange } = this.props;\n    if (onChange) {\n      const bodies = this.createBodies();\n      bodies[idx] = body;\n      onChange(bodies);\n    }\n  }\n\n  /**\n   * \n   */\n  private hasError() {\n    return _.flatMap(this.props.bodies, e => {\n      return e.rotation ? _.concat(e.position.errors, e.rotation.errors) : e.position.errors;\n    }).length > 0;\n  }\n\n  /**\n   * \n   */\n  render() {\n    const { bodies } = this.props;\n    const { modalShown, modalTitle, modalMessage, confirmAction } = this.state;\n    const rows = _.map(bodies, (body, idx) =>\n      <BodyRow key={idx} id={idx} body={body}\n        onChange={(body) => this.onChange(idx, body)}\n        onDelete={() => this.onDelete(idx)} />\n    );\n    return (\n      <Accordion defaultActiveKey=\"0\">\n        <Card>\n          <Accordion.Toggle as={Card.Header} eventKey=\"0\">\n            Bodies\n          </Accordion.Toggle>\n          <Accordion.Collapse eventKey=\"0\">\n            <Card.Body>\n              <Button size=\"sm\" variant=\"primary\"\n                onClick={() => this.onAdd()}>\n                <FontAwesomeIcon icon={faPlus} />\n              Add new body\n            </Button>\n              <hr></hr>\n              <Table striped size=\"sm\">\n                <thead>\n                  <tr>\n                    <th scope=\"col\">#</th>\n                    <th scope=\"col\">Position</th>\n                    <th scope=\"col\">Rotation</th>\n                    <th scope=\"col\">Remove</th>\n                  </tr>\n                  {rows}\n                </thead>\n              </Table>\n              <OptionPanel show={modalShown}\n                title={modalTitle}\n                message={modalMessage}\n                confirmButton=\"Remove\"\n                onConfirm={() => { if (confirmAction) { confirmAction(); } }}\n                onCancel={() => this.hideOptionPanel()}\n              />\n            </Card.Body>\n          </Accordion.Collapse>\n        </Card>\n      </Accordion >\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport { DefsPanel } from './DefsPanel';\nimport { default as _ } from 'lodash';\nimport { BodiesPanel } from './BodiesPane';\nimport { Form } from 'react-bootstrap';\nimport { SystemNode, ExpressionNodes } from './Interpreter';\nimport { SystemDefinition, Definitions, BodyDefinitions } from './Definitions';\n\ninterface EditorProps {\n  result: SystemNode;\n  onChange?: (conf: SystemDefinition) => void;\n};\n\n/**\n * \n */\nexport class Editor extends Component<EditorProps, {}> {\n\n  /**\n   * \n   */\n  private createConf() {\n    return {\n      bodies: this.createBodies(),\n      funcs: this.createDefs(this.props.result.funcs),\n      update: this.createDefs(this.props.result.update),\n      vars: this.createDefs(this.props.result.vars),\n    }\n  }\n\n  /**\n   * \n   */\n  private createBodies(): BodyDefinitions {\n    return _.map(this.props.result.bodies, b =>\n      (b.rotation) ?\n        {\n          position: b.position.exp,\n          rotation: b.rotation.exp\n        } :\n        {\n          position: b.position.exp\n        }\n    );\n  }\n\n  /**\n   * \n   * @param defs \n   */\n  private createDefs(defs: ExpressionNodes): Definitions {\n    return _.mapValues(defs, 'exp');\n  }\n\n  /**\n   * \n   * @param panelKey \n   * @param value \n   */\n  private onChange(panelKey: string, value: Definitions) {\n    const { onChange } = this.props;\n    if (onChange) {\n      const conf = this.createConf() as unknown as Record<string, Definitions>;\n      conf[panelKey] = value;\n      onChange(conf as unknown as SystemDefinition);\n    }\n  }\n\n  /**\n   * \n   * @param bodies \n   */\n  private onBodiesChange(bodies: BodyDefinitions) {\n    const { onChange } = this.props;\n    if (onChange) {\n      const conf = this.createConf();\n      conf.bodies = bodies;\n      onChange(conf);\n    }\n  }\n\n  render() {\n    const { result } = this.props;\n    return (\n      <Form noValidate >\n        <BodiesPanel bodies={this.props.result.bodies}\n          onChange={bodies => this.onBodiesChange(bodies)} />\n        <DefsPanel panelKey=\"funcs\" title=\"Macros\" defs={result.funcs}\n          onChange={(panelId, value) => this.onChange(panelId, value)}\n        />\n        <DefsPanel panelKey=\"vars\" title=\"Variables\" defs={this.props.result.vars}\n          onChange={(panelId, value) => this.onChange(panelId, value)}\n        />\n        <DefsPanel panelKey=\"update\" title=\"Update\" defs={this.props.result.update}\n          onChange={(panelId, value) => this.onChange(panelId, value)}\n        />\n      </Form>\n    );\n  }\n}\n","import * as BABYLON from 'babylonjs'\n\n/*\n * Returns the Color3 for HSB value (Hue, Saturation, Bright)\n */\nexport function fromHSB(h: number, s: number, b: number) {\n  var hc = null;\n  if (h <= 0) {\n    hc = BABYLON.Color3.Red();\n  } else if (h < 1 / 6) {\n    hc = new BABYLON.Color3(1, h * 6, 0);\n  } else if (h < 2 / 6) {\n    hc = new BABYLON.Color3(2 - 6 * h, 1, 0);\n  } else if (h < 3 / 6) {\n    hc = new BABYLON.Color3(0, 1, h * 6 - 2);\n  } else if (h < 4 / 6) {\n    hc = new BABYLON.Color3(0, 4 - h * 6, 1);\n  } else if (h < 5 / 6) {\n    hc = new BABYLON.Color3(h * 6 - 4, 0, 1);\n  } else if (h < 1) {\n    hc = new BABYLON.Color3(1, 0, 6 - h * 6);\n  } else {\n    hc = BABYLON.Color3.Red();\n  }\n  const sc = BABYLON.Color3.White().scale(1 - s).add(hc.scale(s));\n  return sc.scale(b);\n}\n\n/*\n * Returns the Color3 of heat color scale (Violet to Red)\n */\nexport function fromHeat(h: number) {\n  return fromHSB((1 - h) * 5 / 6, 1, 1 - (1 - h) * 0.2);\n}\n","import * as BABYLON from 'babylonjs';\nimport { default as _ } from 'lodash';\nimport * as hsb from './hsb-color-1.1.0';\n\nconst Octahedron = 1;\n// const ElongatedSquareDipyramid = 12;\n\nfunction createCamera(scene, options) {\n    var camera = null;\n    switch (options.cameraType) {\n        case 'do':\n            camera = new BABYLON.DeviceOrientationCamera('DevOr_camera', new BABYLON.Vector3(0, 0, 0), scene);\n            camera.position = options.cameraPosition;\n            camera.setTarget(BABYLON.Vector3.Zero());\n            camera.angularSensibility = 10;\n            camera.moveSensibility = 10;\n            break;\n        case 'ac':\n            camera = new BABYLON.AnaglyphArcRotateCamera('aar_cam', -Math.PI / 2, Math.PI / 4, 20, new BABYLON.Vector3.Zero(), 0.033, scene);\n            camera.target = BABYLON.Vector3.Zero();\n            camera.setPosition(options.cameraPosition);\n            return camera;\n        case 'vr':\n            camera = new BABYLON.VRDeviceOrientationArcRotateCamera('Camera', Math.PI / 2, Math.PI / 4, 25, new BABYLON.Vector3(0, 0, 0), scene);\n            camera.target = BABYLON.Vector3.Zero();\n            camera.setPosition(options.cameraPosition);\n            break;\n        default:\n            camera = new BABYLON.ArcRotateCamera('ArcRotateCamera', 1, 0.8, 10, new BABYLON.Vector3(0, 0, 0), scene);\n            camera.target = BABYLON.Vector3.Zero();\n            camera.setPosition(options.cameraPosition);\n            break;\n    }\n    camera.minZ = options.cameraMinZ;\n    return camera;\n}\n\nfunction createOcta(scene, name, color) {\n    const shape = BABYLON.MeshBuilder.CreatePolyhedron(\n        'Octa_' + name, {\n            type: Octahedron,\n            sizeX: 0.1,\n            sizeY: 0.2,\n            sizeZ: 0.05,\n        },\n        scene\n    );\n    shape.material = new BABYLON.StandardMaterial('Material_' + name, scene);\n    shape.material.ambientColor = color;\n    shape.material.diffuseColor = color;\n    return shape;\n}\n\nfunction createSphere(scene, name, color) {\n    const sphere = BABYLON.MeshBuilder.CreateIcoSphere(\n        'Sphere_' + name, {\n            flat: 0,\n            radius: 0.1,\n            subdivisions: 4,\n            updatable: false\n        },\n        scene);\n    sphere.material = new BABYLON.StandardMaterial('Material_' + name, scene);\n    sphere.material.ambientColor = color;\n    sphere.material.diffuseColor = color;\n    return sphere;\n}\n\nexport class Leibniz {\n    constructor(props) {\n        this.props = props;\n    }\n\n    init(options) {\n        const _options = _.defaults(options || {}, {\n            cameraType: 'do',\n            cameraPosition: new BABYLON.Vector3(0, 0, -10),\n            cameraMinZ: 0.5,\n            ambientColor: new BABYLON.Color3(0.2, 0.2, 0.2),\n            sunLightDirection: new BABYLON.Vector3(1, 1, -1),\n            sunLightIntensity: 0.7,\n            subSteps: 1\n        });\n\n        this._subSteps = _options.subSteps;\n\n        const camera = createCamera(this.props.scene, _options);\n        camera.attachControl(this.props.canvas, true);\n\n        // This creates a light, aiming 0,1,0 - to the sky (non-mesh)\n        const light = new BABYLON.HemisphericLight(\n            'sunLight',\n            _options.sunLightDirection,\n            this.props.scene);\n        light.intensity = _options.sunLightIntensity;\n\n        this.props.scene.ambientColor = _options.ambientColor;\n\n        this._state = {\n            funcs: {},\n            vars: {},\n            update: {},\n            bodies: [],\n            next: () => this._state\n        };\n\n        this.props.scene.onBeforeStepObservable.add((scene) => {\n            const ar = scene.getAnimationRatio() || 1;\n            const dt = ar / 60 / this.subSteps;\n            for (var i = 0; i < this.subSteps; i++) {\n                this.refreshTime(dt);\n            }\n        });\n\n        // Adds callback handler on rendering loop\n        this.props.engine.runRenderLoop(() => {\n            this.refreshScene();\n            this.props.scene.render();\n        });\n    }\n\n    set system(system) {\n\n        // Cleans up scene\n        _.each(this._shapes, shape =>\n            this.props.scene.removeMesh(shape, true)\n        );\n\n        const shapes = _.map(system.bodies, (body, i, ary) => {\n            const name = 'Body' + i;\n            const color = hsb.fromHeat(ary.length > 1 ? i / (ary.length - 1) : 0);\n            const shape = (body.rotation !== undefined)\n                ? createOcta(this.props.scene, name, color)\n                : createSphere(this.props.scene, name, color);\n            this.updateShape(shape, body);\n            return shape;\n        });\n        this._shapes = shapes;\n        this._state = system;\n        //this.props.engine.render();\n        return this;\n    }\n\n    get subSteps() {\n        return this._subSteps;\n    }\n\n    set subSteps(value) {\n        this._subSteps = value;\n    }\n\n\n    refreshTime(dt) {\n        this._state = this._state.next(dt);\n    }\n\n    refreshScene() {\n        _.each(_.zip(this._state.bodies, this._shapes), (ary) =>\n            this.updateShape(ary[1], ary[0])\n        );\n    }\n\n    updateShape(shape, body) {\n        const pos = new BABYLON.Vector3(\n            body.position.values[0][0],\n            body.position.values[1][0],\n            body.position.values[2][0]);\n        shape.position = pos;\n        if (body.rotation) {\n            const rot = new BABYLON.Quaternion.FromArray(body.rotation.values);\n            shape.rotationQuaternion = rot;\n        }\n    }\n\n    refresh() {\n        this.props.engine.resize();\n    }\n}\n","import React, { Component } from 'react';\nimport { Form } from 'react-bootstrap';\nimport { SystemParser } from './leibniz-ast-0.1.1';\n\n/*\n * this.props.result = parse state\n */\nexport class Test extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = this.createNewState(\n      JSON.stringify(props.initialConf ||\n      {\n        vars: {\n          a: \"0\"\n        },\n        funcs: {\n          b: \"0\"\n        },\n        update: {},\n        bodies: []\n      }, null, '  '));\n  }\n\n  onInput(value) {\n    this.setState(this.createNewState(value));\n  }\n\n  createNewState(conf) {\n    var text;\n    try {\n      const cfg = JSON.parse(conf);\n      const result = new SystemParser(cfg).parse();\n      text = JSON.stringify(result, null, '  ');\n    } catch (e) {\n      console.error(e);\n      text = e.toString();\n    }\n    return {\n      conf: conf,\n      result: text\n    };\n  }\n\n  render() {\n    return (\n      <form>\n        <Form.Group controlId=\"conf\">\n          <Form.Label>Configuration</Form.Label>\n          <Form.Control componentClass=\"textarea\" placeholder=\"Configuration\"\n            rows=\"5\"\n            value={this.state.conf}\n            onInput={(ev) => this.onInput(ev.target.value)}\n            onChange={() => { }} />\n        </Form.Group>\n        <Form.Group>\n          <Form.Label>Result</Form.Label>\n          <Form.Control.Static><pre>{this.state.result}</pre></Form.Control.Static>\n        </Form.Group>\n      </form>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport { Modal, Button, Form } from 'react-bootstrap';\n\ninterface ImportFileProps {\n  show: boolean;\n  onCancel?: () => void\n  onFileRead?: (arg: string | ArrayBuffer | null) => void;\n  onError?: (arg: string) => void;\n};\n\n/**\n * \n */\nexport class ImportFile extends Component<ImportFileProps, {}>{\n\n  /**\n   * \n   * @param file \n   */\n  private onFileChange(file: Blob) {\n    const { onFileRead, onError } = this.props;\n    if (onFileRead) {\n      const fr = new FileReader();\n      fr.onload = (e) => {\n        onFileRead(fr.result);\n      };\n      fr.onerror = (event) => {\n        console.error(event);\n        if (onError) {\n          onError(event.toString());\n        }\n      };\n      try {\n        fr.readAsText(file);\n      } catch (e) {\n        console.error(e);\n        if (onError) {\n          onError(e.toString());\n        }\n      }\n    }\n  }\n\n  /**\n   * \n   */\n  render() {\n    const { show, onCancel } = this.props;\n    return (\n      <Modal size=\"lg\" show={show} onHide={() => { if (onCancel) { onCancel(); } }}>\n        <Modal.Header closeButton>\n          <Modal.Title>Import definitions from file ?</Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          <p>The definitions will be imported from the selected file.</p>\n          <Form>\n            <Form.File\n              label=\"Import file\"\n              custom\n              onChange={(ev: any) => this.onFileChange(ev.target.files[0])}\n            />\n          </Form>\n        </Modal.Body>\n        <Modal.Footer>\n          <Button variant=\"primary\" onClick={() => { if (onCancel) { onCancel(); } }}>Cancel</Button>\n        </Modal.Footer>\n      </Modal >\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport { default as _ } from 'lodash';\nimport { Button, Row, Form, Container } from 'react-bootstrap';\nimport { saveAs } from 'file-saver';\nimport { System } from './Interpreter';\n\ninterface DumpPanelProps {\n  result: System;\n};\n\n/**\n * \n */\nexport class DumpPanel extends Component<DumpPanelProps, {\n  counts: string;\n  dt: string;\n}> {\n\n  /**\n   * \n   * @param props \n   */\n  constructor(props: DumpPanelProps) {\n    super(props);\n    this.state = {\n      counts: '10',\n      dt: '0.1'\n    };\n  }\n\n  /**\n   * \n   */\n  private dumpData() {\n    const { result } = this.props;\n    const { dt: dtString, counts: countsString } = this.state;\n    const dt = parseFloat(dtString);\n    const counts = parseInt(countsString);\n    var sys = result.system;\n    if (sys) {\n      const dumpTable = [];\n      for (var i = 0; i < counts; i++) {\n        dumpTable.push(sys.dumpWithDt(dt));\n        sys = sys.next(dt);\n      }\n      const keys = _(dumpTable[0]).keys().sortBy().value();\n      const header = _.reduce(keys, (a, b) => a + ',' + b) + '\\n\\r';\n      const rows = _(dumpTable).map(row =>\n        _(keys).map(k =>\n          '\"' + row[k].toString() + '\"').reduce((a, b) => a + ',' + b)\n      ).reduce((a, b) => a + '\\n\\r' + b) + '\\n\\r';\n      const blob = new Blob([header + rows], { type: \"text/plain;charset=utf-8\" });\n      saveAs(blob, \"dump.csv\");\n    }\n  }\n\n  /**\n   * \n   * @param value \n   */\n  private setCounts(value: string) {\n    this.setState({ counts: value });\n  }\n\n  /**\n   * \n   * @param value \n   */\n  private setDt(value: string) {\n    this.setState({ dt: value });\n  }\n\n  /**\n   * \n   */\n  render() {\n    const { result } = this.props;\n    const dumpDisabled = !result.system;\n    return (\n      <Container>\n        <Row>\n          <Form noValidate inline>\n            <Form.Group controlId=\"formInlineName\">\n              <Form.Label>Counts</Form.Label>{' '}\n              <Form.Control type=\"text\" placeholder=\"Counts\"\n                onChange={ev => this.setCounts(ev.target.value)}\n                value={this.state.counts} />\n            </Form.Group>{' '}\n            <Form.Group controlId=\"formInlineName\" >\n              <Form.Label>dt</Form.Label>{' '}\n              <Form.Control type=\"text\" placeholder=\"dt\"\n                onChange={ev => this.setDt(ev.target.value)}\n                value={this.state.dt} />\n            </Form.Group>\n            <Button variant=\"primary\"\n              disabled={dumpDisabled}\n              onClick={() => this.dumpData()} >Download</Button>\n          </Form>\n        </Row>\n      </Container>\n    );\n  }\n}\n","import React, { FunctionComponent } from 'react';\nimport './App.css';\nimport { Navbar, Nav, NavDropdown } from 'react-bootstrap';\n\n\n/**\n * \n */\nexport const LbNavBar: FunctionComponent<Readonly<{\n  onReset?: () => void;\n  onLoad?: (arg: string) => void;\n  onImport?: () => void;\n  onExport?: () => void;\n}>> = ({ onReset, onLoad, onImport, onExport }) => {\n  const home = process.env.REACT_APP_BASENAME;\n  return (\n    <Navbar variant=\"dark\" bg=\"dark\" expand=\"lg\" >\n      <Navbar.Brand href=\"http://www.mmarini.org\">www.mmarini.org</Navbar.Brand>\n      <Navbar.Toggle aria-controls=\"navbar-nav\" />\n      <Navbar.Collapse id=\"navbar-nav\">\n        <Nav className=\"mr-auto\">\n          <Nav.Link href={home}>Leibniz {process.env.REACT_APP_VERSION}</Nav.Link>\n          <NavDropdown id=\"predefined-menu\" title=\"Predefined\">\n            <NavDropdown.Item\n              onSelect={() => { if (onReset) { onReset(); } }}>\n              Reset\n              </NavDropdown.Item>\n              <NavDropdown.Item\n              onSelect={() => { if (onLoad) { onLoad('sample1.json'); } }}>\n              Basic sample\n            </NavDropdown.Item>\n            <NavDropdown.Item\n              onSelect={() => { if (onLoad) { onLoad('bodies3.json'); } }}>\n              3 Bodies\n            </NavDropdown.Item>\n            <NavDropdown.Item\n              onSelect={() => { if (onLoad) { onLoad('solaris.json'); } }}>\n              Solaris (Earth - Sun)\n            </NavDropdown.Item>\n            <NavDropdown.Item\n              onSelect={() => { if (onLoad) { onLoad('selene.json'); } }}>\n              Selene (Moon -Earth)\n              </NavDropdown.Item>\n          </NavDropdown>\n          <Nav.Link\n            onClick={() => { if (onImport) { onImport(); } }}>\n            Import\n          </Nav.Link>\n          <Nav.Link\n            onClick={() => { if (onExport) { onExport(); } }}>\n            Export\n          </Nav.Link>\n        </Nav>\n      </Navbar.Collapse>\n    </Navbar>\n  );\n}\n","import React, { FunctionComponent } from 'react';\nimport { Alert } from 'react-bootstrap';\n\nexport const LbAlert: FunctionComponent<Partial<{\n    isVisible: boolean;\n    onClose: () => void;\n    title: string;\n    message: string;\n}>> = ({ isVisible = false, onClose, title, message }) => {\n\n    return isVisible ? (\n        <Alert variant=\"danger\" dismissible\n            onClose={() => { if (onClose) { onClose(); } }}>\n            <Alert.Heading>{title}</Alert.Heading>\n            <p>{message}</p>\n        </Alert>\n    ) : (\n            <span />\n        );\n}\n","import React, { Component } from 'react';\nimport { Form, FormGroup, FormControl, Tabs, Tab, Container } from 'react-bootstrap';\nimport * as Cookies from 'js-cookie';\nimport { saveAs } from 'file-saver';\nimport './App.css';\nimport { BabylonScene } from './SceneComponent';\nimport { Editor } from './Editor';\nimport { SystemParser } from './leibniz-ast-0.1.1';\nimport { Leibniz } from './leibniz-0.1.3';\nimport { Test } from './Test';\nimport { ImportFile } from './ImportFile';\nimport { OptionPanel } from './OptionPanel';\nimport { DumpPanel } from './DumpPanel';\nimport { ajax } from 'rxjs/ajax';\nimport { tap } from 'rxjs/operators';\nimport { LbNavBar } from './LbNavBar';\nimport { LbAlert } from './LbAlert';\nimport { SystemDefinition } from './Definitions';\n\nconst conf1 = {\n  bodies: [],\n  funcs: {},\n  vars: {},\n  update: {}\n};\n\ninterface AppState {\n  alertShow: boolean;\n  alertTitle?: string;\n  alertMessage?: string;\n  modalShown: boolean;\n  importModalShown: boolean;\n  result: any;\n  subSteps: string;\n  initialConf: any;\n  optionShow?: boolean;\n  optionTitle?: string;\n  optionMessage?: string;\n  optionConfirmBtn?: string;\n  optionConfirm?: () => void,\n  conf?: any;\n}\n\nexport class App extends Component<{}, AppState> {\n  private leibniz: Leibniz | undefined;\n\n  /**\n   * \n   * @param props \n   */\n  constructor(props: {}) {\n    super(props);\n\n    const cfgCookie = Cookies.get('leibniz');\n    const cfg = cfgCookie ? JSON.parse(cfgCookie) : conf1;\n\n    this.state = {\n      subSteps: \"1\",\n      alertShow: false,\n      modalShown: false,\n      importModalShown: false,\n      initialConf: cfg,\n      result: {\n        parserState: {\n          bodies: [],\n          funcs: {},\n          update: {},\n          vars: {}\n        }\n      }\n    };\n  }\n\n  /**\n   * \n   * @param conf \n   */\n  private processConf(conf: SystemDefinition) {\n    const result = new SystemParser(conf).parse();\n    const state = {\n      conf: conf,\n      result: result\n    };\n    Cookies.set('leibniz', JSON.stringify(conf));\n    if (result.system && this.leibniz) {\n      this.leibniz.system = result.system;\n    }\n    return state;\n  }\n\n  /**\n   * \n   * @param conf \n   */\n  private onChange(conf: SystemDefinition) {\n    this.setState(this.processConf(conf));\n  }\n\n  /**\n   * \n   * @param e \n   */\n  private onSceneMount(e: any) {\n    const leibniz = new Leibniz(e);\n    leibniz.init({\n      cameraType: 'ar',\n      subSteps: this.state.subSteps\n    });\n    this.leibniz = leibniz;\n    this.setState(this.processConf(this.state.initialConf));\n  }\n\n  /**\n   * \n   */\n  private onReset() {\n    this.showOptionPanel(\n      'Reset definitions ?',\n      'The definitions will be resetted to default value.',\n      'Reset',\n      () => this.reset()\n    );\n  }\n\n  private onLoad(name: string) {\n    this.showOptionPanel(\n      'Load definitions ' + name + ' ?',\n      'The definitions will be load from ' + name + ' .',\n      'Load',\n      () => this.load(name)\n    );\n  }\n\n  /**\n   * \n   * @param optionTitle \n   * @param optionMessage \n   * @param optionConfirmBtn \n   * @param optionConfirm \n   */\n  private showOptionPanel(optionTitle: string, optionMessage: string, optionConfirmBtn: string, optionConfirm: () => void) {\n    this.setState({\n      optionShow: true,\n      optionTitle,\n      optionMessage,\n      optionConfirmBtn,\n      optionConfirm\n    });\n  }\n\n  /**\n   * \n   */\n  private hideOptionPanel() {\n    this.setState({ optionShow: false });\n  }\n\n  /**\n   * \n   * @param title \n   * @param message \n   */\n  private showAlert(title: string, message: string) {\n    this.setState({\n      alertShow: true,\n      alertTitle: title,\n      alertMessage: message\n    });\n  }\n\n  /**\n   * \n   */\n  private hideAlert() {\n    this.setState({ alertShow: false });\n  }\n\n  /**\n   * \n   */\n  private reset() {\n    const state = this.processConf(conf1);\n    this.setState(state);\n    this.hideOptionPanel();\n  }\n\n  /**\n   * \n   * @param name \n   */\n  private load(name: string) {\n    const url = process.env.REACT_APP_BASENAME + '/' + name;\n    ajax.getJSON(url).pipe(\n      tap(\n        json => this.onLoaded(json as SystemDefinition),\n        ajax => this.onLoadError(ajax)\n      )\n    ).subscribe();\n  }\n\n  /**\n   * \n   * @param json \n   */\n  private onLoaded(json: SystemDefinition) {\n    console.log(json);\n    const state = this.processConf(json);\n    this.setState(state);\n    this.hideOptionPanel();\n  }\n\n  private onLoadError(ajax: any) {\n    console.error(ajax);\n    const msg = ajax.xhr.status + ' - ' + ajax.xhr.statusText;\n    console.error(msg);\n    this.showAlert('Error', msg);\n    this.hideOptionPanel();\n  }\n\n  /**\n   * \n   */\n  private test() {\n    return (\n      <Tab eventKey=\"test\" title=\"Test\">\n        <Test initialConf={{\n          vars: {\n            \"a\": \"a0\",\n            \"b\": \"inv(a0)\",\n            \"c\": \"a*b\"\n          }, funcs: {\n            \"a0\": \"T((8,1,6),(3,5,7),(4,9,2))\",\n          }, bodies: [], update: {}\n        }} />\n      </Tab>\n    );\n  }\n\n  /**\n   * \n   */\n  private showImportPanel() {\n    this.setState({ importModalShown: true });\n  }\n\n  /**\n   * \n   */\n  private hideImportPanel() {\n    this.setState({ importModalShown: false });\n  }\n\n  /**\n   * \n   * @param content \n   */\n  private importFile(content: string) {\n    try {\n      const state = this.processConf(JSON.parse(content));\n      this.setState(state);\n      this.hideAlert();\n      this.hideImportPanel();\n    } catch (e) {\n      console.error('Error parsing', content);\n      this.onError(e);\n    }\n  }\n\n  /**\n   * \n   * @param e \n   */\n  private onError(e: string) {\n    this.showAlert('Error', 'Error parsing file ' + e);\n    this.hideImportPanel();\n  }\n\n  /**\n   * \n   */\n  private showExportPanel() {\n    this.showOptionPanel(\n      'Export definitions ?',\n      'The definitions will be exported into a local file.',\n      'Export',\n      () => this.exportFile()\n    );\n  }\n\n  /**\n   * \n   * @param value \n   */\n  private setSubSteps(value: string) {\n    this.setState({ subSteps: value });\n    if (this.leibniz) {\n      this.leibniz.subSteps = parseInt(value);\n    }\n  }\n\n  /**\n   * \n   */\n  private exportFile() {\n    const text = JSON.stringify(this.state.conf, null, '  ');\n    const blob = new Blob([text], { type: \"text/plain;charset=utf-8\" });\n    saveAs(blob, \"test.json\");\n    this.hideOptionPanel();\n  }\n\n  /**\n   * \n   */\n  render() {\n    const {\n      alertShow, alertTitle, alertMessage,\n      importModalShown,\n      optionShow, optionTitle, optionMessage, optionConfirmBtn, optionConfirm,\n      result, subSteps\n    } = this.state;\n    return (\n      <Container fluid>\n        <LbNavBar\n          onReset={() => this.onReset()}\n          onLoad={(file) => this.onLoad(file)}\n          onImport={() => this.showImportPanel()}\n          onExport={() => this.showExportPanel()}\n        />\n        <LbAlert isVisible={alertShow}\n          title={alertTitle}\n          message={alertMessage}\n          onClose={() => this.hideAlert()} />\n        <Container>\n          <Tabs id=\"Tab\" defaultActiveKey=\"home\">\n            <Tab eventKey=\"home\" title=\"Home\">\n              <BabylonScene onSceneMount={(ev: any) => this.onSceneMount(ev)}\n                canvasClass=\"graphCanvas\" />\n              <Form inline>\n                <FormGroup controlId=\"formInlineName\">\n                  <Form.Label>Sub Steps</Form.Label>{' '}\n                  <FormControl type=\"text\" placeholder=\"Sub Steps\"\n                    onChange={ev => this.setSubSteps(ev.target.value)}\n                    value={subSteps} />\n                </FormGroup>{' '}\n              </Form>\n            </Tab>\n            <Tab eventKey=\"editor\" title=\"Editor\">\n              <Editor result={result.parserState} onChange={conf => this.onChange(conf)} />\n            </Tab>\n            <Tab eventKey=\"dump\" title=\"Dump panel\">\n              <DumpPanel result={result} />\n            </Tab>\n          </Tabs>\n        </Container>\n        <ImportFile show={importModalShown}\n          onCancel={() => this.hideImportPanel()}\n          onFileRead={file => this.importFile(file as string)}\n          onError={e => this.onError(e)} />\n        <OptionPanel show={!!optionShow}\n          title={optionTitle}\n          message={optionMessage}\n          confirmButton={optionConfirmBtn || ''}\n          onCancel={() => this.hideOptionPanel()}\n          onConfirm={optionConfirm} />\n      </Container>\n    );\n  }\n}\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport { App } from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}