(this.webpackJsonpleibnitz=this.webpackJsonpleibnitz||[]).push([[0],{73:function(e,t,r){},85:function(e,t,r){},94:function(e,t,r){"use strict";r.r(t);var n=r(2),o=r(0),a=r.n(o),i=r(27),s=r.n(i),c=(r(85),r(8)),u=r(9),l=r(11),d=r(10),h=r(107),p=r(104),f=r(117),v=r(110),w=r(77),y=r(78),b=r(71),j=r(57),m=(r(73),r(12)),O=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){var e;Object(c.a)(this,r);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).onResizeWindow=function(){e.engine&&e.engine.resize()},e}return Object(u.a)(r,[{key:"componentDidMount",value:function(){this.engine=new m.Engine(this.canvas,!0,{deterministicLockstep:!0,lockstepMaxSteps:4});var e=new m.Scene(this.engine);this.scene=e,"function"===typeof this.props.onSceneMount?this.props.onSceneMount({scene:e,engine:this.engine,canvas:this.canvas}):console.error("onSceneMount function not available"),window.addEventListener("resize",this.onResizeWindow)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onResizeWindow)}},{key:"onCanvasLoaded",value:function(e){null!==e&&(this.canvas=e)}},{key:"render",value:function(){var e=this;return Object(n.jsx)("canvas",{className:this.props.canvasClass,ref:function(t){return e.onCanvasLoaded(t)}})}}]),r}(a.a.Component),x=r(113),k=r(115),M=r(102),g=r(76),C=r(30),E=r(31),S=function(e){var t=e.name,r=e.expr,o=e.errors,a=void 0===o?[]:o,i=e.withoutDelete,s=void 0!==i&&i,c=e.onDelete,u=e.onChange,l=a.length>0,d=a.map((function(e,t){return Object(n.jsx)("li",{children:e},t)})),h=s?"":Object(n.jsx)(M.a.Append,{children:Object(n.jsx)(g.a,{variant:"danger",onClick:function(){c&&c()},children:Object(n.jsx)(C.a,{icon:E.b})})});return Object(n.jsx)(v.a.Group,{children:Object(n.jsxs)(M.a,{size:"sm",children:[Object(n.jsx)(M.a.Prepend,{children:t}),Object(n.jsx)(v.a.Control,{type:"text",value:r,onChange:function(e){u&&u(e.target.value)},isValid:!l,isInvalid:!!l}),h,Object(n.jsx)(v.a.Control.Feedback,{type:"invalid",children:Object(n.jsx)("ul",{children:d})})]})})},I=r(1),_=r.n(I),z=r(109),A=function(e){var t=e.show,r=e.title,o=e.message,a=e.confirmButton,i=e.onCancel,s=e.onConfirm;return Object(n.jsxs)(z.a,{show:t,size:"sm",onHide:function(){i&&i()},children:[Object(n.jsx)(z.a.Header,{closeButton:!0,children:Object(n.jsx)(z.a.Title,{children:r})}),Object(n.jsx)(z.a.Body,{children:o}),Object(n.jsxs)(z.a.Footer,{children:[Object(n.jsx)(g.a,{variant:"primary",onClick:function(){i&&i()},children:"Cancel"}),Object(n.jsx)(g.a,{variant:"danger",onClick:function(){s&&s()},children:a})]})]})};function V(e,t){if(!e)throw new Error(t||"Assert failed")}var R=function(){function e(t){Object(c.a)(this,e),V(4===t.length,"Assert failed: (values.length === 4), values.length="+t.length),this._values=t}return Object(u.a)(e,[{key:"toString",value:function(){return"("+this.i+"*i+"+this.j+"*j+"+this.k+"*k+"+this.w+")"}},{key:"negate",value:function(){return new e(_.a.map(this.values,(function(e){return-e})))}},{key:"add",value:function(t){return new e(_()(this.values).zip(t.values).map((function(e){return _.a.sum(e)})).value())}},{key:"addValue",value:function(t){return new e([this.i,this.j,this.k,this.w+t])}},{key:"subtractValue",value:function(t){return new e([this.i,this.j,this.k,this.w-t])}},{key:"subtractFromValue",value:function(t){return new e([-this.i,-this.j,-this.k,t-this.w])}},{key:"subtract",value:function(t){return new e(_()(this.values).zip(t.values).map((function(e){return e[0]-e[1]})).value())}},{key:"scale",value:function(t){return new e(_.a.map(this.values,(function(e){return e*t})))}},{key:"multiply",value:function(t){var r=this.i,n=this.j,o=this.k,a=this.w,i=t.i,s=t.j,c=t.k,u=t.w;return new e([a*i+r*u+n*c-o*s,a*s+n*u+o*i-r*c,a*c+o*u+r*s-n*i,a*u-r*i-n*s-o*c])}},{key:"inverse",value:function(){var t=this.i,r=this.j,n=this.k,o=this.w,a=t*t+r*r+n*n+o*o;return new e([-t/a,-r/a,-n/a,o/a])}},{key:"divide",value:function(t){var r=this.i,n=this.j,o=this.k,a=this.w,i=t.i,s=t.j,c=t.k,u=t.w,l=i*i+s*s+c*c+u*u;return new e([(-a*i+r*u-n*c+o*s)/l,(-a*s+n*u-o*i+r*c)/l,(-a*c+o*u-r*s+n*i)/l,(a*u+r*i+n*s+o*c)/l])}},{key:"module",value:function(){var e=this.i,t=this.j,r=this.k,n=this.w;return Math.sqrt(e*e+t*t+r*r+n*n)}},{key:"norma",value:function(){var t=this.i,r=this.j,n=this.k,o=this.w,a=Math.sqrt(t*t+r*r+n*n+o*o);return a>Number.MIN_VALUE?new e([t/a,r/a,n/a,o/a]):new e([0,0,0,1])}},{key:"values",get:function(){return this._values}},{key:"i",get:function(){return this._values[0]}},{key:"j",get:function(){return this._values[1]}},{key:"k",get:function(){return this._values[2]}},{key:"w",get:function(){return this._values[3]}}]),e}(),q=function(){function e(t){Object(c.a)(this,e),this._values=t}return Object(u.a)(e,[{key:"toString",value:function(){return"["+_()(this.values).map((function(e){return"["+_.a.reduce(e,(function(e,t){return e+","+t}))+"]"})).reduce((function(e,t){return e+","+t}))+"]"}},{key:"map",value:function(t){return new e(_.a.map(this.values,(function(e,r){return _.a.map(e,(function(e,n){return t(e,r,n)}))})))}},{key:"trace",value:function(){for(var e=Math.min(this.rows,this.cols),t=0,r=0;r<e;r++)t+=this.values[r][r];return t}},{key:"negate",value:function(){return this.map((function(e){return-e}))}},{key:"zipMap",value:function(t,r){return V(this.rows===t.rows&&this.cols===t.cols,"Assert failed: (this.rows === other.rows && this.cols === other.cols), this.rows="+this.rows+",other.rows="+t.rows+",this.cols="+this.cols+",other.cols="+t.cols),new e(_.a.map(this.values,(function(e,n){return _.a.map(e,(function(e,o){return r(e,t.values[n][o],n,o)}))})))}},{key:"add",value:function(e){return this.zipMap(e,_.a.add)}},{key:"subtract",value:function(e){return this.zipMap(e,_.a.subtract)}},{key:"scale",value:function(e){return this.map((function(t){return t*e}))}},{key:"divide",value:function(e){return this.map((function(t){return t/e}))}},{key:"resize",value:function(t,r){var n=this.rows,o=this.cols,a=_()(this.values).take(Math.min(n,t)).map((function(e){for(var t=_.a.take(e,Math.min(o,r)),n=0;n<r-o;n++)t.push(0);return t})).value(),i=t>n?_.a.map(_.a.range(t-n),(function(){return _.a.map(_.a.range(r),(function(){return 0}))})):[];return new e(_.a.concat(a,i))}},{key:"transpose",value:function(){for(var t=this.rows,r=this.cols,n=new Array(r),o=0;o<r;o++){n[o]=Array(t);for(var a=0;a<t;a++)n[o][a]=this.values[a][o]}return new e(n)}},{key:"multiply",value:function(t){V(this.cols===t.rows,"Assert failed: (this.cols === other.rows), this.cols="+this.cols+",other.rows="+t.rows);for(var r=this.rows,n=t.cols,o=this.cols,a=new Array(r),i=0;i<r;i++){a[i]=Array(n);for(var s=0;s<n;s++){for(var c=0,u=0;u<o;u++)c+=this.values[i][u]*t.values[u][s];a[i][s]=c}}return new e(a)}},{key:"append",value:function(t){V(this.rows===t.rows,"Assert failed: (this.rows === other.rows), this.rows="+this.rows+",other.rows="+t.rows);for(var r=this.rows,n=this.cols,o=t.cols,a=new Array(r),i=0;i<r;i++){a[i]=Array(n+o);for(var s=0;s<n+o;s++)a[i][s]=s<n?this.values[i][s]:t.values[i][s-n]}return new e(a)}},{key:"insertAt",value:function(t,r){V(1===this.cols,"Assert failed: (this.cols === 1), this.cols="+this.cols),V(t>=0&&t<=this.rows,"Assert failed: (idx >= 0 && idx <= this.rows), idx="+t+", this.cols="+this.cols);for(var n=this.rows,o=new Array(n+1),a=0;a<=n;++a)o[a]=a<t?this.values[a]:a===t?[r]:this.values[a-1];return new e(o)}},{key:"qrot",value:function(){V(3===this.rows&&1===this.cols,"Assert failed: (this.rows === 3 && this.cols === 1), this.rows="+this.rows+", this.cols="+this.cols);var e=this.values[0][0],t=this.values[1][0],r=this.values[2][0],n=Math.sqrt(e*e+t*t+r*r);if(n>Number.MIN_VALUE){var o=n/2,a=Math.cos(o),i=Math.sin(o);return new R([i*e/n,i*t/n,i*r/n,a])}return new R([0,0,0,1])}},{key:"cyl",value:function(){V(3===this.rows&&1===this.cols,"Assert failed: (this.rows === 3 && this.cols === 1), this.rows="+this.rows+", this.cols="+this.cols);var t=this.values[0][0],r=this.values[1][0],n=this.values[2][0];return new e([[t*Math.sin(r)],[t*Math.cos(r)],[n]])}},{key:"sphere",value:function(){V(3===this.rows&&1===this.cols,"Assert failed: ((this.rows === 3 && this.cols === 1), this.rows="+this.rows+",this.cols="+this.cols);var t=this.values[0][0],r=this.values[1][0],n=this.values[2][0],o=t*Math.sin(r);return new e([[o*Math.cos(n)],[o*Math.sin(n)],[t*Math.cos(r)]])}},{key:"cyl1",value:function(){V(3===this.rows&&1===this.cols,"Assert failed: (this.rows === 3 && this.cols === 1), this.rows="+this.rows+", this.cols="+this.cols);var t=this.values[0][0],r=this.values[1][0],n=Math.sin(r),o=Math.cos(r);return new e([[o,-t*n,0],[n,t*o,0],[0,0,1]])}},{key:"sphere1",value:function(){V(3===this.rows&&1===this.cols,"Assert failed: (this.rows === 3 && this.cols === 1), this.rows="+this.rows+", this.cols="+this.cols);var t=this.values[0][0],r=this.values[1][0],n=this.values[2][0],o=Math.sin(r),a=Math.cos(r),i=Math.sin(n),s=Math.cos(n),c=o*s,u=o*i;return new e([[c,t*(a*s),-t*u],[u,t*a*s,t*c],[a,-t*o,0]])}},{key:"inverse",value:function(){var t=this.gaussJordan().enchelon,r=this.rows;return new e(_.a.map(t,(function(e){return _.a.drop(e,r)})))}},{key:"det",value:function(){var e=this.gaussJordan().det;return e}},{key:"gaussJordan",value:function(){V(this.rows===this.cols,"Assert failed: (this.rows === this.cols), this.rows="+this.rows+", this.cols="+this.cols);for(var e=this.rows,t=Array(e),r=0;r<e;r++)t[r]=Array(2*e);for(r=0;r<e;r++)for(var n=0;n<e;n++)t[r][n]=this.values[r][n],t[r][n+e]=r===n?1:0;for(var o=1,a=0,i=0;a<e&&i<e;){var s=a,c=Math.abs(t[a][i]);for(r=a+1;r<e;r++){var u=Math.abs(t[r][i]);u>c&&(s=r,c=u)}if(0===c)i++;else{var l=t[s];for(t[s]=t[a],t[a]=l,o=-o,r=a+1;r<e;r++){var d=t[r][i]/t[a][i];for(t[r][i]=0,n=i+1;n<2*e;n++)t[r][n]-=t[a][n]*d}a++,i++}}for(V(a===i,"Inverse matrix does not exist"),a=e-1;a>=0;a--){for(r=0;r<a;r++){var h=t[r][a]/t[a][a];for(t[r][a]=0,n=a+1;n<2*e;n++)t[r][n]-=t[a][n]*h}for(n=a+1;n<2*e;n++)t[a][n]/=t[a][a];o*=t[a][a],t[a][a]=1}return{enchelon:t,det:o}}},{key:"min",value:function(){return _()(this.values).map((function(e){return _()(e).min()})).min()}},{key:"max",value:function(){return _()(this.values).map((function(e){return _()(e).max()})).max()}},{key:"values",get:function(){return this._values}},{key:"rows",get:function(){return this.values.length}},{key:"cols",get:function(){return this.values.length>0?this.values[0].length:0}}]),e}();function T(e){return{apply:function(){return e},code:["value "+e]}}var P={createDet:function(e){return{apply:function(t){return e.apply(t).det()},code:_.a.concat(e.code,["det"])}},createMatrixInverse:function(e){return{apply:function(t){return e.apply(t).inverse()},code:_.a.concat(e.code,["matrix inv"])}},createQuatInverse:function(e){return{apply:function(t){return e.apply(t).inverse()},code:_.a.concat(e.code,["quat inv"])}},createValueInverse:function(e){return{apply:function(t){return 1/e.apply(t)},code:_.a.concat(e.code,["inv"])}},createSphere1:function(e){return{apply:function(t){return e.apply(t).sphere1()},code:_.a.concat(e.code,["sphere1"])}},createCyl1:function(e){return{apply:function(t){return e.apply(t).cyl1()},code:_.a.concat(e.code,["cyl1"])}},createSphere:function(e){return{apply:function(t){return e.apply(t).sphere()},code:_.a.concat(e.code,["sphere"])}},createCyl:function(e){return{apply:function(t){return e.apply(t).cyl()},code:_.a.concat(e.code,["cyl"])}},createValueNorma:function(e){return{apply:function(e){return 1},code:T(1)}},createQuatNorma:function(e){return{apply:function(t){return e.apply(t).norma()},code:_.a.concat(e.code,["quatNorma"])}},createVectNorma:function(e){return{apply:function(t){var r=e.apply(t),n=Math.sqrt(r.transpose().multiply(r).values[0][0]);return r.divide(n)},code:_.a.concat(e.code,["vecNorma"])}},createTrace:function(e){return{apply:function(t){return e.apply(t).trace()},code:_.a.concat(e.code,["trace"])}},createSinh:function(e){return{apply:function(t){return Math.sinh(e.apply(t))},code:_.a.concat(e.code,["sinh"])}},createCosh:function(e){return{apply:function(t){return Math.cosh(e.apply(t))},code:_.a.concat(e.code,["cosh"])}},createTanh:function(e){return{apply:function(t){return Math.tanh(e.apply(t))},code:_.a.concat(e.code,["tanh"])}},createLog:function(e){return{apply:function(t){return Math.log(e.apply(t))},code:_.a.concat(e.code,["log"])}},createAtan:function(e){return{apply:function(t){return Math.atan(e.apply(t))},code:_.a.concat(e.code,["atan"])}},createAcos:function(e){return{apply:function(t){return Math.acos(e.apply(t))},code:_.a.concat(e.code,["acos"])}},createAsin:function(e){return{apply:function(t){return Math.asin(e.apply(t))},code:_.a.concat(e.code,["asin"])}},createTan:function(e){return{apply:function(t){return Math.tan(e.apply(t))},code:_.a.concat(e.code,["tan"])}},createField:T,createQuaternion:function(e){return{apply:function(){return new R(e)},code:["quat "+e]}},createVector:function(e){var t=_.a.map(e,(function(e){return[e]}));return{apply:function(){return new q(t)},code:["vector "+e]}},createMatrix:function(e){return{apply:function(){return new q(e)},code:["matrix "+e]}},createRef:function(e){return{apply:function(t){return t.resolve(e)},code:["ref "+e]}},createQrot:function(e){return{apply:function(t){return e.apply(t).qrot()},code:_.a.concat(e.code,["qrot"])}},createNegateField:function(e){return{apply:function(t){return-e.apply(t)},code:_.a.concat(e.code,["negate value"])}},createNegateQuat:function(e){return{apply:function(t){return e.apply(t).negate()},code:_.a.concat(e.code,["negate quaternion"])}},createNegateVector:function(e){return{apply:function(t){return e.apply(t).negate()},code:_.a.concat(e.code,["negate vector"])}},createNegateMatrix:function(e){return{apply:function(t){return e.apply(t).negate()},code:_.a.concat(e.code,["negate matrix"])}},createProduct:function(e,t){return{apply:function(r){return e.apply(r)*t.apply(r)},code:_.a.concat(e.code,t.code,["multiply value"])}},createScaleVector:function(e,t){return{apply:function(r){return e.apply(r).scale(t.apply(r))},code:_.a.concat(e.code,t.code,["scale vector"])}},createScaleMatrix:function(e,t){return{apply:function(r){return e.apply(r).scale(t.apply(r))},code:_.a.concat(e.code,t.code,["scale matrix"])}},createScalarProduct:function(e,t){return{apply:function(r){return e.apply(r).transpose().multiply(t.apply(r))},code:_.a.concat(e.code,t.code,["multiply vector"])}},createMatrixVectorProduct:function(e,t){return{apply:function(r){return e.apply(r).multiply(t.apply(r))},code:_.a.concat(e.code,t.code,["multiply matrix by vector"])}},createMatrixProduct:function(e,t){return{apply:function(r){return e.apply(r).multiply(t.apply(r))},code:_.a.concat(e.code,t.code,["multiply matrix"])}},createResizeVector:function(e,t){return{apply:function(r){return e.apply(r).resize(t,1)},code:_.a.concat(e.code,["resize vector to "+t])}},createResizeMatrix:function(e,t,r){return{apply:function(n){return e.apply(n).resize(t,r)},code:_.a.concat(e.code,["resize matrix to "+t+","+r])}},createVectorModule:function(e){return{apply:function(t){var r=e.apply(t);return Math.sqrt(r.transpose().multiply(r).values[0][0])},code:_.a.concat(e.code,["vect module"])}},createDivideField:function(e,t){return{apply:function(r){return e.apply(r)/t.apply(r)},code:_.a.concat(e.code,t.code,["divide value"])}},createDivideVector:function(e,t){return{apply:function(r){return e.apply(r).divide(t.apply(r))},code:_.a.concat(e.code,t.code,["divide vector"])}},createDivideMatrix:function(e,t){return{apply:function(r){return e.apply(r).divide(t.apply(r))},code:_.a.concat(e.code,t.code,["divide matrix"])}},createSumField:function(e,t){return{apply:function(r){return e.apply(r)+t.apply(r)},code:_.a.concat(e.code,t.code,["add value"])}},createSumVector:function(e,t){return{apply:function(r){return e.apply(r).add(t.apply(r))},code:_.a.concat(e.code,t.code,["add vector"])}},createSumMatrix:function(e,t){return{apply:function(r){return e.apply(r).add(t.apply(r))},code:_.a.concat(e.code,t.code,["add matrix"])}},createSubField:function(e,t){return{apply:function(r){return e.apply(r)-t.apply(r)},code:_.a.concat(e.code,t.code,["subtrac value"])}},createSubVector:function(e,t){return{apply:function(r){return e.apply(r).subtract(t.apply(r))},code:_.a.concat(e.code,t.code,["subtract vector"])}},createSubMatrix:function(e,t){return{apply:function(r){return e.apply(r).subtract(t.apply(r))},code:_.a.concat(e.code,t.code,["subtract matrix"])}},createPower:function(e,t){return{apply:function(r){return Math.pow(e.apply(r),t.apply(r))},code:_.a.concat(e.code,t.code,["power"])}},createCatField:function(e,t){return{apply:function(r){var n=e.apply(r),o=t.apply(r);return new q([[n],[o]])},code:_.a.concat(e.code,t.code,["concat values"])}},createInsertFieldAt:function(e,t,r){return{apply:function(n){var o=e.apply(n),a=t.apply(n);return o.insertAt(r,a)},code:_.a.concat(e.code,t.code,["insert value at "+r])}},createCatVector:function(e,t){return{apply:function(r){var n=e.apply(r),o=t.apply(r);return n.append(o)},code:_.a.concat(e.code,t.code,["concat vectors"])}},createInsertVector:function(e,t){return{apply:function(r){var n=e.apply(r);return t.apply(r).append(n)},code:_.a.concat(e.code,t.code,["insert vector"])}},createAppendVector:function(e,t){return{apply:function(r){var n=e.apply(r),o=t.apply(r);return n.append(o)},code:_.a.concat(e.code,t.code,["append vector"])}},createAppendMatrix:function(e,t){return{apply:function(r){var n=e.apply(r),o=t.apply(r);return n.append(o)},code:_.a.concat(e.code,t.code,["concat matrix"])}},createTransposeMatrix:function(e){return{apply:function(t){return e.apply(t).transpose()},code:_.a.concat(e.code,["transpose"])}},createSin:function(e){return{apply:function(t){return Math.sin(e.apply(t))},code:_.a.concat(e.code,["sin"])}},createCos:function(e){return{apply:function(t){return Math.cos(e.apply(t))},code:_.a.concat(e.code,["cos"])}},createExp:function(e){return{apply:function(t){return Math.exp(e.apply(t))},code:_.a.concat(e.code,["exp"])}},createQuatModule:function(e){return{apply:function(t){return e.apply(t).module()},code:_.a.concat(e.code,["quat module"])}},createSumQuatField:function(e,t){return{apply:function(r){return e.apply(r).addValue(t.apply(r))},code:_.a.concat(e.code,t.code,["add quat value"])}},createSumQuat:function(e,t){return{apply:function(r){return e.apply(r).add(t.apply(r))},code:_.a.concat(e.code,t.code,["add quat"])}},createSubFieldQuat:function(e,t){return{apply:function(r){return t.apply(r).subtractFromValue(e.apply(r))},code:_.a.concat(e.code,t.code,["sub value quat"])}},createSubQuatField:function(e,t){return{apply:function(r){return e.apply(r).subtractValue(t.apply(r))},code:_.a.concat(e.code,t.code,["sub quat value"])}},createSubQuat:function(e,t){return{apply:function(r){return e.apply(r).subtract(t.apply(r))},code:_.a.concat(e.code,t.code,["sub quat"])}},createField2Quat:function(e){return{apply:function(t){return new R([0,0,0,e.apply(t)])},code:_.a.concat(e.code,["value to quat"])}},createScaleQuat:function(e,t){return{apply:function(r){return e.apply(r).scale(t.apply(r))},code:_.a.concat(e.code,t.code,["scale quat"])}},createProductQuat:function(e,t){return{apply:function(r){return e.apply(r).multiply(t.apply(r))},code:_.a.concat(e.code,t.code,["multiply quat"])}},createDivQuatField:function(e,t){return{apply:function(r){var n=e.apply(r),o=t.apply(r);return n.scale(1/o)},code:_.a.concat(e.code,t.code,["div quat value"])}},createDivQuat:function(e,t){return{apply:function(r){var n=e.apply(r),o=t.apply(r);return n.divide(o)},code:_.a.concat(e.code,t.code,["div quat"])}},createSqrt:function(e){return{apply:function(t){return Math.sqrt(e.apply(t))},code:_.a.concat(e.code,["sqrt"])}},createMinVec:function(e){return{apply:function(t){return e.apply(t).min()},code:_.a.concat(e.code,["min vector"])}},createMinMat:function(e){return{apply:function(t){return e.apply(t).min()},code:_.a.concat(e.code,["min matrix"])}},createMaxVec:function(e){return{apply:function(t){return e.apply(t).max()},code:_.a.concat(e.code,["max vector"])}},createMaxMat:function(e){return{apply:function(t){return e.apply(t).max()},code:_.a.concat(e.code,["max matrix"])}},createAbs:function(e){return{apply:function(t){return Math.abs(e.apply(t))},code:_.a.concat(e.code,["module"])}}},F="Number",D="Identifier",N="Symbol",B=r(92),L=/[a-zA-Z_][a-zA-Z0-9_]*/,$=/^[a-zA-Z_][a-zA-Z0-9_]*$/,Q=/\d+\.?\d*/,U=/\d+\.?\d*[eE][+-]?\d+/,K=/^i$|^j$|^k$|^I\d+$|^dt$|^ex$|^ey$|^ez$|^e\d+$|^tr$|^det$|^n$|^T$|^inv$|^exp$|^sinh$|^cosh$|^tanh$|^sin$|^cos$|^tan$|^asin$|^acos$|^atan$|^log$|^sqrt$|^cyl$|^sphere$|^cyl1$|^sphere1$|^qrot$|^e$|^PI$|^min$|^max$/;function J(e){return e.match($)?e.match(K)?'Name "'+e+'" must not be a reserved keyword':null:'Name "'+e+'" must be an identifier'}var Z=function(){function e(t){Object(c.a)(this,e),this._conf=t}return Object(u.a)(e,[{key:"build",value:function(){var e=this;return this._defs={vars:{},funcs:{}},_.a.each(this._conf.funcs,(function(t,r){e.buildRef(r)})),_.a.each(this._conf.vars,(function(t,r){e.buildRef(r)})),_.a.each(this._conf.funcs,(function(t,r){var n=e._defs.funcs[r];t.errors=n?_.a.concat(t.errors,n.errors):t.errors,t.result=n})),_.a.each(this._conf.vars,(function(t,r){var n=e._defs.vars[r];t.errors=n?_.a.concat(t.errors,n.errors):t.errors,t.result=n})),_.a.each(this._conf.update,(function(t,r){var n=e.buildExp(t.node);t.errors=n?_.a.concat(t.errors,n.errors):t.errors,t.result=n})),_.a.each(this._conf.bodies,(function(t,r){var n=e.buildExp(t.position.node);if(t.position.errors=n?_.a.concat(t.position.errors,n.errors):t.position.errors,t.position.result=n,t.rotation){var o=e.buildExp(t.rotation.node);t.rotation.errors=o?_.a.concat(t.rotation.errors,o.errors):t.rotation.errors,t.rotation.result=o}})),this._conf}},{key:"buildRef",value:function(e){var t=this._defs.funcs[e]||this._defs.vars[e];if(t)return t;var r,n=this._conf.vars[e],o=this._conf.funcs[e];return o?(this._defs.funcs[e]=re,this._defs.funcs[e]=this.buildExp(o.node),this._defs.funcs[e]):n?(this._defs.vars[e]=re,this._defs.vars[e]=this.buildExp(n.node),this._defs.vars[e]):(r=e,new te(G,0,0,[P.createField(0)],["Unresolved reference "+r]))}},{key:"buildExp",value:function(e){return e.build(this)}}]),e}(),H=function(){function e(t,r,n,o){Object(c.a)(this,e),this._vars=t,this._funcs=r,this._update=n,this._bodies=o}return Object(u.a)(e,[{key:"next",value:function(e){return this.withDt(e).nextState()}},{key:"nextState",value:function(){var t=this;return new e(_.a.mapValues(this._vars,(function(e,r){var n=t._update[r];return n?n.apply(t):e})),this._funcs,this._update,this._bodies)}},{key:"withDt",value:function(t){var r=_.a.cloneDeep(this._funcs);return r.dt=P.createField(t),new e(this._vars,r,this._update,this._bodies)}},{key:"resolve",value:function(e){var t=this._funcs[e];return t?t.apply(this):this._vars[e]}},{key:"dump",value:function(){var e=this,t=_.a.mapValues(this._funcs,(function(t){return t.apply(e)}));return _.a.assign(t,this._vars)}},{key:"dumpWithDt",value:function(e){return this.withDt(e).dump()}},{key:"bodies",get:function(){var e=this;return _.a.map(this._bodies,(function(t){var r={position:t.position.apply(e)};return t.rotation&&(r.rotation=t.rotation.apply(e)),r}))}}]),e}(),W=function(){function e(t){Object(c.a)(this,e),this._config=t,this._parserAst=new Ke}return Object(u.a)(e,[{key:"parse",value:function(){var e=this.parseAll(),t=this.checkForNameDefinitions(e),r=this.checkForFunctionsRedefinition(t),n=this.checkForUpdateDefinition(r),o=this.build(n),a=this.checkForUpdateTypeDefinition(o),i=this.checkForBodiesTypeDefinition(a);return{parserState:i,errors:this.createErrors(i),system:0===this.errorCount(i)?this.buildSystem(i):void 0}}},{key:"checkForNameDefinitions",value:function(e){return _()(e.update).each((function(e,t){var r=J(t);r&&e.errors.push(r)})),_()(e.funcs).each((function(e,t){var r=J(t);r&&e.errors.push(r)})),_()(e.vars).each((function(e,t){var r=J(t);r&&e.errors.push(r)})),e}},{key:"parseAll",value:function(){var e=this,t=_.a.mapValues(this._config.vars,(function(t){var r=e._parserAst.parse(t);return{exp:t,errors:e._parserAst.errors,node:r}})),r=_.a.mapValues(this._config.funcs,(function(t){var r=e._parserAst.parse(t);return{exp:t,errors:e._parserAst.errors,node:r}})),n=_.a.map(this._config.bodies,(function(t){var r=e._parserAst.parse(t.position),n=e._parserAst.errors,o={position:{exp:t.position,errors:n,node:r}};if(t.rotation){var a=e._parserAst.parse(t.rotation),i=e._parserAst.errors;o.rotation={exp:t.rotation,errors:i,node:a}}return o})),o=_.a.mapValues(this._config.update,(function(t){var r=e._parserAst.parse(t);return{exp:t,errors:e._parserAst.errors,node:r}}));return this._result={vars:t,funcs:r,bodies:n,update:o},this._result}},{key:"errorCount",value:function(e){return _()(e.vars).map((function(e){return e.errors.length})).sum()+_()(e.funcs).map((function(e){return e.errors.length})).sum()+_()(e.update).map((function(e){return e.errors.length})).sum()+_()(e.bodies).map((function(e){return e.position.errors.length+(e.rotation?e.rotation.errors.length:0)})).sum()}},{key:"checkForBodiesTypeDefinition",value:function(e){return _.a.each(e.bodies,(function(e){(e.position.result.type!==Y&&e.position.errors.push("Position must be a vector"),e.rotation)&&(e.rotation.result.type!==X&&e.rotation.errors.push("Rotation must be a quaternion"))})),e}},{key:"createErrors",value:function(e){return{funcs:_.a.mapValues(e.funcs,"errors"),vars:_.a.mapValues(e.vars,"errors"),update:_.a.mapValues(e.update,"errors"),bodies:_.a.map(e.bodies,(function(e){var t={position:e.position.errors};return e.rotation&&(t.rotation=e.rotation.errors),t}))}}},{key:"buildSystem",value:function(e){var t=_.a.mapValues(e.funcs,(function(e){return e.result.code})),r=_.a.mapValues(e.vars,(function(e){return e.result.code})),n={resolve:function(e){return(t[e]||r[e]).apply(n)}},o=_.a.mapValues(e.vars,(function(e){return e.result.code.apply(n)})),a=_.a.mapValues(e.update,(function(e){return e.result.code})),i=_.a.map(e.bodies,(function(e){var t=e.position.result.code,r={position:3!==e.position.result.rows?P.createResizeVector(t,3):t};return e.rotation&&(e.rotation.result.type===X?r.rotation=e.rotation.result.code:r.rotation=P.createField2Quat(e.rotation.result.code)),r}));return new H(o,t,a,i)}},{key:"build",value:function(e){return new Z(e).build()}},{key:"checkForUpdateDefinition",value:function(e){return _()(e.update).each((function(t,r){(function(t){return void 0!==e.vars[t]})(r)||t.errors.push("Update "+r+" is not a variable")})),e}},{key:"checkForFunctionsRedefinition",value:function(e){return _()(e.vars).each((function(t,r){(function(t){return"dt"===t||void 0!==e.funcs[t]})(r)&&t.errors.push("Function "+r+" cannot be redefined as variable")})),e}},{key:"checkForUpdateTypeDefinition",value:function(e){function t(e){switch(e.type){case G:return"scalar";case X:return"quaternion";case Y:return"vector ["+e.rows+"]";default:return"matrix ["+e.rows+", "+e.cols+"]"}}return _.a.each(e.update,(function(r,n){var o=e.vars[n]&&e.vars[n].result;if(o){var a=r.result;o.type===a.type&&(o.type===G||o.type===Y&&o.rows===a.rows||o.type===ee&&o.rows===a.rows&&o.rows===a.rows)||r.errors.push("Update ("+t(a)+") must be the same of var ("+t(o)+")")}})),e}}]),e}(),G="Field",X="Quaternion",Y="Vector",ee="Matrix",te=function(){function e(t,r,n,o,a){Object(c.a)(this,e),this._type=t,this._rows=r||0,this._cols=n||0,this._code=o||[],this._errors=a||[]}return Object(u.a)(e,[{key:"withType",value:function(t){return new e(t,this.rows,this.cols,this.code,this.errors)}},{key:"withRows",value:function(t){return new e(this.type,t,this.cols,this.code,this.errors)}},{key:"withCols",value:function(t){return new e(this.type,this.rows,t,this.code,this.errors)}},{key:"withSize",value:function(t,r){return new e(this.type,t,r,this.code,this.errors)}},{key:"withCode",value:function(t){return new e(this.type,this.rows,this.cols,t,this.errors)}},{key:"withErrors",value:function(t){return new e(this.type,this.rows,this.cols,this.code,t)}},{key:"withMoreErrors",value:function(){return this.withErrors(_.a.flatten(_.a.concat(this._errors,arguments)))}},{key:"withTypeOf",value:function(t){return new e(t.type,t.rows,t.cols,this.code,this.errors)}},{key:"code",get:function(){return this._code}},{key:"rows",get:function(){return this._rows}},{key:"cols",get:function(){return this._cols}},{key:"type",get:function(){return this._type}},{key:"errors",get:function(){return this._errors}}]),e}(),re=new te(G,0,0,[P.createField(0)],["Circular reference"]),ne=function(){function e(){Object(c.a)(this,e)}return Object(u.a)(e,[{key:"validate",value:function(e){throw new Error("Not implemented")}},{key:"build",value:function(){throw new Error("Not implemented")}},{key:"dependencies",get:function(){return[]}}]),e}(),oe=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(e){var n;return Object(c.a)(this,r),(n=t.call(this))._value=e,n}return Object(u.a)(r,[{key:"build",value:function(e){return new te(G,0,0,P.createField(this.value))}},{key:"value",get:function(){return this._value}}]),r}(ne),ae=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(e){var n;return Object(c.a)(this,r),(n=t.call(this))._value=e,n}return Object(u.a)(r,[{key:"build",value:function(e){return new te(X,0,0,P.createQuaternion(this.value))}},{key:"value",get:function(){return this._value}}]),r}(ne),ie=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(e){var n;return Object(c.a)(this,r),(n=t.call(this))._size=e,n}return Object(u.a)(r,[{key:"build",value:function(e){var t=this,r=_.a.map(_.a.range(this.size+1),(function(e){return e===t.size?1:0}));return new te(Y,this.size+1,0,P.createVector(r))}},{key:"size",get:function(){return this._size}}]),r}(ne),se=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(e){var n;return Object(c.a)(this,r),(n=t.call(this))._size=e,n}return Object(u.a)(r,[{key:"build",value:function(e){var t=this,r=_.a.map(_.a.range(this.size),(function(e){return _.a.map(_.a.range(t.size),(function(t){return e===t?1:0}))}));return new te(ee,this.size,this.size,P.createMatrix(r))}},{key:"size",get:function(){return this._size}}]),r}(ne),ce=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(e){var n;return Object(c.a)(this,r),(n=t.call(this))._id=e,n}return Object(u.a)(r,[{key:"build",value:function(e){return e.buildRef(this.id).withCode(P.createRef(this.id))}},{key:"dependencies",get:function(){return[this.id]}},{key:"id",get:function(){return this._id}}]),r}(ne),ue=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(e){var n;return Object(c.a)(this,r),(n=t.call(this))._id=e,n}return Object(u.a)(r,[{key:"build",value:function(e){return new te(G,0,0,P.createRef("dt"))}}]),r}(ne),le=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(e){var n;return Object(c.a)(this,r),(n=t.call(this))._arg=e,n}return Object(u.a)(r,[{key:"dependencies",get:function(){return this.arg.dependencies}},{key:"arg",get:function(){return this._arg}}]),r}(ne),de=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg.build(e);switch(t.type){case G:return t.withCode(P.createNegateField(t.code));case X:return t.withCode(P.createNegateQuat(t.code));case Y:return t.withCode(P.createNegateVector(t.code));default:return t.withCode(P.createNegateMatrix(t.code))}}}]),r}(le),he=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg.build(e);switch(t.type){case G:return t.withCode(P.createAbs(t.code));case X:return t.withType(G).withCode(P.createQuatModule(t.code));case Y:return t.withType(G).withCode(P.createVectorModule(t.code));default:return t.withMoreErrors(["Invalid module operation on matrix"])}}}]),r}(le),pe=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg.build(e);switch(t.type){case G:return t.withMoreErrors(["Invalid transpose operation on value"]);case X:return t.withMoreErrors(["Invalid transpose operation on quaternion"]);case Y:return t.withMoreErrors(["Invalid transpose operation on vector"]);default:return t.withSize(t.cols,t.rows).withCode(P.createTransposeMatrix(t.code))}}}]),r}(le),fe=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg.build(e);switch(t.type){case G:return t.withCode(P.createSqrt(t.code));case X:return t.withMoreErrors(["Invalid sqrt operation on quaterion"]);case Y:return t.withMoreErrors(["Invalid sqrt operation on vector"]);default:return t.withMoreErrors(["Invalid sqrt operation on matrix"])}}}]),r}(le),ve=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg.build(e);switch(t.type){case G:return t.withCode(P.createExp(t.code));case X:return t.withMoreErrors(["Invalid exp operation on quaterion"]);case Y:return t.withMoreErrors(["Invalid exp operation on vector"]);default:return t.withMoreErrors(["Invalid exp operation on matrix"])}}}]),r}(le),we=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg.build(e);switch(t.type){case G:return t.withCode(P.createSin(t.code));case X:return t.withMoreErrors(["Invalid sin operation on quaternion"]);case Y:return t.withMoreErrors(["Invalid sin operation on vector"]);default:return t.withMoreErrors(["Invalid sin operation on matrix"])}}}]),r}(le),ye=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg.build(e);switch(t.type){case G:return t.withCode(P.createCos(t.code));case X:return t.withMoreErrors(["Invalid cos operation on quaternion"]);case Y:return t.withMoreErrors(["Invalid cos operation on vector"]);default:return t.withMoreErrors(["Invalid cos operation on matrix"])}}}]),r}(le),be=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg.build(e);switch(t.type){case G:return t.withCode(P.createTan(t.code));case X:return t.withMoreErrors(["Invalid tan operation on quaternion"]);case Y:return t.withMoreErrors(["Invalid tan operation on vector"]);default:return t.withMoreErrors(["Invalid tan operation on matrix"])}}}]),r}(le),je=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg.build(e);switch(t.type){case G:return t.withCode(P.createAsin(t.code));case X:return t.withMoreErrors(["Invalid asin operation on quaternion"]);case Y:return t.withMoreErrors(["Invalid asin operation on vector"]);default:return t.withMoreErrors(["Invalid asin operation on matrix"])}}}]),r}(le),me=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg.build(e);switch(t.type){case G:return t.withCode(P.createAcos(t.code));case X:return t.withMoreErrors(["Invalid acos operation on quaternion"]);case Y:return t.withMoreErrors(["Invalid acos operation on vector"]);default:return t.withMoreErrors(["Invalid acos operation on matrix"])}}}]),r}(le),Oe=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg.build(e);switch(t.type){case G:return t.withCode(P.createAtan(t.code));case X:return t.withMoreErrors(["Invalid atan operation on quaternion"]);case Y:return t.withMoreErrors(["Invalid atan operation on vector"]);default:return t.withMoreErrors(["Invalid atan operation on matrix"])}}}]),r}(le),xe=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg.build(e);switch(t.type){case G:return t.withCode(P.createSinh(t.code));case X:return t.withMoreErrors(["Invalid sinh operation on quaternion"]);case Y:return t.withMoreErrors(["Invalid sinh operation on vector"]);default:return t.withMoreErrors(["Invalid sinh operation on matrix"])}}}]),r}(le),ke=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg.build(e);switch(t.type){case G:return t.withCode(P.createCosh(t.code));case X:return t.withMoreErrors(["Invalid cosh operation on quaternion"]);case Y:return t.withMoreErrors(["Invalid cosh operation on vector"]);default:return t.withMoreErrors(["Invalid cosh operation on matrix"])}}}]),r}(le),Me=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg.build(e);switch(t.type){case G:return t.withCode(P.createTanh(t.code));case X:return t.withMoreErrors(["Invalid tanh operation on quaternion"]);case Y:return t.withMoreErrors(["Invalid tanh operation on vector"]);default:return t.withMoreErrors(["Invalid tanh operation on matrix"])}}}]),r}(le),ge=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg.build(e);switch(t.type){case G:return t.withCode(P.createLog(t.code));case X:return t.withMoreErrors(["Invalid log operation on quaternion"]);case Y:return t.withMoreErrors(["Invalid log operation on vector"]);default:return t.withMoreErrors(["Invalid log operation on matrix"])}}}]),r}(le),Ce=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg.build(e);switch(t.type){case G:return t.withMoreErrors(["Invalid qrot operation on value"]);case X:return t.withMoreErrors(["Invalid qrot operation on quaternion"]);case Y:var r=3!==t.rows?P.createResizeVector(t.code,3):t.code;return t.withType(X).withCode(P.createQrot(r));default:return t.withMoreErrors(["Invalid qrot operation on matrix"])}}}]),r}(le),Ee=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(e,n){var o;return Object(c.a)(this,r),(o=t.call(this))._arg1=e,o._arg2=n,o}return Object(u.a)(r,[{key:"dependencies",get:function(){return _.a.concat(this.arg1.dependencies,this.arg2.dependencies)}},{key:"arg1",get:function(){return this._arg1}},{key:"arg2",get:function(){return this._arg2}}]),r}(ne),Se=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg1.build(e),r=this.arg2.build(e);switch(t.type){case G:switch(r.type){case G:return t.withMoreErrors(r.errors).withCode(P.createPower(t.code,r.code));case X:return t.withMoreErrors(r.errors,["Invalid power value and quaternion"]);case Y:return t.withMoreErrors(r.errors,["Invalid power value and vector"]);default:return t.withMoreErrors(r.errors,["Invalid power value and matrix"])}case X:return t.withMoreErrors(r.errors,["Invalid power quaternion and anything"]);case Y:return t.withMoreErrors(r.errors,["Invalid power vector and anything"]);default:return t.withMoreErrors(r.errors,["Invalid power matrix and anything"])}}}]),r}(Ee),Ie=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg1.build(e),r=this.arg2.build(e);switch(t.type){case G:switch(r.type){case G:return t.withMoreErrors(r.errors).withType(Y).withRows(2).withCode(P.createCatField(t.code,r.code));case X:return t.withMoreErrors(r.errors,["Invalid append value and quaternion"]);case Y:return t.withMoreErrors(r.errors).withType(Y).withRows(r.rows+1).withCode(P.createInsertFieldAt(r.code,t.code,0));default:return t.withMoreErrors(r.errors,["Invalid append value and matrix"])}case X:return t.withMoreErrors(r.errors,["Invalid append quaternion and anything"]);case Y:switch(r.type){case G:return t.withMoreErrors(r.errors).withRows(t.rows+1).withCode(P.createInsertFieldAt(t.code,r.code,t.rows));case X:return t.withMoreErrors(r.errors,["Invalid append vector and quaternion"]);case Y:var n=t.rows<r.rows?P.createResizeVector(t.code,r.rows):t.code,o=t.rows>r.rows?P.createResizeVector(r.code,t.rows):r.code;return t.withMoreErrors(r.errors).withType(ee).withSize(Math.max(t.rows,r.rows),2).withCode(P.createCatVector(n,o));default:var a=t.rows<r.rows?P.createResizeVector(t.code,r.rows):t.code,i=t.rows>r.rows?P.createResizeMatrix(r.code,t.rows,r.cols):r.code;return t.withMoreErrors(r.errors).withType(ee).withSize(Math.max(t.rows,r.rows),t.cols+1).withCode(P.createInsertVector(i,a))}default:switch(r.type){case G:return t.withMoreErrors(r.errors,["Invalid append matrix and value"]);case X:return t.withMoreErrors(r.errors,["Invalid append matrix and quaternion"]);case Y:var s=t.rows<r.rows?P.createResizeMatrix(t.code,r.rows,t.cols):t.code,c=t.rows>r.rows?P.createResizeVector(r.code,t.rows,r.cols):r.code;return t.withMoreErrors(r.errors).withType(ee).withSize(Math.max(t.rows,r.rows),t.cols+1).withCode(P.createAppendVector(s,c));default:var u=t.rows<r.rows?P.createResizeMatrix(t.code,r.rows,t.cols):t.code,l=t.rows>r.rows?P.createResizeMatrix(r.code,t.rows,r.cols):r.code;return t.withMoreErrors(r.errors).withType(ee).withSize(Math.max(t.rows,r.rows),t.cols+r.cols).withCode(P.createAppendMatrix(u,l))}}}}]),r}(Ee),_e=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg1.build(e),r=this.arg2.build(e);switch(t.type){case G:switch(r.type){case G:return t.withMoreErrors(r.errors).withCode(P.createSumField(t.code,r.code));case X:return t.withMoreErrors(r.errors).withType(X).withCode(P.createSumQuatField(r.code,t.code));case Y:return t.withMoreErrors(r.errors,["Invalid sum value and vector"]);default:return t.withMoreErrors(r.errors,["Invalid sum value and matrix"])}case X:switch(r.type){case G:return t.withMoreErrors(r.errors).withCode(P.createSumQuatField(t.code,r.code));case X:return t.withMoreErrors(r.errors).withCode(P.createSumQuat(t.code,r.code));case Y:return t.withMoreErrors(r.errors,["Invalid sum quaternion and vector"]);default:return t.withMoreErrors(r.errors,["Invalid sum quaternion and matrix"])}case Y:switch(r.type){case G:return t.withMoreErrors(r.errors,["Invalid sum vector and value"]);case X:return t.withMoreErrors(r.errors,["Invalid sum vector and quaternion"]);case Y:var n=t.rows<r.rows?P.createResizeVector(t.code,r.rows):t.code,o=t.rows>r.rows?P.createResizeVector(r.code,t.rows):r.code;return t.withMoreErrors(r.errors).withRows(Math.max(t.rows,r.rows)).withCode(P.createSumVector(n,o));default:return t.withMoreErrors(r.errors,["Invalid sum vector and matrix"])}default:switch(r.type){case G:return t.withMoreErrors(r.errors,["Invalid sum matrix and value"]);case X:return t.withMoreErrors(r.errors,["Invalid sum matrix and quaternion"]);case Y:return t.withMoreErrors(r.errors,["Invalid sum matrix and vector"]);default:var a=Math.max(t.rows,r.rows),i=Math.max(t.cols,r.cols),s=t.rows<r.rows||t.cols<r.cols?P.createResizeMatrix(t.code,a,i):t.code,c=t.rows>r.rows||t.cols>r.cols?P.createResizeMatrix(r.code,a,i):r.code;return t.withMoreErrors(r.errors).withSize(a,i).withCode(P.createSumMatrix(s,c))}}}}]),r}(Ee),ze=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg1.build(e),r=this.arg2.build(e);switch(t.type){case G:switch(r.type){case G:return t.withMoreErrors(r.errors).withCode(P.createSubField(t.code,r.code));case X:return t.withMoreErrors(r.errors).withType(X).withCode(P.createSubFieldQuat(t.code,r.code));case Y:return t.withMoreErrors(r.errors,["Invalid sub value and vector"]);default:return t.withMoreErrors(r.errors,["Invalid sub value and matrix"])}case X:switch(r.type){case G:return t.withMoreErrors(r.errors).withCode(P.createSubQuatField(t.code,r.code));case X:return t.withMoreErrors(r.errors).withCode(P.createSubQuat(t.code,r.code));case Y:return t.withMoreErrors(r.errors,["Invalid sub quaternion and vector"]);default:return t.withMoreErrors(r.errors,["Invalid sub quaternion and matrix"])}case Y:switch(r.type){case G:return t.withMoreErrors(r.errors,["Invalid sub vector and value"]);case X:return t.withMoreErrors(r.errors,["Invalid sub vector and quaternion"]);case Y:var n=t.rows<r.rows?P.createResizeVector(t.code,r.rows):t.code,o=t.rows>r.rows?P.createResizeVector(r.code,t.rows):r.code;return t.withMoreErrors(r.errors).withRows(Math.max(t.rows,r.rows)).withCode(P.createSubVector(n,o));default:return t.withMoreErrors(r.errors,["Invalid sub vector and matrix"])}default:switch(r.type){case G:return t.withMoreErrors(r.errors,["Invalid sub matrix and value"]);case X:return t.withMoreErrors(r.errors,["Invalid sub matrix and quaternion"]);case Y:return t.withMoreErrors(r.errors,["Invalid sub matrix and vector"]);default:var a=Math.max(t.rows,r.rows),i=Math.max(t.cols,r.cols),s=t.rows<r.rows||t.cols<r.cols?P.createResizeMatrix(t.code,a,i):t.code,c=t.rows>r.rows||t.cols>r.cols?P.createResizeMatrix(r.code,a,i):r.code;return t.withMoreErrors(r.errors).withSize(a,i).withCode(P.createSubMatrix(s,c))}}}}]),r}(Ee),Ae=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg1.build(e),r=this.arg2.build(e);switch(t.type){case G:switch(r.type){case G:return t.withMoreErrors(r.errors).withCode(P.createProduct(t.code,r.code));case X:return t.withTypeOf(r).withMoreErrors(r.errors).withType(X).withCode(P.createScaleQuat(r.code,t.code));case Y:return t.withTypeOf(r).withMoreErrors(r.errors).withCode(P.createScaleVector(r.code,t.code));default:return t.withTypeOf(r).withMoreErrors(r.errors).withCode(P.createScaleMatrix(r.code,t.code))}case X:switch(r.type){case G:return t.withMoreErrors(r.errors).withType(X).withCode(P.createScaleQuat(t.code,r.code));case X:return t.withTypeOf(r).withMoreErrors(r.errors).withType(X).withCode(P.createProductQuat(t.code,r.code));case Y:return t.withMoreErrors(r.errors,["Invalid multiplication quaternion by vector"]);default:return t.withMoreErrors(r.errors,["Invalid multiplication quaternion by matrix"])}case Y:switch(r.type){case G:return t.withMoreErrors(r.errors).withCode(P.createScaleVector(t.code,r.code));case X:return t.withMoreErrors(r.errors,["Invalid multiplication vector by quaternion"]);case Y:var n=t.rows>r.rows?P.createResizeVector(t.code,r.rows):t.code,o=t.rows<r.rows?P.createResizeVector(r.code,t.rows):r.code;return t.withType(G).withMoreErrors(r.errors).withCode(P.createScalarProduct(n,o));default:return t.withMoreErrors(r.errors,["Invalid multiplication vector by matrix"])}default:switch(r.type){case G:return t.withMoreErrors(r.errors).withCode(P.createScaleMatrix(t.code,r.code));case X:return t.withMoreErrors(r.errors,["Invalid multiplication matrix by quaternion"]);case Y:var a=t.cols>r.rows?P.createResizeMatrix(t.code,t.rows,r.rows):t.code,i=t.cols<r.rows?P.createResizeVector(r.code,t.cols):r.code;return t.withTypeOf(Y).withRows(t.rows).withMoreErrors(r.errors).withCode(P.createMatrixVectorProduct(a,i));default:var s=t.cols>r.rows?P.createResizeMatrix(t.code,t.rows,r.rows):t.code,c=t.cols<r.rows?P.createResizeMatrix(r.code,t.cols,r.cols):r.code;return t.withSize(t.rows,r.cols).withMoreErrors(r.errors).withCode(P.createMatrixProduct(s,c))}}}}]),r}(Ee),Ve=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg1.build(e),r=this.arg2.build(e);switch(t.type){case G:switch(r.type){case G:return t.withMoreErrors(r.errors).withCode(P.createDivideField(t.code,r.code));case X:return t.withMoreErrors(r.errors,["Invalid division value by quaternion"]);case Y:return t.withMoreErrors(r.errors,["Invalid division value by vector"]);default:return t.withMoreErrors(r.errors,["Invalid division value by matrix"])}case X:switch(r.type){case G:return t.withMoreErrors(r.errors).withCode(P.createDivQuatField(t.code,r.code));case X:return t.withMoreErrors(r.errors).withCode(P.createDivQuat(t.code,r.code));case Y:return t.withMoreErrors(r.errors,["Invalid division quaternion by vector"]);default:return t.withMoreErrors(r.errors,["Invalid division quaternion by matrix"])}case Y:switch(r.type){case G:return t.withMoreErrors(r.errors).withCode(P.createDivideVector(t.code,r.code));case X:return t.withMoreErrors(r.errors,["Invalid division vector by quaternion"]);case Y:return t.withMoreErrors(r.errors,["Invalid division vector by vector"]);default:return t.withMoreErrors(r.errors,["Invalid division vector by matrix"])}default:switch(r.type){case G:return t.withMoreErrors(r.errors).withCode(P.createDivideMatrix(t.code,r.code));case X:return t.withMoreErrors(r.errors,["Invalid division matrix by quaternion"]);case Y:return t.withMoreErrors(r.errors,["Invalid division matrix by vector"]);default:return t.withMoreErrors(r.errors,["Invalid division matrix by matrix"])}}}}]),r}(Ee),Re=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg.build(e);switch(t.type){case G:return t;case X:return t.withErrors(["Invalid trace on quaternion"]);case Y:return t.withErrors(["Invalid trace on vector"]);default:return t.withType(G).withCode(P.createTrace(t.code))}}}]),r}(le),qe=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg.build(e);switch(t.type){case G:return t.withCode(P.createValueNorma(t.code));case X:return t.withCode(P.createQuatNorma(t.code));case Y:return t.withCode(P.createVectNorma(t.code));default:return t.withErrors(["Invalid norma on matrix"])}}}]),r}(le),Te=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg.build(e);switch(t.type){case G:return t.withErrors(["Invalid cyl on value"]);case X:return t.withErrors(["Invalid cyl on quaternion"]);case Y:var r=3!==t.rows?P.createResizeVector(t.code,3):t.code;return t.withCode(P.createCyl(r));default:return t.withErrors(["Invalid cyl on matrix"])}}}]),r}(le),Pe=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg.build(e);switch(t.type){case G:return t.withErrors(["Invalid sphere on value"]);case X:return t.withErrors(["Invalid sphere on quaternion"]);case Y:var r=3!==t.rows?P.createResizeVector(t.code,3):t.code;return t.withCode(P.createSphere(r));default:return t.withErrors(["Invalid sphere on matrix"])}}}]),r}(le),Fe=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg.build(e);switch(t.type){case G:return t.withErrors(["Invalid cyl on value"]);case X:return t.withErrors(["Invalid cyl on quaternion"]);case Y:var r=3!==t.rows?P.createResizeVector(t.code,3):t.code;return t.withType(ee).withSize(3,3).withCode(P.createCyl1(r));default:return t.withErrors(["Invalid cyl on matrix"])}}}]),r}(le),De=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg.build(e);switch(t.type){case G:return t.withErrors(["Invalid cyl on value"]);case X:return t.withErrors(["Invalid cyl on quaternion"]);case Y:var r=3!==t.rows?P.createResizeVector(t.code,3):t.code;return t.withType(ee).withSize(3,3).withCode(P.createSphere1(r));default:return t.withErrors(["Invalid cyl on matrix"])}}}]),r}(le),Ne=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg.build(e);switch(t.type){case G:return t.withCode(P.createValueInverse(t.code));case X:return t.withCode(P.createQuatInverse(t.code));case Y:return t.withErrors(["Invalid inv on vector"]);default:return t.rows!==t.cols?t.withErrors(["Invalid inv on not square matrix"]):t.withCode(P.createMatrixInverse(t.code))}}}]),r}(le),Be=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg.build(e);switch(t.type){case G:return t.withErrors(["Invalid det on value"]);case X:return t.withErrors(["Invalid det on quaternion"]);case Y:return t.withErrors(["Invalid det on vector"]);default:return t.rows!==t.cols?t.withErrors(["Invalid det on not square matrix"]):t.withCode(P.createDet(t.code))}}}]),r}(le),Le=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg.build(e);switch(t.type){case G:return t;case X:return t.withErrors(["Invalid min on quaternion"]);case Y:return t.withType(G).withCode(P.createMinVec(t.code));default:return t.withType(G).withCode(P.createMinMat(t.code))}}}]),r}(le),$e=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"build",value:function(e){var t=this.arg.build(e);switch(t.type){case G:return t;case X:return t.withErrors(["Invalid max on quaternion"]);case Y:return t.withType(G).withCode(P.createMaxVec(t.code));default:return t.withType(G).withCode(P.createMaxMat(t.code))}}}]),r}(le),Qe=new oe("0"),Ue={sin:function(e){return new we(e)},cos:function(e){return new ye(e)},tan:function(e){return new be(e)},asin:function(e){return new je(e)},acos:function(e){return new me(e)},atan:function(e){return new Oe(e)},sinh:function(e){return new xe(e)},cosh:function(e){return new ke(e)},tanh:function(e){return new Me(e)},exp:function(e){return new ve(e)},log:function(e){return new ge(e)},sqrt:function(e){return new fe(e)},T:function(e){return new pe(e)},qrot:function(e){return new Ce(e)},tr:function(e){return new Re(e)},n:function(e){return new qe(e)},cyl:function(e){return new Te(e)},sphere:function(e){return new Pe(e)},cyl1:function(e){return new Fe(e)},sphere1:function(e){return new De(e)},inv:function(e){return new Ne(e)},det:function(e){return new Be(e)},min:function(e){return new Le(e)},max:function(e){return new $e(e)}},Ke=function(){function e(){var t=this;Object(c.a)(this,e),this._errors=[];var r=new B;r.addRule(U,(function(e){return t._token={text:e.text,type:F}})),r.addRule(Q,(function(e){return t._token={text:e.text,type:F}})),r.addRule(L,(function(e){return t._token={text:e.text,type:D}})),r.addRule(/\s/),r.addRule(/./,(function(e){return t._token={text:e.text,type:N}})),this._lexer=r}return Object(u.a)(e,[{key:"addError",value:function(e){return this._errors.push(e),this}},{key:"parse",value:function(e){this._errors=[],this.discard(),this._lexer.setSource(e);var t=this.parseExp(),r=this.token;return void 0!==r&&this.addError("Unexpected token "+r.text),t}},{key:"parseExp",value:function(){for(var e=this.parseSum();;){var t=this.token;if(void 0===t)return e;switch(t.text){case",":this.discard(),e=new Ie(e,this.parseSum());break;default:return e}}}},{key:"parseSum",value:function(){for(var e=this.parseFactor();;){var t=this.token;if(void 0===t)return e;switch(t.text){case"+":this.discard(),e=new _e(e,this.parseFactor());break;case"-":this.discard(),e=new ze(e,this.parseFactor());break;default:return e}}}},{key:"parseFactor",value:function(){for(var e=this.parseUnary();;){var t=this.token;if(void 0===t)return e;switch(t.text){case"*":this.discard(),e=new Ae(e,this.parseUnary());break;case"/":this.discard(),e=new Ve(e,this.parseUnary());break;default:return e}}}},{key:"parseUnary",value:function(){var e=this.token;if(void 0===e)return this.addError("Expected unary expression"),Qe;var t=Ue[e.text];if(t)return this.discard(),t(this.parseUnary());switch(e.text){case"+":return this.discard(),this.parseUnary();case"-":return this.discard(),new de(this.parseUnary());default:return this.parsePwr()}}},{key:"parsePwr",value:function(){for(var e=this.parseTerm();;){var t=this.token;if(void 0===t||"^"!==t.text)return e;this.discard();var r=this.parseTerm();e=new Se(e,r)}}},{key:"parseTerm",value:function(){var e=this.token;if(void 0===e)return this.addError("Expected terminal expression"),Qe;switch(e.type){case F:return this.discard(),new oe(Number(e.text));case N:switch(e.text){case"(":this.discard();var t=this.parseExp();return this.expected(")"),t;case"|":this.discard();var r=this.parseExp();return this.expected("|"),new he(r);default:return this.discard(),this.addError("Unexpected token "+e.text),this.parseTerm()}case D:switch(e.text){case"PI":return this.discard(),new oe(Math.PI);case"e":return this.discard(),new oe(Math.E);case"i":return this.discard(),new ae([1,0,0,0]);case"j":return this.discard(),new ae([0,1,0,0]);case"k":return this.discard(),new ae([0,0,1,0]);case"dt":return this.discard(),new ue;case"ex":return this.discard(),new ie(0);case"ey":return this.discard(),new ie(1);case"ez":return this.discard(),new ie(2);default:return this.discard(),function(e){var t=e.match(/^e([0-9]+)$/);if(t)return new ie(parseInt(t[1],10));var r=e.match(/^I([0-9]+)$/);return r?new se(parseInt(r[1],10)):new ce(e)}(e.text)}}}},{key:"expected",value:function(e){return this.token?this.token.text!==e?this.addError("Expected "+e+" found "+this.token.text):this.discard():this.addError("Expected "+e+" found end of text"),this}},{key:"discard",value:function(){return delete this._token,this}},{key:"errors",get:function(){return this._errors}},{key:"token",get:function(){return void 0===this._token&&this._lexer.lex(),this._token}}]),e}(),Je=r(112),Ze=Object(Je.a)("http://www.mmarini.org",Je.a.URL),He=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(e){var n;return Object(c.a)(this,r),(n=t.call(this,e)).state={deleteModalShown:!1,newName:""},n}return Object(u.a)(r,[{key:"createDefs",value:function(){var e=this.props.defs;return _.a.mapValues(e,"exp")}},{key:"onChange",value:function(e,t){var r=this.props,n=r.onChange,o=r.panelKey;if(n){var a=this.createDefs();a[e]=t,n(o,a)}}},{key:"onDelete",value:function(e){var t=this;this.showOptionPanel('Remove "'+e+'" definition ?','The definition "'+e+'" will be removed from the list.',(function(){return t.deleteDefs(e)}))}},{key:"showOptionPanel",value:function(e,t,r){this.setState({deleteModalShown:!0,modalTitle:e,modalMessage:t,optionAction:r})}},{key:"deleteDefs",value:function(e){var t=this.props,r=t.onChange,n=t.panelKey;if(r){var o=this.createDefs();delete o[e],r(n,o)}this.hideOptionPanel()}},{key:"hideOptionPanel",value:function(){this.setState({deleteModalShown:!1})}},{key:"onAdd",value:function(){var e=this.props,t=e.onChange,r=e.panelKey;if(t){var n=this.state.newName,o=this.createDefs();o[n]="0",t(r,o),this.setState({newName:""})}}},{key:"onName",value:function(e){this.setState({newName:e})}},{key:"newNameError",value:function(e){return""===e?"Identifier is required":J(e)?J(e):this.props.defs[e]?"Definition already exists":""}},{key:"hasError",value:function(){return _.a.flatMap(this.props.defs,"errors").length>0}},{key:"render",value:function(){var e=this,t=this.props,r=t.title,o=t.defs,a=this.state,i=a.deleteModalShown,s=a.modalTitle,c=a.modalMessage,u=a.optionAction,l=a.newName,d=this.newNameError(l),h=_()(o).toPairs().sortBy((function(e){return e[0]})).map((function(e){var t=e[0],r=e[1];return{id:Object(Je.a)(t,Ze),key:t,value:r}})).value(),p=""!==d;return Object(n.jsx)(x.a,{defaultActiveKey:"0",children:Object(n.jsxs)(k.a,{children:[Object(n.jsx)(x.a.Toggle,{as:k.a.Header,eventKey:"0",children:r}),Object(n.jsx)(x.a.Collapse,{eventKey:"0",children:Object(n.jsxs)(k.a.Body,{children:[Object(n.jsx)(v.a.Group,{controlId:"validationAdd",children:Object(n.jsxs)(M.a,{size:"sm",children:[Object(n.jsx)(M.a.Prepend,{children:"Name"}),Object(n.jsx)(v.a.Control,{type:"text",value:l,onChange:function(t){return e.onName(t.target.value)},isValid:!p,isInvalid:!!p}),Object(n.jsx)(M.a.Append,{children:Object(n.jsxs)(g.a,{variant:"primary",onClick:function(){return e.onAdd()},disabled:p,children:[Object(n.jsx)(C.a,{icon:E.a}),Object(n.jsx)("span",{children:"Add definition"})]})}),Object(n.jsx)(v.a.Control.Feedback,{type:"invalid",children:d})]})}),Object(n.jsx)("hr",{}),h.map((function(t){var r=t.id,o=t.key,a=t.value;return Object(n.jsx)(S,{name:o,expr:a.exp,errors:a.errors,onChange:function(t){return e.onChange(o,t)},onDelete:function(){return e.onDelete(o)}},r)})),Object(n.jsx)(A,{show:i,title:s,message:c,confirmButton:"Remove",onCancel:function(){return e.hideOptionPanel()},onConfirm:function(){u&&u()}})]})})]})})}}]),r}(o.Component),We=r(103),Ge=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(e){var n;return Object(c.a)(this,r),(n=t.call(this,e)).state={modalShown:!1},n}return Object(u.a)(r,[{key:"onAddRotation",value:function(){var e=this.props.onChange;e&&e({position:this.props.body.position.exp,rotation:"1+0*i"})}},{key:"showOptionPanel",value:function(){this.setState({modalShown:!0})}},{key:"hideOptionPanel",value:function(){this.setState({modalShown:!1})}},{key:"deleteRotation",value:function(){var e=this.props.onChange;e&&e({position:this.props.body.position.exp});this.hideOptionPanel()}},{key:"onDeleteRow",value:function(){var e=this.props.onDelete;e&&e()}},{key:"onChangePosition",value:function(e){var t=this.props,r=t.onChange,n=t.body;r&&r(n.rotation?{position:e,rotation:n.rotation.exp}:{position:e})}},{key:"onChangeRotation",value:function(e){var t=this.props,r=t.onChange,n=t.body;r&&r({position:n.position.exp,rotation:e})}},{key:"render",value:function(){var e=this,t=this.props.body,r=t.rotation?Object(n.jsxs)("div",{children:[Object(n.jsx)(S,{name:"",expr:t.rotation.exp,errors:t.rotation.errors,onChange:function(t){return e.onChangeRotation(t)},onDelete:function(){return e.showOptionPanel()}}),Object(n.jsx)(A,{show:this.state.modalShown,title:"Remove rotation ?",message:"The rotation will be removed from body",confirmButton:"Remove",onConfirm:function(){return e.deleteRotation()},onCancel:function(){return e.hideOptionPanel()}})]}):Object(n.jsx)(g.a,{size:"sm",variant:"primary",onClick:function(){return e.onAddRotation()},children:Object(n.jsx)(C.a,{icon:E.a})});return Object(n.jsxs)("tr",{children:[Object(n.jsx)("td",{children:this.props.id+1}),Object(n.jsx)("td",{children:Object(n.jsx)(S,{name:"",expr:t.position.exp,errors:t.position.errors,onChange:function(t){return e.onChangePosition(t)},withoutDelete:!0})}),Object(n.jsx)("td",{children:r}),Object(n.jsx)("td",{children:Object(n.jsx)(g.a,{size:"sm",variant:"danger",onClick:function(){return e.onDeleteRow()},children:Object(n.jsx)(C.a,{icon:E.b})})})]})}}]),r}(o.Component),Xe=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(e){var n;return Object(c.a)(this,r),(n=t.call(this,e)).state={modalShown:!1},n}return Object(u.a)(r,[{key:"showOptionPanel",value:function(e,t,r){this.setState({modalShown:!0,modalTitle:e,modalMessage:t,confirmAction:r})}},{key:"hideOptionPanel",value:function(){this.setState({modalShown:!1})}},{key:"onAdd",value:function(){var e=this.props.onChange;if(e){var t=this.createBodies();t.push({position:"(0,0,0)"}),e(t)}}},{key:"onDelete",value:function(e){var t=this;this.showOptionPanel("Remove body #"+(e+1),"Body #"+(e+1)+" will be removed from the list.",(function(){return t.deleteBody(e)}))}},{key:"deleteBody",value:function(e){var t=this.props.onChange;if(t){var r=this.createBodies();r.splice(e,1),t(r)}this.hideOptionPanel()}},{key:"createBodies",value:function(){return _.a.map(this.props.bodies,(function(e){return e.rotation?{position:e.position.exp,rotation:e.rotation.exp}:{position:e.position.exp}}))}},{key:"onChange",value:function(e,t){var r=this.props.onChange;if(r){var n=this.createBodies();n[e]=t,r(n)}}},{key:"hasError",value:function(){return _.a.flatMap(this.props.bodies,(function(e){return e.rotation?_.a.concat(e.position.errors,e.rotation.errors):e.position.errors})).length>0}},{key:"render",value:function(){var e=this,t=this.props.bodies,r=this.state,o=r.modalShown,a=r.modalTitle,i=r.modalMessage,s=r.confirmAction,c=_.a.map(t,(function(t,r){return Object(n.jsx)(Ge,{id:r,body:t,onChange:function(t){return e.onChange(r,t)},onDelete:function(){return e.onDelete(r)}},r)}));return Object(n.jsx)(x.a,{defaultActiveKey:"0",children:Object(n.jsxs)(k.a,{children:[Object(n.jsx)(x.a.Toggle,{as:k.a.Header,eventKey:"0",children:"Bodies"}),Object(n.jsx)(x.a.Collapse,{eventKey:"0",children:Object(n.jsxs)(k.a.Body,{children:[Object(n.jsxs)(g.a,{size:"sm",variant:"primary",onClick:function(){return e.onAdd()},children:[Object(n.jsx)(C.a,{icon:E.a}),"Add new body"]}),Object(n.jsx)("hr",{}),Object(n.jsx)(We.a,{striped:!0,size:"sm",children:Object(n.jsxs)("thead",{children:[Object(n.jsxs)("tr",{children:[Object(n.jsx)("th",{scope:"col",children:"#"}),Object(n.jsx)("th",{scope:"col",children:"Position"}),Object(n.jsx)("th",{scope:"col",children:"Rotation"}),Object(n.jsx)("th",{scope:"col",children:"Remove"})]}),c]})}),Object(n.jsx)(A,{show:o,title:a,message:i,confirmButton:"Remove",onConfirm:function(){s&&s()},onCancel:function(){return e.hideOptionPanel()}})]})})]})})}}]),r}(o.Component),Ye=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"createConf",value:function(){return{bodies:this.createBodies(),funcs:this.createDefs(this.props.result.funcs),update:this.createDefs(this.props.result.update),vars:this.createDefs(this.props.result.vars)}}},{key:"createBodies",value:function(){return _.a.map(this.props.result.bodies,(function(e){return e.rotation?{position:e.position.exp,rotation:e.rotation.exp}:{position:e.position.exp}}))}},{key:"createDefs",value:function(e){return _.a.mapValues(e,"exp")}},{key:"onChange",value:function(e,t){var r=this.props.onChange;if(r){var n=this.createConf();n[e]=t,r(n)}}},{key:"onBodiesChange",value:function(e){var t=this.props.onChange;if(t){var r=this.createConf();r.bodies=e,t(r)}}},{key:"render",value:function(){var e=this,t=this.props.result;return Object(n.jsxs)(v.a,{noValidate:!0,children:[Object(n.jsx)(Xe,{bodies:this.props.result.bodies,onChange:function(t){return e.onBodiesChange(t)}}),Object(n.jsx)(He,{panelKey:"funcs",title:"Macros",defs:t.funcs,onChange:function(t,r){return e.onChange(t,r)}}),Object(n.jsx)(He,{panelKey:"vars",title:"Variables",defs:this.props.result.vars,onChange:function(t,r){return e.onChange(t,r)}}),Object(n.jsx)(He,{panelKey:"update",title:"Update",defs:this.props.result.update,onChange:function(t,r){return e.onChange(t,r)}})]})}}]),r}(o.Component);function et(e){return function(e,t,r){var n=null;return n=e<=0?m.Color3.Red():e<1/6?new m.Color3(1,6*e,0):e<2/6?new m.Color3(2-6*e,1,0):e<.5?new m.Color3(0,1,6*e-2):e<4/6?new m.Color3(0,4-6*e,1):e<5/6?new m.Color3(6*e-4,0,1):e<1?new m.Color3(1,0,6-6*e):m.Color3.Red(),m.Color3.White().scale(1-t).add(n.scale(t)).scale(r)}(5*(1-e)/6,1,1-.2*(1-e))}var tt=function(){function e(t){Object(c.a)(this,e),this.props=t}return Object(u.a)(e,[{key:"init",value:function(e){var t=this,r=_.a.defaults(e||{},{cameraType:"do",cameraPosition:new m.Vector3(0,0,-10),cameraMinZ:.5,ambientColor:new m.Color3(.2,.2,.2),sunLightDirection:new m.Vector3(1,1,-1),sunLightIntensity:.7,subSteps:1});this._subSteps=r.subSteps,function(e,t){var r=null;switch(t.cameraType){case"do":(r=new m.DeviceOrientationCamera("DevOr_camera",new m.Vector3(0,0,0),e)).position=t.cameraPosition,r.setTarget(m.Vector3.Zero()),r.angularSensibility=10,r.moveSensibility=10;break;case"ac":return(r=new m.AnaglyphArcRotateCamera("aar_cam",-Math.PI/2,Math.PI/4,20,new m.Vector3.Zero,.033,e)).target=m.Vector3.Zero(),r.setPosition(t.cameraPosition),r;case"vr":(r=new m.VRDeviceOrientationArcRotateCamera("Camera",Math.PI/2,Math.PI/4,25,new m.Vector3(0,0,0),e)).target=m.Vector3.Zero(),r.setPosition(t.cameraPosition);break;default:(r=new m.ArcRotateCamera("ArcRotateCamera",1,.8,10,new m.Vector3(0,0,0),e)).target=m.Vector3.Zero(),r.setPosition(t.cameraPosition)}return r.minZ=t.cameraMinZ,r}(this.props.scene,r).attachControl(this.props.canvas,!0),new m.HemisphericLight("sunLight",r.sunLightDirection,this.props.scene).intensity=r.sunLightIntensity,this.props.scene.ambientColor=r.ambientColor,this._state={funcs:{},vars:{},update:{},bodies:[],next:function(){return t._state}},this.props.scene.onBeforeStepObservable.add((function(e){for(var r=(e.getAnimationRatio()||1)/60/t.subSteps,n=0;n<t.subSteps;n++)t.refreshTime(r)})),this.props.engine.runRenderLoop((function(){t.refreshScene(),t.props.scene.render()}))}},{key:"refreshTime",value:function(e){this._state=this._state.next(e)}},{key:"refreshScene",value:function(){var e=this;_.a.each(_.a.zip(this._state.bodies,this._shapes),(function(t){return e.updateShape(t[1],t[0])}))}},{key:"updateShape",value:function(e,t){var r=new m.Vector3(t.position.values[0][0],t.position.values[1][0],t.position.values[2][0]);if(e.position=r,t.rotation){var n=new m.Quaternion.FromArray(t.rotation.values);e.rotationQuaternion=n}}},{key:"refresh",value:function(){this.props.engine.resize()}},{key:"system",set:function(e){var t=this;_.a.each(this._shapes,(function(e){return t.props.scene.removeMesh(e,!0)}));var r=_.a.map(e.bodies,(function(e,r,n){var o="Body"+r,a=et(n.length>1?r/(n.length-1):0),i=void 0!==e.rotation?function(e,t,r){var n=m.MeshBuilder.CreatePolyhedron("Octa_"+t,{type:1,sizeX:.1,sizeY:.2,sizeZ:.05},e);return n.material=new m.StandardMaterial("Material_"+t,e),n.material.ambientColor=r,n.material.diffuseColor=r,n}(t.props.scene,o,a):function(e,t,r){var n=m.MeshBuilder.CreateIcoSphere("Sphere_"+t,{flat:0,radius:.1,subdivisions:4,updatable:!1},e);return n.material=new m.StandardMaterial("Material_"+t,e),n.material.ambientColor=r,n.material.diffuseColor=r,n}(t.props.scene,o,a);return t.updateShape(i,e),i}));return this._shapes=r,this._state=e,this}},{key:"subSteps",get:function(){return this._subSteps},set:function(e){this._subSteps=e}}]),e}(),rt=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(e){var n;return Object(c.a)(this,r),(n=t.call(this,e)).state=n.createNewState(JSON.stringify(e.initialConf||{vars:{a:"0"},funcs:{b:"0"},update:{},bodies:[]},null,"  ")),n}return Object(u.a)(r,[{key:"onInput",value:function(e){this.setState(this.createNewState(e))}},{key:"createNewState",value:function(e){var t;try{var r=JSON.parse(e),n=new W(r).parse();t=JSON.stringify(n,null,"  ")}catch(o){console.error(o),t=o.toString()}return{conf:e,result:t}}},{key:"render",value:function(){var e=this;return Object(n.jsxs)("form",{children:[Object(n.jsxs)(v.a.Group,{controlId:"conf",children:[Object(n.jsx)(v.a.Label,{children:"Configuration"}),Object(n.jsx)(v.a.Control,{componentClass:"textarea",placeholder:"Configuration",rows:"5",value:this.state.conf,onInput:function(t){return e.onInput(t.target.value)},onChange:function(){}})]}),Object(n.jsxs)(v.a.Group,{children:[Object(n.jsx)(v.a.Label,{children:"Result"}),Object(n.jsx)(v.a.Control.Static,{children:Object(n.jsx)("pre",{children:this.state.result})})]})]})}}]),r}(o.Component),nt=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"onFileChange",value:function(e){var t=this.props,r=t.onFileRead,n=t.onError;if(r){var o=new FileReader;o.onload=function(e){r(o.result)},o.onerror=function(e){console.error(e),n&&n(e.toString())};try{o.readAsText(e)}catch(a){console.error(a),n&&n(a.toString())}}}},{key:"render",value:function(){var e=this,t=this.props,r=t.show,o=t.onCancel;return Object(n.jsxs)(z.a,{size:"lg",show:r,onHide:function(){o&&o()},children:[Object(n.jsx)(z.a.Header,{closeButton:!0,children:Object(n.jsx)(z.a.Title,{children:"Import definitions from file ?"})}),Object(n.jsxs)(z.a.Body,{children:[Object(n.jsx)("p",{children:"The definitions will be imported from the selected file."}),Object(n.jsx)(v.a,{children:Object(n.jsx)(v.a.File,{label:"Import file",custom:!0,onChange:function(t){return e.onFileChange(t.target.files[0])}})})]}),Object(n.jsx)(z.a.Footer,{children:Object(n.jsx)(g.a,{variant:"primary",onClick:function(){o&&o()},children:"Cancel"})})]})}}]),r}(o.Component),ot=r(105),at=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(e){var n;return Object(c.a)(this,r),(n=t.call(this,e)).state={counts:"10",dt:"0.1"},n}return Object(u.a)(r,[{key:"dumpData",value:function(){var e=this.props.result,t=this.state,r=t.dt,n=t.counts,o=parseFloat(r),a=parseInt(n),i=e.system;if(i){for(var s=[],c=0;c<a;c++)s.push(i.dumpWithDt(o)),i=i.next(o);var u=_()(s[0]).keys().sortBy().value(),l=_.a.reduce(u,(function(e,t){return e+","+t}))+"\n\r",d=_()(s).map((function(e){return _()(u).map((function(t){return'"'+e[t].toString()+'"'})).reduce((function(e,t){return e+","+t}))})).reduce((function(e,t){return e+"\n\r"+t}))+"\n\r",h=new Blob([l+d],{type:"text/plain;charset=utf-8"});Object(j.saveAs)(h,"dump.csv")}}},{key:"setCounts",value:function(e){this.setState({counts:e})}},{key:"setDt",value:function(e){this.setState({dt:e})}},{key:"render",value:function(){var e=this,t=!this.props.result.system;return Object(n.jsx)(p.a,{children:Object(n.jsx)(ot.a,{children:Object(n.jsxs)(v.a,{noValidate:!0,inline:!0,children:[Object(n.jsxs)(v.a.Group,{controlId:"formInlineName",children:[Object(n.jsx)(v.a.Label,{children:"Counts"})," ",Object(n.jsx)(v.a.Control,{type:"text",placeholder:"Counts",onChange:function(t){return e.setCounts(t.target.value)},value:this.state.counts})]})," ",Object(n.jsxs)(v.a.Group,{controlId:"formInlineName",children:[Object(n.jsx)(v.a.Label,{children:"dt"})," ",Object(n.jsx)(v.a.Control,{type:"text",placeholder:"dt",onChange:function(t){return e.setDt(t.target.value)},value:this.state.dt})]}),Object(n.jsx)(g.a,{variant:"primary",disabled:t,onClick:function(){return e.dumpData()},children:"Download"})]})})})}}]),r}(o.Component),it=r(111),st=r(116),ct=r(114),ut=r(79),lt=r(108),dt=function(e){var t=e.onReset,r=e.onLoad,o=e.onImport,a=e.onExport;return Object(n.jsxs)(ct.a,{variant:"dark",bg:"dark",expand:"lg",children:[Object(n.jsx)(ct.a.Brand,{href:"http://www.mmarini.org",children:"www.mmarini.org"}),Object(n.jsx)(ct.a.Toggle,{"aria-controls":"navbar-nav"}),Object(n.jsx)(ct.a.Collapse,{id:"navbar-nav",children:Object(n.jsxs)(ut.a,{className:"mr-auto",children:[Object(n.jsxs)(ut.a.Link,{href:"/leibniz",children:["Leibniz ","1.2.1"]}),Object(n.jsxs)(lt.a,{id:"predefined-menu",title:"Predefined",children:[Object(n.jsx)(lt.a.Item,{onSelect:function(){t&&t()},children:"Reset"}),Object(n.jsx)(lt.a.Item,{onSelect:function(){r&&r("sample1.json")},children:"Basic sample"}),Object(n.jsx)(lt.a.Item,{onSelect:function(){r&&r("solaris.json")},children:"Solaris (Earth - Sun)"}),Object(n.jsx)(lt.a.Item,{onSelect:function(){r&&r("selene.json")},children:"Selene (Moon -Earth)"})]}),Object(n.jsx)(ut.a.Link,{onClick:function(){o&&o()},children:"Import"}),Object(n.jsx)(ut.a.Link,{onClick:function(){a&&a()},children:"Export"})]})})]})},ht=r(106),pt=function(e){var t=e.isVisible,r=void 0!==t&&t,o=e.onClose,a=e.title,i=e.message;return r?Object(n.jsxs)(ht.a,{variant:"danger",dismissible:!0,onClose:function(){o&&o()},children:[Object(n.jsx)(ht.a.Heading,{children:a}),Object(n.jsx)("p",{children:i})]}):Object(n.jsx)("span",{})},ft={bodies:[],funcs:{},vars:{},update:{}},vt=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(e){var n;Object(c.a)(this,r),(n=t.call(this,e)).leibniz=void 0;var o=b.get("leibniz"),a=o?JSON.parse(o):ft;return n.state={subSteps:"1",alertShow:!1,modalShown:!1,importModalShown:!1,initialConf:a,result:{parserState:{bodies:[],funcs:{},update:{},vars:{}}}},n}return Object(u.a)(r,[{key:"processConf",value:function(e){var t=new W(e).parse(),r={conf:e,result:t};return b.set("leibniz",JSON.stringify(e)),t.system&&this.leibniz&&(this.leibniz.system=t.system),r}},{key:"onChange",value:function(e){this.setState(this.processConf(e))}},{key:"onSceneMount",value:function(e){var t=new tt(e);t.init({cameraType:"ar",subSteps:this.state.subSteps}),this.leibniz=t,this.setState(this.processConf(this.state.initialConf))}},{key:"onReset",value:function(){var e=this;this.showOptionPanel("Reset definitions ?","The definitions will be resetted to default value.","Reset",(function(){return e.reset()}))}},{key:"onLoad",value:function(e){var t=this;this.showOptionPanel("Load definitions "+e+" ?","The definitions will be load from "+e+" .","Load",(function(){return t.load(e)}))}},{key:"showOptionPanel",value:function(e,t,r,n){this.setState({optionShow:!0,optionTitle:e,optionMessage:t,optionConfirmBtn:r,optionConfirm:n})}},{key:"hideOptionPanel",value:function(){this.setState({optionShow:!1})}},{key:"showAlert",value:function(e,t){this.setState({alertShow:!0,alertTitle:e,alertMessage:t})}},{key:"hideAlert",value:function(){this.setState({alertShow:!1})}},{key:"reset",value:function(){var e=this.processConf(ft);this.setState(e),this.hideOptionPanel()}},{key:"load",value:function(e){var t=this,r="/leibniz/"+e;it.a.getJSON(r).pipe(Object(st.a)((function(e){return t.onLoaded(e)}),(function(e){return t.onLoadError(e)}))).subscribe()}},{key:"onLoaded",value:function(e){console.log(e);var t=this.processConf(e);this.setState(t),this.hideOptionPanel()}},{key:"onLoadError",value:function(e){console.error(e);var t=e.xhr.status+" - "+e.xhr.statusText;console.error(t),this.showAlert("Error",t),this.hideOptionPanel()}},{key:"test",value:function(){return Object(n.jsx)(h.a,{eventKey:"test",title:"Test",children:Object(n.jsx)(rt,{initialConf:{vars:{a:"a0",b:"inv(a0)",c:"a*b"},funcs:{a0:"T((8,1,6),(3,5,7),(4,9,2))"},bodies:[],update:{}}})})}},{key:"showImportPanel",value:function(){this.setState({importModalShown:!0})}},{key:"hideImportPanel",value:function(){this.setState({importModalShown:!1})}},{key:"importFile",value:function(e){try{var t=this.processConf(JSON.parse(e));this.setState(t),this.hideAlert(),this.hideImportPanel()}catch(r){console.error("Error parsing",e),this.onError(r)}}},{key:"onError",value:function(e){this.showAlert("Error","Error parsing file "+e),this.hideImportPanel()}},{key:"showExportPanel",value:function(){var e=this;this.showOptionPanel("Export definitions ?","The definitions will be exported into a local file.","Export",(function(){return e.exportFile()}))}},{key:"setSubSteps",value:function(e){this.setState({subSteps:e}),this.leibniz&&(this.leibniz.subSteps=parseInt(e))}},{key:"exportFile",value:function(){var e=JSON.stringify(this.state.conf,null,"  "),t=new Blob([e],{type:"text/plain;charset=utf-8"});Object(j.saveAs)(t,"test.json"),this.hideOptionPanel()}},{key:"render",value:function(){var e=this,t=this.state,r=t.alertShow,o=t.alertTitle,a=t.alertMessage,i=t.importModalShown,s=t.optionShow,c=t.optionTitle,u=t.optionMessage,l=t.optionConfirmBtn,d=t.optionConfirm,b=t.result,j=t.subSteps;return Object(n.jsxs)(p.a,{fluid:!0,children:[Object(n.jsx)(dt,{onReset:function(){return e.onReset()},onLoad:function(t){return e.onLoad(t)},onImport:function(){return e.showImportPanel()},onExport:function(){return e.showExportPanel()}}),Object(n.jsx)(pt,{isVisible:r,title:o,message:a,onClose:function(){return e.hideAlert()}}),Object(n.jsx)(p.a,{children:Object(n.jsxs)(f.a,{id:"Tab",defaultActiveKey:"home",children:[Object(n.jsxs)(h.a,{eventKey:"home",title:"Home",children:[Object(n.jsx)(O,{onSceneMount:function(t){return e.onSceneMount(t)},canvasClass:"graphCanvas"}),Object(n.jsxs)(v.a,{inline:!0,children:[Object(n.jsxs)(w.a,{controlId:"formInlineName",children:[Object(n.jsx)(v.a.Label,{children:"Sub Steps"})," ",Object(n.jsx)(y.a,{type:"text",placeholder:"Sub Steps",onChange:function(t){return e.setSubSteps(t.target.value)},value:j})]})," "]})]}),Object(n.jsx)(h.a,{eventKey:"editor",title:"Editor",children:Object(n.jsx)(Ye,{result:b.parserState,onChange:function(t){return e.onChange(t)}})}),Object(n.jsx)(h.a,{eventKey:"dump",title:"Dump panel",children:Object(n.jsx)(at,{result:b})})]})}),Object(n.jsx)(nt,{show:i,onCancel:function(){return e.hideImportPanel()},onFileRead:function(t){return e.importFile(t)},onError:function(t){return e.onError(t)}}),Object(n.jsx)(A,{show:!!s,title:c,message:u,confirmButton:l||"",onCancel:function(){return e.hideOptionPanel()},onConfirm:d})]})}}]),r}(o.Component),wt=function(e){e&&e instanceof Function&&r.e(3).then(r.bind(null,118)).then((function(t){var r=t.getCLS,n=t.getFID,o=t.getFCP,a=t.getLCP,i=t.getTTFB;r(e),n(e),o(e),a(e),i(e)}))};s.a.render(Object(n.jsx)(a.a.StrictMode,{children:Object(n.jsx)(vt,{})}),document.getElementById("root")),wt()}},[[94,1,2]]]);
//# sourceMappingURL=main.85069a58.chunk.js.map